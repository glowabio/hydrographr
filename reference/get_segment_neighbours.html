<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Get stream segment neighbours — get_segment_neighbours • hydrographr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Get stream segment neighbours — get_segment_neighbours"><meta name="description" content='For each input stream segment, the function reports those
upstream, downstream, or up-and downstream segments that are connected to the
input segment(s) within a specified neighbour order, with the option to
summarize attributes across these segments. Note that the stream
segment and sub-catchment IDs are identical, and for consistency,
we use the term "subc_id". The input graph can be created with
read_geopackage() and get_catchment_graph().
This function can be used to obtain the neighbour stream segments /
sub-catchments for spatially explicit models or for spatial prioritization
analyses (e.g. Marxan/Gurobi). By selecting a wider radius, the spatial
dependency of the neighbouring segments / sub-catchments can be increased.
See also get_all_upstream_distances() which creates the input
for addressing the longitudinal connectivity for the spatial prioritization.'><meta property="og:description" content='For each input stream segment, the function reports those
upstream, downstream, or up-and downstream segments that are connected to the
input segment(s) within a specified neighbour order, with the option to
summarize attributes across these segments. Note that the stream
segment and sub-catchment IDs are identical, and for consistency,
we use the term "subc_id". The input graph can be created with
read_geopackage() and get_catchment_graph().
This function can be used to obtain the neighbour stream segments /
sub-catchments for spatially explicit models or for spatial prioritization
analyses (e.g. Marxan/Gurobi). By selecting a wider radius, the spatial
dependency of the neighbouring segments / sub-catchments can be increased.
See also get_all_upstream_distances() which creates the input
for addressing the longitudinal connectivity for the spatial prioritization.'></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">hydrographr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/hydrographr.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/benchmark.html">Function benchmarks</a></li>
    <li><a class="dropdown-item" href="../articles/case_study_brazil.html">Case study - São Francisco drainage basin</a></li>
    <li><a class="dropdown-item" href="../articles/case_study_cuba.html">Case study - Cuba</a></li>
    <li><a class="dropdown-item" href="../articles/case_study_Danube.html">Case study - Danube basin</a></li>
    <li><a class="dropdown-item" href="../articles/case_study_germany.html">Case study - Germany</a></li>
    <li><a class="dropdown-item" href="../articles/case_study_lakes.html">Case study - Lake Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/example_other_stream_networks.html">Usage of hydrographr with other stream networks</a></li>
    <li><a class="dropdown-item" href="../articles/linux_system_setup.html">Setting up the package requirements on Linux</a></li>
    <li><a class="dropdown-item" href="../articles/macos_system_setup.html">Setting up the package requirements on MacOS</a></li>
    <li><a class="dropdown-item" href="../articles/windows_system_setup.html">Setting up the package requirements on Windows</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/glowabio/hydrographr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Get stream segment neighbours</h1>
      <small class="dont-index">Source: <a href="https://github.com/glowabio/hydrographr/blob/HEAD/R/get_segment_neighbours.R" class="external-link"><code>R/get_segment_neighbours.R</code></a></small>
      <div class="d-none name"><code>get_segment_neighbours.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>For each input stream segment, the function reports those
upstream, downstream, or up-and downstream segments that are connected to the
input segment(s) within a specified neighbour order, with the option to
summarize attributes across these segments. Note that the stream
segment and sub-catchment IDs are identical, and for consistency,
we use the term "subc_id". The input graph can be created with
<code><a href="read_geopackage.html">read_geopackage()</a></code> and <code><a href="get_catchment_graph.html">get_catchment_graph()</a></code>.</p>
<p>This function can be used to obtain the neighbour stream segments /
sub-catchments for spatially explicit models or for spatial prioritization
analyses (e.g. Marxan/Gurobi). By selecting a wider radius, the spatial
dependency of the neighbouring segments / sub-catchments can be increased.
See also <code><a href="get_all_upstream_distances.html">get_all_upstream_distances()</a></code> which creates the input
for addressing the longitudinal connectivity for the spatial prioritization.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">get_segment_neighbours</span><span class="op">(</span></span>
<span>  <span class="va">g</span>,</span>
<span>  subc_id <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  var_layer <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  stat <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  attach_only <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  order <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  mode <span class="op">=</span> <span class="st">"in"</span>,</span>
<span>  n_cores <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  max_size <span class="op">=</span> <span class="fl">1500</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-g">g<a class="anchor" aria-label="anchor" href="#arg-g"></a></dt>
<dd><p>igraph object. A directed graph.</p></dd>


<dt id="arg-subc-id">subc_id<a class="anchor" aria-label="anchor" href="#arg-subc-id"></a></dt>
<dd><p>numeric vector of the input sub-catchment IDs
(=stream segment IDs) for which to search the connected segments.</p></dd>


<dt id="arg-var-layer">var_layer<a class="anchor" aria-label="anchor" href="#arg-var-layer"></a></dt>
<dd><p>character vector. One or more attributes (variable layers)
of the input graph that should be reported for each output segment_id
("to_stream"). Optional. Default is NULL.</p></dd>


<dt id="arg-stat">stat<a class="anchor" aria-label="anchor" href="#arg-stat"></a></dt>
<dd><p>one of the functions mean, median, min, max, sd (without quotes).
Aggregates (or summarizes) the variables for the neighbourhood of each input
segment (e.g., the average land cover in the next five upstream
segments or sub-catchments). Default is NULL.</p></dd>


<dt id="arg-attach-only">attach_only<a class="anchor" aria-label="anchor" href="#arg-attach-only"></a></dt>
<dd><p>logical. If TRUE, the selected variables will be only
attached to each segment without any further aggregation. Default is FALSE.</p></dd>


<dt id="arg-order">order<a class="anchor" aria-label="anchor" href="#arg-order"></a></dt>
<dd><p>numeric. The neighbouring order as in igraph::ego.
Order = 1 would be immediate neighbours of the input sub-catchment IDs,
order = 2 would be the order 1 plus the immediate neighbours of
those sub-catchment IDs in order 1, and so on.</p></dd>


<dt id="arg-mode">mode<a class="anchor" aria-label="anchor" href="#arg-mode"></a></dt>
<dd><p>character. One of "in", "out", or "all". "in" returns only
upstream neighbouring segments, "out" returns only the downstream segments,
and "all" returns both.</p></dd>


<dt id="arg-n-cores">n_cores<a class="anchor" aria-label="anchor" href="#arg-n-cores"></a></dt>
<dd><p>numeric. Number of cores used for parallelisation
in the case of multiple stream segments / outlets. Default is 1.
Note that the parallelisation process requires copying the data to each
core. In case the graph is very large, and many segments are
used as an input, setting n_cores to a higher value can speed up the
computation. This comes however at the cost of possible RAM limitations
and even slower processing since the large data will be copied to each core.
Hence consider testing first with n_cores = 1. Optional.</p></dd>


<dt id="arg-max-size">max_size<a class="anchor" aria-label="anchor" href="#arg-max-size"></a></dt>
<dd><p>numeric. Specifies the maximum size of the data passed to the
parallel back-end in MB. Default is 1500 (1.5 GB). Consider a higher value
for large study areas (more than one 20°x20° tile). Optional.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data.table indicating the connected segments (stream  | to_stream), or a
data.table that summarizes the attributes of those neighbours contributing
to each segment.</p>
<p>#' @note
Currently the attributes are not provided for the outlet (the selected
subc_id segment). If the attributes are also needed for the outlet subc_id,
then the next downstream sub_id can be selected (enlarge the study area)
using e.g. <code><a href="get_catchment_graph.html">get_catchment_graph()</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Csardi G, Nepusz T: The igraph software package for complex network research,
InterJournal, Complex Systems 1695. 2006. <a href="https://igraph.org" class="external-link">https://igraph.org</a></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="read_geopackage.html">read_geopackage()</a></code> and <code>get_catchment_graph.()</code> to
create the input graph. The function <code><a href="get_all_upstream_distances.html">get_all_upstream_distances()</a></code>
can be be used to obtain the network distance for all upstream subc_id (useful
as an input for a subsequent spatial prioritization analysis).</p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Sami Domisch</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># Download test data into the temporary R folder</span></span>
<span><span class="co"># or define a different directory</span></span>
<span><span class="va">my_directory</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="download_test_data.html">download_test_data</a></span><span class="op">(</span><span class="va">my_directory</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load the stream network as graph</span></span>
<span><span class="va">my_graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="read_geopackage.html">read_geopackage</a></span><span class="op">(</span>gpkg<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">my_directory</span>,</span>
<span>                                         <span class="st">"/hydrography90m_test_data"</span>,</span>
<span>                                         <span class="st">"/order_vect_59.gpkg"</span><span class="op">)</span>,</span>
<span>                            import_as <span class="op">=</span> <span class="st">"graph"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Subset the graph and get a smaller catchment</span></span>
<span><span class="va">my_graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="get_catchment_graph.html">get_catchment_graph</a></span><span class="op">(</span>g <span class="op">=</span> <span class="va">my_graph</span>, subc_id <span class="op">=</span> <span class="fl">513866048</span>, mode <span class="op">=</span> <span class="st">"in"</span>,</span>
<span>                                use_outlet <span class="op">=</span> <span class="cn">FALSE</span>, as_graph <span class="op">=</span> <span class="cn">TRUE</span>, n_cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Get a vector of all segment IDs</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.igraph.org/" class="external-link">igraph</a></span><span class="op">)</span></span>
<span><span class="va">subc_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r.igraph.org/reference/as_ids.html" class="external-link">as_ids</a></span><span class="op">(</span><span class="fu"><a href="https://r.igraph.org/reference/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">my_graph</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Get all (up-and downstream) directly adjacent neighbours of each segment</span></span>
<span><span class="fu">get_segment_neighbours</span><span class="op">(</span>g <span class="op">=</span> <span class="va">my_graph</span>, subc_id <span class="op">=</span> <span class="va">subc_id</span>,</span>
<span>                       order <span class="op">=</span> <span class="fl">1</span>, mode <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get the upstream segment neighbours in the 5th order</span></span>
<span><span class="co"># and report the length and source elevation</span></span>
<span><span class="co"># for the neighbours of each input segment</span></span>
<span><span class="fu">get_segment_neighbours</span><span class="op">(</span>g <span class="op">=</span> <span class="va">my_graph</span>, subc_id <span class="op">=</span> <span class="va">subc_id</span>,</span>
<span>                       order <span class="op">=</span> <span class="fl">5</span>, mode <span class="op">=</span> <span class="st">"in"</span>, n_cores <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                       var_layer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"length"</span>, <span class="st">"source_elev"</span><span class="op">)</span>,</span>
<span>                       attach_only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get the downstream segment neighbours in the 5th order</span></span>
<span><span class="co"># and calculate the median length and source elevation</span></span>
<span><span class="co"># across the neighbours of each input segment</span></span>
<span><span class="fu">get_segment_neighbours</span><span class="op">(</span>g <span class="op">=</span> <span class="va">my_graph</span>, subc_id <span class="op">=</span> <span class="va">subc_id</span>,</span>
<span>                       order <span class="op">=</span> <span class="fl">2</span>, mode <span class="op">=</span><span class="st">"out"</span>, n_cores <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                       var_layer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"length"</span>, <span class="st">"source_elev"</span><span class="op">)</span>,</span>
<span>                       stat <span class="op">=</span> <span class="va">median</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get the up-and downstream segment neighbours in the 5th order</span></span>
<span><span class="co"># and report the median length and source elevation</span></span>
<span><span class="co"># for the neighbours of each input segment</span></span>
<span><span class="fu">get_segment_neighbours</span><span class="op">(</span>g <span class="op">=</span> <span class="va">my_graph</span>, subc_id <span class="op">=</span> <span class="va">subc_id</span>, order <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                       mode <span class="op">=</span> <span class="st">"all"</span>, n_cores <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                       var_layer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"length"</span>, <span class="st">"source_elev"</span><span class="op">)</span>,</span>
<span>                       stat <span class="op">=</span> <span class="va">mean</span>, attach_only <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span></code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Marlene Schürz, Afroditi Grigoropoulou, Jaime Garcia Marquez, Yusdiel Torres Cambas, Christoph Schürz, Mathieu Floury, Thomas Tomiczek, Vanessa Bremerich, Merret Buurman, Giuseppe Amatulli, Sami Domisch.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

