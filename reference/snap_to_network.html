<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Snap points to the next stream segment within a defined radius
or a minimum flow accumulation."><title>Snap points to stream segment based on distance or flow accumulation — snap_to_network • hydrographr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Snap points to stream segment based on distance or flow accumulation — snap_to_network"><meta property="og:description" content="Snap points to the next stream segment within a defined radius
or a minimum flow accumulation."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">hydrographr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.6</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/hydrographr.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/linux_system_setup.html">Setting up the package requirements on Linux</a>
    <a class="dropdown-item" href="../articles/windows_system_setup.html">Setting up the package requirements on Windows</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/glowabio/hydrographr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Snap points to stream segment based on distance or flow accumulation</h1>
      <small class="dont-index">Source: <a href="https://github.com/glowabio/hydrographr/blob/HEAD/R/snap_to_network.R" class="external-link"><code>R/snap_to_network.R</code></a></small>
      <div class="d-none name"><code>snap_to_network.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Snap points to the next stream segment within a defined radius
or a minimum flow accumulation.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">snap_to_network</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">lon</span>,</span>
<span>  <span class="va">lat</span>,</span>
<span>  <span class="va">id</span>,</span>
<span>  <span class="va">stream_layer</span>,</span>
<span>  accu_layer <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"distance"</span>,</span>
<span>  distance <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  accumulation <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data</dt>
<dd><p>a data.frame or data.table with lat/lon coordinates in WGS84.</p></dd>


<dt>lon</dt>
<dd><p>character. The name of the column with the longitude coordinates.</p></dd>


<dt>lat</dt>
<dd><p>character. The name of the column with the latitude coordinates.</p></dd>


<dt>id</dt>
<dd><p>character. The name of a column containing unique IDs for
each row of "data" (e.g., occurrence or site IDs).</p></dd>


<dt>stream_layer</dt>
<dd><p>character. Full path of the stream network .gpkg file</p></dd>


<dt>accu_layer</dt>
<dd><p>character. Full path of the flow accumulation .tif file.
Needed if the point should be snapped to the next stream segment having
an accumulation value higher than the flow accumulation threshold
(set by 'accumulation'). This prevents points from being snapped to small
stream tributaries.</p></dd>


<dt>method</dt>
<dd><p>character. One of "distance", "accumulation", or "both".
Defines if the points are snapped using the distance or flow accumulation
(see "Details" for more information). If method is set to "both" the output
will contain the new coordinates for both calculations.
Default is "distance".</p></dd>


<dt>distance</dt>
<dd><p>numeric. Maximum radius in meters. The points will be
snapped to the next stream within this radius. Default is 500.</p></dd>


<dt>accumulation</dt>
<dd><p>numeric. Minimum flow accumulation. Points will be
snapped to the next stream with a flow accumulation equal or higher than the
given value. Default is 0.5.</p></dd>


<dt>quiet</dt>
<dd><p>logical. If FALSE, the standard output will be printed.
Default is TRUE.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function makes use of the r.stream.snap command available in GRASS GIS to
simultaneously a number of points to a stream network. A distance threshold
can be specified and points will be snapped to any stream segment within this
distance radius. However, to avoid snapping to small tributaries, an
accumulation threshold can be used and the snapping occurs on stream segment
with equal or higher accumulation threshold and within the given distance
radius.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>Duplicated rows will be removed.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p><a href="https://grass.osgeo.org/grass78/manuals/addons/r.stream.snap.html" class="external-link">https://grass.osgeo.org/grass78/manuals/addons/r.stream.snap.html</a></p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Maria M. Üblacker, Jaime Garcia Marquez</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># Download test data into the temporary R folder</span></span>
<span><span class="co"># or define a different directory</span></span>
<span><span class="va">my_directory</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="download_test_data.html">download_test_data</a></span><span class="op">(</span><span class="va">my_directory</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load occurrence data</span></span>
<span><span class="va">species_occurence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">my_directory</span>,</span>
<span>                            <span class="st">"/hydrography90m_test_data/spdata_1264942.txt"</span><span class="op">)</span>,</span>
<span>                              header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define full path to flow accumulation</span></span>
<span><span class="va">stream_rast</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">my_directory</span>,</span>
<span>                     <span class="st">"/hydrography90m_test_data/stream_1264942.tif"</span><span class="op">)</span></span>
<span><span class="va">flow_rast</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">my_directory</span>,</span>
<span>                     <span class="st">"/hydrography90m_test_data/flow_1264942.tif"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># To calculate the new (snapped) coordinates for a radius and a flow</span></span>
<span><span class="va">snapped_coordinates</span> <span class="op">&lt;-</span> <span class="fu">snap_to_network</span><span class="op">(</span>data <span class="op">=</span> <span class="va">species_occurrence</span>,</span>
<span>                                       lon <span class="op">=</span> <span class="st">"longitude"</span>,</span>
<span>                                       lat <span class="op">=</span> <span class="st">"latitude"</span>,</span>
<span>                                       id <span class="op">=</span> <span class="st">"occurrence_id"</span>,</span>
<span>                                       stream_layer <span class="op">=</span> <span class="va">stream_vect</span>,</span>
<span>                                       accu_layer <span class="op">=</span> <span class="va">flow_rast</span>,</span>
<span>                                       method <span class="op">=</span> <span class="st">"both"</span>,</span>
<span>                                       distance <span class="op">=</span> <span class="fl">300</span>,</span>
<span>                                       accumulation <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show head of output table</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">snapped_coordinates</span><span class="op">)</span></span>
<span></span></code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Maria Üblacker, Afroditi Grigoropoulou, Jaime Garcia Marquez, Yusdiel Torres Cambas, Christoph Schürz, Mathieu Floury, Thomas Tomiczek, Vanessa Bremerich, Giuseppe Amatulli, Sami Domisch.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer></div>

  

  

  </body></html>

