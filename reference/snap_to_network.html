<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Snap points to stream segment based on distance or flow accumulation — snap_to_network • hydrographr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Snap points to stream segment based on distance or flow accumulation — snap_to_network"><meta name="description" content="Snap points to the next stream segment within a defined radius
(in map pixels) or a minimum flow accumulation."><meta property="og:description" content="Snap points to the next stream segment within a defined radius
(in map pixels) or a minimum flow accumulation."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">hydrographr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/hydrographr.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/benchmark.html">Function benchmarks</a></li>
    <li><a class="dropdown-item" href="../articles/case_study_brazil.html">Case study - São Francisco drainage basin</a></li>
    <li><a class="dropdown-item" href="../articles/case_study_cuba.html">Case study - Cuba</a></li>
    <li><a class="dropdown-item" href="../articles/case_study_Danube.html">Case study - Danube Basin (Environment90m)</a></li>
    <li><a class="dropdown-item" href="../articles/case_study_germany.html">Case study - Germany</a></li>
    <li><a class="dropdown-item" href="../articles/case_study_lakes.html">Case study - Lake Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/example_other_stream_networks.html">Usage of hydrographr with other stream networks</a></li>
    <li><a class="dropdown-item" href="../articles/linux_system_setup.html">Setting up the package requirements on Linux</a></li>
    <li><a class="dropdown-item" href="../articles/macos_system_setup.html">Setting up the package requirements on MacOS</a></li>
    <li><a class="dropdown-item" href="../articles/windows_system_setup.html">Setting up the package requirements on Windows</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/glowabio/hydrographr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Snap points to stream segment based on distance or flow accumulation</h1>
      <small class="dont-index">Source: <a href="https://github.com/glowabio/hydrographr/blob/HEAD/R/snap_to_network.R" class="external-link"><code>R/snap_to_network.R</code></a></small>
      <div class="d-none name"><code>snap_to_network.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Snap points to the next stream segment within a defined radius
(in map pixels) or a minimum flow accumulation.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">snap_to_network</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">lon</span>,</span>
<span>  <span class="va">lat</span>,</span>
<span>  <span class="va">id</span>,</span>
<span>  <span class="va">stream_layer</span>,</span>
<span>  accu_layer <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"distance"</span>,</span>
<span>  distance <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  accumulation <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>a data.frame or data.table that contains the columns regarding
the longitude / latitude coordinates in WGS84.</p></dd>


<dt id="arg-lon">lon<a class="anchor" aria-label="anchor" href="#arg-lon"></a></dt>
<dd><p>character. The name of the column with the longitude coordinates.</p></dd>


<dt id="arg-lat">lat<a class="anchor" aria-label="anchor" href="#arg-lat"></a></dt>
<dd><p>character. The name of the column with the latitude coordinates.</p></dd>


<dt id="arg-id">id<a class="anchor" aria-label="anchor" href="#arg-id"></a></dt>
<dd><p>character. The name of a column containing unique IDs for
each row of "data" (e.g., occurrence or site IDs). The unique IDs need to be
numeric and less than 10 characters long.</p></dd>


<dt id="arg-stream-layer">stream_layer<a class="anchor" aria-label="anchor" href="#arg-stream-layer"></a></dt>
<dd><p>character. Full path of the stream network .tif file</p></dd>


<dt id="arg-accu-layer">accu_layer<a class="anchor" aria-label="anchor" href="#arg-accu-layer"></a></dt>
<dd><p>character. Full path of the flow accumulation .tif file.
Needed if the point should be snapped to the next stream segment having
an accumulation value higher than the flow accumulation threshold
(set by 'accumulation'). This prevents points from being snapped to small
stream tributaries. Optional. Default is NULL.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>character. One of "distance", "accumulation", or "both".
Defines if the points are snapped using the distance or flow accumulation
(see "Details" for more information). If method is set to "both" the output
will contain the new coordinates for both calculations.
Default is "distance" (in map pixels).</p></dd>


<dt id="arg-distance">distance<a class="anchor" aria-label="anchor" href="#arg-distance"></a></dt>
<dd><p>numeric. Maximum radius in map pixels. The points will be
snapped to the next stream within this radius. Default is 500.</p></dd>


<dt id="arg-accumulation">accumulation<a class="anchor" aria-label="anchor" href="#arg-accumulation"></a></dt>
<dd><p>numeric. Minimum flow accumulation. Points will be
snapped to the next stream with a flow accumulation equal or higher than the
given value. Default is 0.5.</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>logical. If FALSE, the standard output will be printed.
Default is TRUE.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns a data.frame with the snapped coordinates and the sub-catchment ID
of the snapped stream segment. If the sub-catchment ID is NA, no stream segment
was found within the given distance (method = "distance") or no stream segment
wad found within the given distance and a flow accumulation equal or higher
than the given threshold (method = "accumulation"). "out-bbox" means that the
provided coordinates are not within the extend (bounding box) of the
provided stream network layer.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function makes use of the r.stream.snap function available in GRASS GIS to
simultaneously snap a number of points to the stream network. A distance threshold
can be specified and points will be snapped to any stream segment within this
distance radius (in map pixels). However, to avoid snapping to small tributaries, an
accumulation threshold can be used and the snapping occurs on stream segment
with equal or higher accumulation threshold and within the given distance
radius.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>Duplicated rows will be removed from the input data.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p><a href="https://grass.osgeo.org/grass78/manuals/addons/r.stream.snap.html" class="external-link">https://grass.osgeo.org/grass78/manuals/addons/r.stream.snap.html</a></p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Marlene Schürz, Jaime Garcia Marquez</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># Download test data into the temporary R folder</span></span>
<span><span class="co"># or define a different directory</span></span>
<span><span class="va">my_directory</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="download_test_data.html">download_test_data</a></span><span class="op">(</span><span class="va">my_directory</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load occurrence data</span></span>
<span><span class="va">species_occurrence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">my_directory</span>,</span>
<span>                            <span class="st">"/hydrography90m_test_data/spdata_1264942.txt"</span><span class="op">)</span>,</span>
<span>                              header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define full path to stream network and flow accumulation</span></span>
<span><span class="va">stream_raster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">my_directory</span>,</span>
<span>                     <span class="st">"/hydrography90m_test_data/stream_1264942.tif"</span><span class="op">)</span></span>
<span><span class="va">flow_raster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">my_directory</span>,</span>
<span>                     <span class="st">"/hydrography90m_test_data/flow_1264942.tif"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># To calculate the new (snapped) coordinates for a radius and a flow</span></span>
<span><span class="va">snapped_coordinates</span> <span class="op">&lt;-</span> <span class="fu">snap_to_network</span><span class="op">(</span>data <span class="op">=</span> <span class="va">species_occurrence</span>,</span>
<span>                                       lon <span class="op">=</span> <span class="st">"longitude"</span>,</span>
<span>                                       lat <span class="op">=</span> <span class="st">"latitude"</span>,</span>
<span>                                       id <span class="op">=</span> <span class="st">"occurrence_id"</span>,</span>
<span>                                       stream_layer <span class="op">=</span> <span class="va">stream_raster</span>,</span>
<span>                                       accu_layer <span class="op">=</span> <span class="va">flow_raster</span>,</span>
<span>                                       method <span class="op">=</span> <span class="st">"both"</span>,</span>
<span>                                       distance <span class="op">=</span> <span class="fl">300</span>,</span>
<span>                                       accumulation <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show head of output table</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">snapped_coordinates</span><span class="op">)</span></span>
<span></span></code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Marlene Schürz, Afroditi Grigoropoulou, Jaime Garcia Marquez, Yusdiel Torres Cambas, Christoph Schürz, Mathieu Floury, Thomas Tomiczek, Vanessa Bremerich, Merret Buurman, Giuseppe Amatulli, Sami Domisch.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

