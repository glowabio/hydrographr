<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Delineate the upstream catchment — get_upstream_catchment • hydrographr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Delineate the upstream catchment — get_upstream_catchment"><meta name="description" content="Delineates the upstream catchment of a given point, where the
point is considered as the outlet of the catchment."><meta property="og:description" content="Delineates the upstream catchment of a given point, where the
point is considered as the outlet of the catchment."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">hydrographr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/hydrographr.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/benchmark.html">Function benchmarks</a></li>
    <li><a class="dropdown-item" href="../articles/case_study_brazil.html">Case study - São Francisco drainage basin</a></li>
    <li><a class="dropdown-item" href="../articles/case_study_cuba.html">Case study - Cuba</a></li>
    <li><a class="dropdown-item" href="../articles/case_study_Danube.html">Case study - Danube basin</a></li>
    <li><a class="dropdown-item" href="../articles/case_study_germany.html">Case study - Germany</a></li>
    <li><a class="dropdown-item" href="../articles/example_other_stream_networks.html">Usage of hydrographr with other stream networks</a></li>
    <li><a class="dropdown-item" href="../articles/linux_system_setup.html">Setting up the package requirements on Linux</a></li>
    <li><a class="dropdown-item" href="../articles/macos_system_setup.html">Setting up the package requirements on MacOS</a></li>
    <li><a class="dropdown-item" href="../articles/windows_system_setup.html">Setting up the package requirements on Windows</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/glowabio/hydrographr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Delineate the upstream catchment</h1>
      <small class="dont-index">Source: <a href="https://github.com/glowabio/hydrographr/blob/HEAD/R/get_upstream_catchment.R" class="external-link"><code>R/get_upstream_catchment.R</code></a></small>
      <div class="d-none name"><code>get_upstream_catchment.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Delineates the upstream catchment of a given point, where the
point is considered as the outlet of the catchment.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">get_upstream_catchment</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">id</span>,</span>
<span>  <span class="va">lon</span>,</span>
<span>  <span class="va">lat</span>,</span>
<span>  direction_layer <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  out_dir <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_cores <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  compression <span class="op">=</span> <span class="st">"low"</span>,</span>
<span>  bigtiff <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>a data.frame or data.table that contains the columns regarding
the longitude / latitude coordinates in WGS84. Note that the points need to
be snapped to the stream network with <code><a href="snap_to_network.html">snap_to_network()</a></code> or
<code><a href="snap_to_subc_segment.html">snap_to_subc_segment()</a></code>.</p></dd>


<dt id="arg-id">id<a class="anchor" aria-label="anchor" href="#arg-id"></a></dt>
<dd><p>character. The name of a column containing unique IDs for each row
of "data" (e.g., occurrence or site IDs). The unique IDs need to be
numeric and less than 10 characters long.</p></dd>


<dt id="arg-lon">lon<a class="anchor" aria-label="anchor" href="#arg-lon"></a></dt>
<dd><p>character. The name of the column with the longitude coordinates.</p></dd>


<dt id="arg-lat">lat<a class="anchor" aria-label="anchor" href="#arg-lat"></a></dt>
<dd><p>character. The name of the column with the latitude coordinates.</p></dd>


<dt id="arg-direction-layer">direction_layer<a class="anchor" aria-label="anchor" href="#arg-direction-layer"></a></dt>
<dd><p>character. Full path to the flow direction raster file.</p></dd>


<dt id="arg-out-dir">out_dir<a class="anchor" aria-label="anchor" href="#arg-out-dir"></a></dt>
<dd><p>Full path to the directory where the output(s) will be stored.
The output file name includes the "id" which helps identifying  the upstream
corresponding catchment.</p></dd>


<dt id="arg-n-cores">n_cores<a class="anchor" aria-label="anchor" href="#arg-n-cores"></a></dt>
<dd><p>numeric. Number of cores used for parallelisation.
If NULL, available cores - 1 will be used. Default is NULL.</p></dd>


<dt id="arg-compression">compression<a class="anchor" aria-label="anchor" href="#arg-compression"></a></dt>
<dd><p>character. Compression of the written output file.
Compression levels can be defined as "none", "low", or "high". Default is
"low", referring to compression type "DEFLATE" and compression level 2.
"high" refers to compression level 9.</p></dd>


<dt id="arg-bigtiff">bigtiff<a class="anchor" aria-label="anchor" href="#arg-bigtiff"></a></dt>
<dd><p>logical. Define whether the output file is expected to be a
BIGTIFF (file size larger than 4 GB). If FALSE and size &gt; 4GB no file will be
written. Default is TRUE.</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>logical. If FALSE, the standard output will be printed.
Default is TRUE.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>

<ul><li><p><a href="https://grass.osgeo.org/grass82/manuals/r.water.outlet.html" class="external-link">https://grass.osgeo.org/grass82/manuals/r.water.outlet.html</a></p></li>
<li><p><a href="https://grass.osgeo.org/grass82/manuals/r.region.html" class="external-link">https://grass.osgeo.org/grass82/manuals/r.region.html</a></p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index">
<ul><li><p><code><a href="snap_to_network.html">snap_to_network</a></code> to snap the data points to the next stream
segment within a given radius and/or a given flow accumulation threshold
value.</p></li>
<li><p><code><a href="snap_to_subc_segment.html">snap_to_subc_segment</a></code> to snap the data points to the next stream
segment within the sub-catchment the point is located.</p></li>
<li><p><code><a href="extract_ids.html">extract_ids</a></code> to extract basin and sub-catchment IDs.</p></li>
</ul></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Jaime Garcia Marquez, Afroditi Grigoropoulou, Marlene Schürz</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># Download test data into temporary R folder</span></span>
<span><span class="co"># or define a different directory</span></span>
<span><span class="va">my_directory</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="download_test_data.html">download_test_data</a></span><span class="op">(</span><span class="va">my_directory</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Before running the function get_upstream_catchment(), snap the points to</span></span>
<span><span class="co"># to the stream segment. There are multiple ways to snap the points. Here is</span></span>
<span><span class="co"># one example:</span></span>
<span></span>
<span><span class="co"># Load occurrence data</span></span>
<span><span class="va">species_occurrence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">my_directory</span>,</span>
<span>                                       <span class="st">"/hydrography90m_test_data"</span>,</span>
<span>                                       <span class="st">"/spdata_1264942.txt"</span><span class="op">)</span>,</span>
<span>                              header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define full path to the basin and sub-catchments raster layer</span></span>
<span><span class="va">basin_raster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">my_directory</span>,</span>
<span>                       <span class="st">"/hydrography90m_test_data/basin_1264942.tif"</span><span class="op">)</span></span>
<span><span class="va">subc_raster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">my_directory</span>,</span>
<span>                      <span class="st">"/hydrography90m_test_data/subcatchment_1264942.tif"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define full path to the vector file of the stream network</span></span>
<span><span class="va">stream_vector</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">my_directory</span>,</span>
<span>                        <span class="st">"/hydrography90m_test_data/order_vect_59.gpkg"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Automatically extract the basin and sub-catchment IDs and</span></span>
<span><span class="co"># snap the data points to the stream segment</span></span>
<span><span class="va">snapped_coordinates</span> <span class="op">&lt;-</span> <span class="fu"><a href="snap_to_subc_segment.html">snap_to_subc_segment</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">species_occurrence</span>,</span>
<span>                                            lon <span class="op">=</span> <span class="st">"longitude"</span>,</span>
<span>                                            lat <span class="op">=</span> <span class="st">"latitude"</span>,</span>
<span>                                            id <span class="op">=</span> <span class="st">"occurrence_id"</span>,</span>
<span>                                            basin_layer <span class="op">=</span> <span class="va">basin_raster</span>,</span>
<span>                                            subc_layer <span class="op">=</span> <span class="va">subc_raster</span>,</span>
<span>                                            stream_layer <span class="op">=</span> <span class="va">stream_vector</span>,</span>
<span>                                            n_cores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define full path to the direction .tif</span></span>
<span><span class="va">direction_raster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">my_directory</span>,</span>
<span>                           <span class="st">"/hydrography90m_test_data/direction_1264942.tif"</span><span class="op">)</span></span>
<span><span class="co"># Define the path for the output file(s)</span></span>
<span><span class="va">output_folder</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">my_directory</span>, <span class="st">"/upstream_catchments"</span><span class="op">)</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.exists</a></span><span class="op">(</span><span class="va">output_folder</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">output_folder</span><span class="op">)</span></span>
<span><span class="co"># Get the upstream catchment for each point location</span></span>
<span><span class="fu">get_upstream_catchment</span><span class="op">(</span><span class="va">snapped_coordinates</span>,</span>
<span>                       lon <span class="op">=</span> <span class="st">"lon_snap"</span>,</span>
<span>                       lat <span class="op">=</span> <span class="st">"lat_snap"</span>,</span>
<span>                       id <span class="op">=</span> <span class="st">"occurrence_id"</span>,</span>
<span>                       direction_layer <span class="op">=</span> <span class="va">direction_raster</span>,</span>
<span>                       out_dir <span class="op">=</span> <span class="va">output_folder</span>,</span>
<span>                       n_cores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Marlene Schürz, Afroditi Grigoropoulou, Jaime Garcia Marquez, Yusdiel Torres Cambas, Christoph Schürz, Mathieu Floury, Thomas Tomiczek, Vanessa Bremerich, Merret Buurman, Giuseppe Amatulli, Sami Domisch.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

