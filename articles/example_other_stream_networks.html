<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="hydrographr">
<title>Usage of hydrographr with other stream networks • hydrographr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Usage of hydrographr with other stream networks">
<meta property="og:description" content="hydrographr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">hydrographr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.16</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/hydrographr.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/benchmark.html">Function benchmarks</a>
    <a class="dropdown-item" href="../articles/case_study_brazil.html">Case study - São Francisco drainage basin</a>
    <a class="dropdown-item" href="../articles/case_study_cuba.html">Case study - Cuba</a>
    <a class="dropdown-item" href="../articles/case_study_germany.html">Case study - Germany</a>
    <a class="dropdown-item" href="../articles/example_other_stream_networks.html">Usage of hydrographr with other stream networks</a>
    <a class="dropdown-item" href="../articles/linux_system_setup.html">Setting up the package requirements on Linux</a>
    <a class="dropdown-item" href="../articles/macos_system_setup.html">Setting up the package requirements on MacOS</a>
    <a class="dropdown-item" href="../articles/windows_system_setup.html">Setting up the package requirements on Windows</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/glowabio/hydrographr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Usage of hydrographr with other stream networks</h1>
            <h3 data-toc-skip class="subtitle">Examples showing how to
use the hydrographr package with the NHDPlusHR dataset</h3>
                        <h4 data-toc-skip class="author"></h4>
            
            <h4 data-toc-skip class="date">2024-01-02</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/glowabio/hydrographr/blob/HEAD/vignettes/example_other_stream_networks.Rmd" class="external-link"><code>vignettes/example_other_stream_networks.Rmd</code></a></small>
      <div class="d-none name"><code>example_other_stream_networks.Rmd</code></div>
    </div>

    
    
<p>Load required libraries:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://glowabio.github.io/hydrographr/" class="external-link">hydrographr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://doi-usgs.github.io/nhdplusTools/" class="external-link">nhdplusTools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rgbif" class="external-link">rgbif</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://archive.r-lib.org/" class="external-link">archive</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/leaflet/" class="external-link">leaflet</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.igraph.org/" class="external-link">igraph</a></span><span class="op">)</span></span></code></pre></div>
<p>Define working directory:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wdir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu">here</span><span class="op">(</span><span class="op">)</span>, <span class="st">"/vignettes/data_other_networks"</span><span class="op">)</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">wdir</span>, <span class="st">"/data"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">wdir</span>, <span class="st">"/data"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="download-nhdplushr-data">Download NHDPlusHR data<a class="anchor" aria-label="anchor" href="#download-nhdplushr-data"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define the working directory for the region Hawaii</span></span>
<span><span class="va">wdir</span> <span class="op">&lt;-</span> <span class="st">"my/working/directory/data_hawaii"</span></span>
<span><span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">wdir</span>, <span class="st">"/data"</span><span class="op">)</span></span>
<span><span class="va">rast_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"/raster"</span><span class="op">)</span></span>
<span><span class="va">vect_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"/vector"</span><span class="op">)</span></span>
<span><span class="va">sp_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"/species"</span><span class="op">)</span></span>
<span><span class="va">out_dir</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">wdir</span>, <span class="st">"/output"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a new folder in the working directories to store all the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">data_dir</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">rast_dir</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">vect_dir</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">sp_dir</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">out_dir</span><span class="op">)</span></span></code></pre></div>
<p>Data of the NHDPlusHR dataset can be downloaded using the R package
<code>nhdplusTools</code> or from this USGS website: <a href="https://apps.nationalmap.gov/downloader/" class="external-link uri">https://apps.nationalmap.gov/downloader/</a></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Download NHDPlus raster data for Hawaii </span></span>
<span><span class="fu"><a href="https://doi-usgs.github.io/nhdplusTools/reference/download_nhdplusv2.html" class="external-link">download_nhdplusv2</a></span><span class="op">(</span>outdir <span class="op">=</span> <span class="va">rast_dir</span>,</span>
<span>                   url <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>                     <span class="st">"https://prd-tnm.s3.amazonaws.com/StagedProducts/"</span>,</span>
<span>                                <span class="st">"Hydrography/NHDPlusHR/Beta/GDB/"</span>,</span>
<span>                                <span class="st">"NHDPLUS_H_2006_HU4_RASTER.7z"</span><span class="op">)</span>,</span>
<span>                   progress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Unzip -- can also be done manually</span></span>
<span><span class="co"># When called with default arguments extracts all files in the archive.</span></span>
<span><span class="fu"><a href="https://archive.r-lib.org/reference/archive_extract.html" class="external-link">archive_extract</a></span><span class="op">(</span>archive <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">rast_dir</span>, <span class="st">"/NHDPLUS_H_2006_HU4_RASTER.7z"</span><span class="op">)</span>,</span>
<span>                dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">rast_dir</span>, <span class="st">"/NHDPLUS_H_2006_HU4_RASTER"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Download NHDPlus vector data for Hawaii </span></span>
<span><span class="fu"><a href="https://doi-usgs.github.io/nhdplusTools/reference/download_nhdplusv2.html" class="external-link">download_nhdplusv2</a></span><span class="op">(</span>outdir <span class="op">=</span> <span class="va">vect_dir</span>,</span>
<span>                   url <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>                     <span class="st">"https://prd-tnm.s3.amazonaws.com/StagedProducts/"</span>,</span>
<span>                      <span class="st">"Hydrography/NHDPlusHR/Beta/GDB/"</span>,</span>
<span>                      <span class="st">"NHDPLUS_H_2006_HU4_GDB.zip"</span><span class="op">)</span>,</span>
<span>                   progress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Unzip -- can also be done manually</span></span>
<span><span class="fu"><a href="https://archive.r-lib.org/reference/archive_extract.html" class="external-link">archive_extract</a></span><span class="op">(</span>archive <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">vect_dir</span>, <span class="st">"/NHDPLUS_H_2006_HU4_GDB.zip"</span><span class="op">)</span>,</span>
<span>                dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">vect_dir</span>, <span class="st">"/NHDPLUS_H_2006_HU4_GDB"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Check directory structure</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">rast_dir</span>, <span class="st">"/NHDPLUS_H_2006_HU4_RASTER"</span><span class="op">)</span>, recursive <span class="op">=</span> <span class="cn">T</span>, </span>
<span>           pattern <span class="op">=</span> <span class="st">".tif$"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="species-data">Species data<a class="anchor" aria-label="anchor" href="#species-data"></a>
</h3>
<p>Download occurrence records of <em>Stenogobius hawaiiensis</em> from
GBIF.org using the R package <code>rgbif</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Download occurrence data with coordinates from GBIF</span></span>
<span><span class="va">gbif_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/occ_data.html" class="external-link">occ_data</a></span><span class="op">(</span>scientificName <span class="op">=</span> <span class="st">"Stenogobius hawaiiensis"</span>, </span>
<span>                      hasCoordinate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># To cite the data use:</span></span>
<span><span class="co"># gbif_citation(gbif_data)</span></span>
<span></span>
<span><span class="co"># Clean the data</span></span>
<span><span class="va">spdata</span> <span class="op">&lt;-</span> <span class="va">gbif_data</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">decimalLongitude</span>, <span class="va">decimalLatitude</span>, <span class="va">species</span>, <span class="va">occurrenceStatus</span>, </span>
<span>         <span class="va">country</span>, <span class="va">stateProvince</span>, <span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>,</span>
<span>         <span class="va">stateProvince</span> <span class="op">==</span> <span class="st">"Hawaii"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>occurrence_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"longitude"</span> <span class="op">=</span> <span class="st">"decimalLongitude"</span>,</span>
<span>         <span class="st">"latitude"</span> <span class="op">=</span> <span class="st">"decimalLatitude"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">spdata</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">sp_dir</span>, <span class="st">"/stenogobius_hawaiiensis.csv"</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="cn">F</span>,</span>
<span>          quote <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="va">spdata</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualise-species-data">Visualise species data<a class="anchor" aria-label="anchor" href="#visualise-species-data"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/leaflet.html" class="external-link">leaflet</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addProviderTiles.html" class="external-link">addProviderTiles</a></span><span class="op">(</span><span class="st">'Esri.WorldShadedRelief'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-layers.html" class="external-link">addCircles</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">spdata</span>, color <span class="op">=</span> <span class="st">"purple"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">m</span></span></code></pre></div>
<p><img src="../reference/figures/hawaii_map.png"></p>
<p>By inspecting the NHDPlusHR data, we observe that the coordinate
reference system is not WGS84, but the EPSG:26904.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">rast_dir</span>, </span>
<span>            <span class="st">"/NHDPLUS_H_2006_HU4_RASTER/HRNHDPlusRasters2006/cat.tif"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Therefore we will need to convert the species points’ coordinates to
EPSG:26904, so that they match with the spatial layers.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert the coordinate columns to a matrix</span></span>
<span><span class="va">spdata_coord</span> <span class="op">&lt;-</span> <span class="va">spdata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">longitude</span>, <span class="va">latitude</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/terra/man/coerce.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Project to the coordinate reference system of the NHDPlus dataset</span></span>
<span><span class="va">spdata_coord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/project.html" class="external-link">project</a></span><span class="op">(</span><span class="va">spdata_coord</span>, </span>
<span>                        from <span class="op">=</span> <span class="st">"+proj=longlat +datum=WGS84"</span>, </span>
<span>                        to <span class="op">=</span> <span class="st">"EPSG:26904"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Replace the WGS84 coordinates with the EPSG:26904 coordinates in the species </span></span>
<span><span class="co"># points' data frame</span></span>
<span><span class="va">spdata</span> <span class="op">&lt;-</span> <span class="va">spdata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>longitude <span class="op">=</span> <span class="va">spdata_coord</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>         latitude <span class="op">=</span> <span class="va">spdata_coord</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="crop-and-merge-raster-data">Crop and merge raster data<a class="anchor" aria-label="anchor" href="#crop-and-merge-raster-data"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The coordinates of the bounding box should also be in the NAD_1983_UTM_Zone_4N projection system</span></span>
<span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">582638</span>, <span class="fl">2361564</span>, <span class="fl">594373</span>, <span class="fl">2370255</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/crop_to_extent.html">crop_to_extent</a></span><span class="op">(</span>raster_layer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">rast_dir</span>, <span class="st">"/NHDPLUS_H_2006_HU4_RASTER/HRNHDPlusRasters2006/cat.tif"</span><span class="op">)</span>, </span>
<span>               bounding_box <span class="op">=</span> <span class="va">bbox</span>,</span>
<span>               out_dir <span class="op">=</span> <span class="va">out_dir</span>,</span>
<span>               file_name <span class="op">=</span> <span class="st">"cat_crop.tif"</span>,</span>
<span>               compression <span class="op">=</span> <span class="st">"high"</span></span>
<span>              <span class="op">)</span></span>
<span></span>
<span><span class="co"># We can crop to another bounding box, and then try to merge the two cropped </span></span>
<span><span class="co"># layers</span></span>
<span><span class="va">bbox2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">595603</span>, <span class="fl">2371564</span>, <span class="fl">604373</span>, <span class="fl">2380255</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/crop_to_extent.html">crop_to_extent</a></span><span class="op">(</span>raster_layer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">rast_dir</span>, <span class="st">"/NHDPLUS_H_2006_HU4_RASTER/HRNHDPlusRasters2006/cat.tif"</span><span class="op">)</span>, </span>
<span>               bounding_box <span class="op">=</span> <span class="va">bbox2</span>,</span>
<span>               out_dir <span class="op">=</span> <span class="va">out_dir</span>,</span>
<span>               file_name <span class="op">=</span> <span class="st">"cat_crop2.tif"</span>,</span>
<span>               compression <span class="op">=</span> <span class="st">"high"</span></span>
<span>              <span class="op">)</span></span>
<span><span class="co"># Merge the two cropped layers</span></span>
<span><span class="fu"><a href="../reference/merge_tiles.html">merge_tiles</a></span><span class="op">(</span>tile_dir <span class="op">=</span> <span class="va">out_dir</span>, </span>
<span>            tile_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cat_crop.tif"</span>, <span class="st">"cat_crop2.tif"</span><span class="op">)</span>,</span>
<span>            out_dir <span class="op">=</span> <span class="va">out_dir</span>,</span>
<span>            file_name <span class="op">=</span> <span class="st">"cat_merged.tif"</span>,</span>
<span>            compression <span class="op">=</span> <span class="st">"high"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="extract-ids-report-no-data-value-set-no-data-value">Extract IDs, Report no data value, Set no data value<a class="anchor" aria-label="anchor" href="#extract-ids-report-no-data-value-set-no-data-value"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spdata_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_ids.html">extract_ids</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">spdata</span>, </span>
<span>            lon <span class="op">=</span> <span class="st">"longitude"</span>, lat <span class="op">=</span> <span class="st">"latitude"</span>,</span>
<span>            id <span class="op">=</span> <span class="st">"occurrence_id"</span>,</span>
<span>            basin_layer  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">rast_dir</span>, <span class="st">"/NHDPLUS_H_2006_HU4_RASTER/HRNHDPlusRasters2006/cat.tif"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">spdata_ids</span></span>
<span></span>
<span><span class="co"># We observe that some points obtain basin_id=NA, because they fall out of the </span></span>
<span><span class="co"># extent of the downloaded raster layer. We will filter these points out, </span></span>
<span><span class="co"># keeping only those which overlap with the raster.</span></span>
<span></span>
<span><span class="va">spdata_ids</span> <span class="op">&lt;-</span> <span class="va">spdata_ids</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">basin_id</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">spdata_ids</span></span>
<span></span>
<span><span class="co"># On the other hand, some other points obtain basin_id=-32768. This should be </span></span>
<span><span class="co"># the no data value of the raster layer, meaning a value attributed to the sea </span></span>
<span><span class="co"># cells. We can double-check this using the report_no_data function:</span></span>
<span><span class="va">no_data_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/report_no_data.html">report_no_data</a></span><span class="op">(</span>data_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">rast_dir</span>, <span class="st">"/NHDPLUS_H_2006_HU4_RASTER/HRNHDPlusRasters2006"</span><span class="op">)</span>, var_layer <span class="op">=</span> <span class="st">"cat.tif"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">no_data_val</span></span>
<span><span class="co"># We can filter out these points, too, so that we only keep the points sampled </span></span>
<span><span class="co"># in rivers. </span></span>
<span><span class="va">spdata_ids</span> <span class="op">&lt;-</span> <span class="va">spdata_ids</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">basin_id</span> <span class="op">!=</span> <span class="va">no_data_val</span><span class="op">$</span><span class="va">NoData</span><span class="op">)</span></span>
<span><span class="va">spdata_ids</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Don't run:</span></span>
<span><span class="co"># If we wanted to change the no data value of a layer, we could do it using the </span></span>
<span><span class="co"># function:</span></span>
<span><span class="fu"><a href="../reference/set_no_data.html">set_no_data</a></span><span class="op">(</span>data_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">rast_dir</span>, <span class="st">"/NHDPLUS_H_2006_HU4_RASTER/HRNHDPlusRasters2006"</span><span class="op">)</span>, </span>
<span>            var_layer <span class="op">=</span> <span class="st">"cat.tif"</span>, </span>
<span>            no_data <span class="op">=</span> <span class="op">-</span><span class="fl">32768</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remember to set it back to the original value!</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="extract-zonal-statistics">Extract zonal statistics<a class="anchor" aria-label="anchor" href="#extract-zonal-statistics"></a>
</h3>
<p>To extract zonal statistics of a raster layer using the NHDPlus
basins as zones, we first need to download and crop to our extent an
example raster layer. We will use the CHELSA Bioclim 12 (BIO12) layer of
1981-2010 for this example.</p>
<p>For this operation, we also need to convert the projection system of
the cat.tif raster to EPSG:4326 using the ‘terra’ package, so that it is
compatible with the coordinate system of CHELSA Bioclim files.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Download bio12 in the rast_dir</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://os.zhdk.cloud.switch.ch/envicloud/chelsa/chelsa_V2/GLOBAL/climatologies/1981-2010/bio/CHELSA_bio12_1981-2010_V.2.1.tif"</span>,</span>
<span>destfile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">rast_dir</span>, <span class="st">"/bio12_1981-2010.tif"</span><span class="op">)</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Crop bio12 to bounding box</span></span>
<span><span class="co"># We first need to convert the bounding box coordinates to WGS84, that is the </span></span>
<span><span class="co"># coordinate system of the CHELSA Bioclim layers.</span></span>
<span><span class="va">bbox_wgs84</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/project.html" class="external-link">project</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">bbox</span><span class="op">)</span>, from <span class="op">=</span> <span class="st">"EPSG:26904"</span>, to <span class="op">=</span> <span class="st">"EPSG:4326"</span><span class="op">)</span></span>
<span><span class="co"># Now crop</span></span>
<span><span class="fu"><a href="../reference/crop_to_extent.html">crop_to_extent</a></span><span class="op">(</span>raster_layer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">rast_dir</span>, <span class="st">"/bio12_1981-2010.tif"</span><span class="op">)</span>, </span>
<span>               bounding_box <span class="op">=</span> <span class="va">bbox_wgs84</span>,</span>
<span>               out_dir <span class="op">=</span> <span class="va">out_dir</span>,</span>
<span>               file_name <span class="op">=</span> <span class="st">"bio12_crop.tif"</span>,</span>
<span>               compression <span class="op">=</span> <span class="st">"high"</span></span>
<span>              <span class="op">)</span></span>
<span></span>
<span><span class="co"># Load the cat.tif layer</span></span>
<span><span class="va">cat_rast</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">rast_dir</span>, <span class="st">"/NHDPLUS_H_2006_HU4_RASTER/HRNHDPlusRasters2006/cat.tif"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Reproject to WGS84 and write out the file with a new name</span></span>
<span><span class="va">cat_rast</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/project.html" class="external-link">project</a></span><span class="op">(</span><span class="va">cat_rast</span>, </span>
<span>                  y <span class="op">=</span> <span class="st">"epsg:4326"</span>, </span>
<span>                  filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">rast_dir</span>, <span class="st">"/NHDPLUS_H_2006_HU4_RASTER/HRNHDPlusRasters2006/cat_wgs84.tif"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract the zonal statistics of bio12 based on the NHDPlus basins</span></span>
<span><span class="va">zonal_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_zonal_stat.html">extract_zonal_stat</a></span><span class="op">(</span>data_dir <span class="op">=</span> <span class="va">out_dir</span>,</span>
<span>                subc_id <span class="op">=</span> <span class="st">"all"</span>, </span>
<span>                subc_layer <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">rast_dir</span>, <span class="st">"/NHDPLUS_H_2006_HU4_RASTER/HRNHDPlusRasters2006/cat_wgs84.tif"</span><span class="op">)</span>,</span>
<span>                var_layer <span class="op">=</span> <span class="st">"bio12_crop.tif"</span>,</span>
<span>                quiet <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Same as before, we need to filter out the no data values to get a better </span></span>
<span><span class="co"># grasp of the resulting table</span></span>
<span><span class="va">zonal_stats</span> <span class="op">&lt;-</span> <span class="va">zonal_stats</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">bio12_crop_data_cells</span> <span class="op">!=</span><span class="fl">0</span> <span class="op">)</span></span>
<span><span class="va">zonal_stats</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="reclassify-raster">Reclassify raster<a class="anchor" aria-label="anchor" href="#reclassify-raster"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create example dataframe with reclassification rules to reclassify the value </span></span>
<span><span class="co"># of all basins containing species data to 1, and all the rest to -99999.</span></span>
<span><span class="va">reclass_rules</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>cat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">spdata_ids</span><span class="op">$</span><span class="va">basin_id</span><span class="op">)</span>, </span>
<span>                            new_val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply reclassification</span></span>
<span><span class="fu"><a href="../reference/reclass_raster.html">reclass_raster</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">reclass_rules</span>,</span>
<span>  rast_val <span class="op">=</span> <span class="st">"cat"</span>,</span>
<span>  new_val <span class="op">=</span> <span class="st">"new_val"</span>,</span>
<span>  raster_layer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">rast_dir</span>, <span class="st">"/NHDPLUS_H_2006_HU4_RASTER/HRNHDPlusRasters2006/cat.tif"</span><span class="op">)</span>,</span>
<span>  recl_layer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">rast_dir</span>, <span class="st">"/NHDPLUS_H_2006_HU4_RASTER/HRNHDPlusRasters2006/cat_reclass.tif"</span><span class="op">)</span>,</span>
<span>  read <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>  no_data <span class="op">=</span> <span class="va">no_data_val</span><span class="op">$</span><span class="va">NoData</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="section">
<!--# Extract from .GPKG --><a class="anchor" aria-label="anchor" href="#section"></a>
</h3>
<!--# See Download NHDPlus data to download NHDPlus vector data for Hawaii. -->
</div>
<div class="section level3">
<h3 id="read-a--gpkg">Read a .GPKG<a class="anchor" aria-label="anchor" href="#read-a--gpkg"></a>
</h3>
<p>See [Download NHDPlus data] to download NHDPlus vector data for
Hawaii.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gdb_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">vect_dir</span>, <span class="st">"/NHDPLUS_H_2006_HU4_GDB"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Write out a .gpkg file based on the .gdb files</span></span>
<span><span class="fu"><a href="https://doi-usgs.github.io/nhdplusTools/reference/get_nhdplushr.html" class="external-link">get_nhdplushr</a></span><span class="op">(</span><span class="va">gdb_dir</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">gdb_dir</span>, <span class="st">"nhdplus_2006-HU4.gpkg"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Import flow line attribute table as a data.table</span></span>
<span><span class="va">flow_line</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_geopackage.html">read_geopackage</a></span><span class="op">(</span>gpkg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">gdb_dir</span>, <span class="st">"/nhdplus_2006-HU4.gpkg"</span><span class="op">)</span>, </span>
<span>                layer_name <span class="op">=</span> <span class="st">"NHDFlowline"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># To import flow line as a graph, first import the attribute table as a </span></span>
<span><span class="co"># data.table and then transform to a graph. Note that the first two columns </span></span>
<span><span class="co"># need to be the "from" and "to" columns</span></span>
<span></span>
<span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setcolorder.html" class="external-link">setcolorder</a></span><span class="op">(</span><span class="va">flow_line</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FromNode"</span>, <span class="st">"ToNode"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create the graph</span></span>
<span><span class="va">flow_line_graph</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://r.igraph.org/reference/graph_from_data_frame.html" class="external-link">graph_from_data_frame</a></span><span class="op">(</span><span class="va">flow_line</span>, directed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Import the catchment layer as a spatial vector</span></span>
<span><span class="va">catchment_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_geopackage.html">read_geopackage</a></span><span class="op">(</span></span>
<span>                gpkg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">gdb_dir</span>, <span class="st">"/nhdplus_2006-HU4.gpkg"</span><span class="op">)</span>, </span>
<span>                layer_name <span class="op">=</span> <span class="st">"NHDPlusCatchment"</span>,</span>
<span>                name <span class="op">=</span> <span class="st">"REACHCODE"</span>,</span>
<span>                import_as <span class="op">=</span> <span class="st">"SpatVect"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="snap-points-to-the-network">Snap points to the network<a class="anchor" aria-label="anchor" href="#snap-points-to-the-network"></a>
</h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define full path to the stream network raster layer</span></span>
<span><span class="va">stream_rast</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">rast_dir</span>, <span class="st">"/NHDPLUS_H_2006_HU4_RASTER/HRNHDPlusRasters2006/swnet.tif"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define full path to the flow accumulation raster layer</span></span>
<span><span class="va">flow_rast</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">rast_dir</span>, </span>
<span>                    <span class="st">"/NHDPLUS_H_2006_HU4_RASTER/HRNHDPlusRasters2006/fac.tif"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define thresholds for the flow accumulation of the stream segment, where</span></span>
<span><span class="co"># the point location should be snapped to</span></span>
<span><span class="va">accu_threshold</span> <span class="op">&lt;-</span> <span class="fl">700</span></span>
<span><span class="co"># Define the distance radius</span></span>
<span><span class="va">dist_radius</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span></span>
<span><span class="co"># Snap point locations to the stream network</span></span>
<span><span class="va">point_locations_snapped</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/snap_to_network.html">snap_to_network</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">spdata_ids</span>,</span>
<span>                                             lon <span class="op">=</span> <span class="st">"longitude"</span>,</span>
<span>                                             lat <span class="op">=</span> <span class="st">"latitude"</span>,</span>
<span>                                             id <span class="op">=</span> <span class="st">"occurrence_id"</span>,</span>
<span>                                             stream_layer <span class="op">=</span> <span class="va">stream_rast</span>,</span>
<span>                                             accu_layer <span class="op">=</span> <span class="va">flow_rast</span>,</span>
<span>                                             method <span class="op">=</span> <span class="st">"both"</span>,</span>
<span>                                             distance <span class="op">=</span> <span class="va">dist_radius</span>,</span>
<span>                                             accumulation <span class="op">=</span> <span class="va">accu_threshold</span>,</span>
<span>                                             quiet <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Note: The columns “subc_id_snap_dist” and “subc_id_snap_accu” of the
table “point_locations_snapped” are only meaningful in case that the
stream and flow accumulation raster layers were derived from the
Hydrography90m.</p>
</div>
<div class="section level3 unnumbered">
<h3 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-R-leafem" class="csl-entry">
Appelhans, Tim. 2022. <em>Leafem: Leaflet Extensions for Mapview</em>.
<a href="https://CRAN.R-project.org/package=leafem" class="external-link">https://CRAN.R-project.org/package=leafem</a>.
</div>
<div id="ref-R-mapview" class="csl-entry">
Appelhans, Tim, Florian Detsch, Christoph Reudenbach, and Stefan
Woellauer. 2022. <em>Mapview: Interactive Viewing of Spatial Data in
r</em>. <a href="https://github.com/r-spatial/mapview" class="external-link">https://github.com/r-spatial/mapview</a>.
</div>
<div id="ref-R-nhdplusTools" class="csl-entry">
Blodgett, David, and Mike Johnson. 2023a. <em>nhdplusTools: NHDPlus
Tools</em>. <a href="https://doi-usgs.github.io/nhdplusTools/%0Ahttps://github.com/doi-usgs/nhdplusTools/" class="external-link">https://doi-usgs.github.io/nhdplusTools/
https://github.com/doi-usgs/nhdplusTools/</a>.
</div>
<div id="ref-nhdplusTools2023" class="csl-entry">
———. 2023b. <em>nhdplusTools: Tools for Accessing and Working with the
NHDPlus</em> (version 0.6.2). Reston, VA: U.S. Geological Survey; U.S.
Geological Survey. <a href="https://doi.org/10.5066/P97AS8JD" class="external-link">https://doi.org/10.5066/P97AS8JD</a>.
</div>
<div id="ref-rgbif2017" class="csl-entry">
Chamberlain, Scott, and Carl Boettiger. 2017. <span>“R Python, and Ruby
Clients for GBIF Species Occurrence Data.”</span> <em>PeerJ
PrePrints</em>. <a href="https://doi.org/10.7287/peerj.preprints.3304v1" class="external-link">https://doi.org/10.7287/peerj.preprints.3304v1</a>.
</div>
<div id="ref-R-rgbif" class="csl-entry">
Chamberlain, Scott, Damiano Oldoni, and John Waller. 2023. <em>Rgbif:
Interface to the Global Biodiversity Information Facility API</em>. <a href="https://CRAN.R-project.org/package=rgbif" class="external-link">https://CRAN.R-project.org/package=rgbif</a>.
</div>
<div id="ref-R-leaflet" class="csl-entry">
Cheng, Joe, Bhaskar Karambelkar, and Yihui Xie. 2023. <em>Leaflet:
Create Interactive Web Maps with the JavaScript Leaflet Library</em>. <a href="https://rstudio.github.io/leaflet/" class="external-link">https://rstudio.github.io/leaflet/</a>.
</div>
<div id="ref-R-archive" class="csl-entry">
Hester, Jim, and Gábor Csárdi. 2022. <em>Archive: Multi-Format Archive
and Compression Support</em>. <a href="https://CRAN.R-project.org/package=archive" class="external-link">https://CRAN.R-project.org/package=archive</a>.
</div>
<div id="ref-R-terra" class="csl-entry">
Hijmans, Robert J. 2023. <em>Terra: Spatial Data Analysis</em>. <a href="https://rspatial.org/" class="external-link">https://rspatial.org/</a>.
</div>
<div id="ref-R-here" class="csl-entry">
Müller, Kirill. 2020. <em>Here: A Simpler Way to Find Your Files</em>.
<a href="https://CRAN.R-project.org/package=here" class="external-link">https://CRAN.R-project.org/package=here</a>.
</div>
<div id="ref-R-base" class="csl-entry">
R Core Team. 2023. <em>R: A Language and Environment for Statistical
Computing</em>. Vienna, Austria: R Foundation for Statistical Computing.
<a href="https://www.R-project.org/" class="external-link">https://www.R-project.org/</a>.
</div>
<div id="ref-R-hydrographr" class="csl-entry">
Schürz, Marlene, Afroditi Grigoropoulou, Jaime Garcia Marquez, Yusdiel
Torres Cambas, Christoph Schürz, Mathieu Floury, Thomas Tomiczek,
Vanessa Bremerich, Giuseppe Amatulli, and Sami Domisch. 2023.
<em>Hydrographr: Scalable Hydrographic Data Processing in r</em>. <a href="https://glowabio.github.io/hydrographr/" class="external-link">https://glowabio.github.io/hydrographr/</a>.
</div>
<div id="ref-R-htmlwidgets" class="csl-entry">
Vaidyanathan, Ramnath, Yihui Xie, JJ Allaire, Joe Cheng, Carson Sievert,
and Kenton Russell. 2023. <em>Htmlwidgets: HTML Widgets for r</em>. <a href="https://github.com/ramnathv/htmlwidgets" class="external-link">https://github.com/ramnathv/htmlwidgets</a>.
</div>
<div id="ref-R-dplyr" class="csl-entry">
Wickham, Hadley, Romain François, Lionel Henry, Kirill Müller, and Davis
Vaughan. 2023. <em>Dplyr: A Grammar of Data Manipulation</em>. <a href="https://CRAN.R-project.org/package=dplyr" class="external-link">https://CRAN.R-project.org/package=dplyr</a>.
</div>
<div id="ref-knitr2014" class="csl-entry">
Xie, Yihui. 2014. <span>“Knitr: A Comprehensive Tool for Reproducible
Research in <span>R</span>.”</span> In <em>Implementing Reproducible
Computational Research</em>, edited by Victoria Stodden, Friedrich
Leisch, and Roger D. Peng. Chapman; Hall/CRC.
</div>
<div id="ref-knitr2015" class="csl-entry">
———. 2015. <em>Dynamic Documents with <span>R</span> and Knitr</em>. 2nd
ed. Boca Raton, Florida: Chapman; Hall/CRC. <a href="https://yihui.org/knitr/" class="external-link">https://yihui.org/knitr/</a>.
</div>
<div id="ref-R-knitr" class="csl-entry">
———. 2023. <em>Knitr: A General-Purpose Package for Dynamic Report
Generation in r</em>. <a href="https://yihui.org/knitr/" class="external-link">https://yihui.org/knitr/</a>.
</div>
<div id="ref-R-kableExtra" class="csl-entry">
Zhu, Hao. 2021. <em>kableExtra: Construct Complex Table with Kable and
Pipe Syntax</em>. <a href="https://CRAN.R-project.org/package=kableExtra" class="external-link">https://CRAN.R-project.org/package=kableExtra</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Marlene Schürz, Afroditi Grigoropoulou, Jaime Garcia Marquez, Yusdiel Torres Cambas, Christoph Schürz, Mathieu Floury, Thomas Tomiczek, Vanessa Bremerich, Giuseppe Amatulli, Sami Domisch.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
