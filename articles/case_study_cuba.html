<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="hydrographr">
<title>Case study - Cuba • hydrographr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Case study - Cuba">
<meta property="og:description" content="hydrographr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">hydrographr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.16</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/hydrographr.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/benchmark.html">Function benchmarks</a>
    <a class="dropdown-item" href="../articles/case_study_brazil.html">Case study - São Francisco drainage basin</a>
    <a class="dropdown-item" href="../articles/case_study_cuba.html">Case study - Cuba</a>
    <a class="dropdown-item" href="../articles/example_other_stream_networks.html">Usage of hydrographr with other stream networks</a>
    <a class="dropdown-item" href="../articles/linux_system_setup.html">Setting up the package requirements on Linux</a>
    <a class="dropdown-item" href="../articles/macos_system_setup.html">Setting up the package requirements on MacOS</a>
    <a class="dropdown-item" href="../articles/windows_system_setup.html">Setting up the package requirements on Windows</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/glowabio/hydrographr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="case_study_cuba_files/kePrint-0.0.1/kePrint.js"></script><link href="case_study_cuba_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Case study - Cuba</h1>
            <h3 data-toc-skip class="subtitle">Processing of spatial
data before and after a Species Distribution Model</h3>
                        <h4 data-toc-skip class="author"></h4>
            
            <h4 data-toc-skip class="date">2023-10-31</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/glowabio/hydrographr/blob/HEAD/vignettes/case_study_cuba.Rmd" class="external-link"><code>vignettes/case_study_cuba.Rmd</code></a></small>
      <div class="d-none name"><code>case_study_cuba.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>The following example showcases the functionality of the hydrographr
package along a species distribution modelling (SDM) workflow. We will
use an SDM to predict the suitable habitats of a dragonfly species in
Cuba. We will start by defining the regular tiles of the Hydrography90m
(Amatulli et al., 2022) where the occurrence points of the species are
located. Afterwards we will download the Hydrography90m and CHELSA
Bioclim (Karger &amp; Zimmermann, 2019) layers of the predictor
variables, crop them and merge them, if necessary. Then, we will
aggregate the variable values within each sub-catchment of the study
area, keeping as predictors their mean and SD per sub-catchment. Using
the random forest (RF) algorithm, we will build a simple SDM and predict
where the species could potentially occur. Finally, we will reclassify
the layer of all the sub-catchments in the study area, creating a
habitat suitability map.</p>
<p><img src="../reference/figures/wf_0.png"></p>
<!--![](../man/figures/SDM.png)-->
<p><a href="https://www.gbif.org/species/1424240" class="external-link"><em>Hypolestes
trinitatis</em></a> is a damselfly species endemic to Cuba. The species
inhabits rivers and streams located in forest areas at the main mountain
ranges of eastern and central Cuba. The presence of riparian forests as
well as clean and well oxygenated water seems to be important ecological
conditions required by <em>H. trinitatis</em>. Larvae can be found
clinging to boulders and cobbles in the river bed at fast-flowing water
stream segments and pre-reproductive adults of both sexes and sexually
mature females remain most of the time in the vegetation of the riparian
forest where they find shelter and prey.</p>
<p>Let’s get started!</p>
<p>Load required libraries</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://glowabio.github.io/hydrographr/" class="external-link">hydrographr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">tools</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/imbs-hl/ranger" class="external-link">ranger</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/leaflet/" class="external-link">leaflet</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/leafem" class="external-link">leafem</a></span><span class="op">)</span></span></code></pre></div>
<p>Define working directory</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define the "data_cuba" directory, where you have downloaded all the data,</span></span>
<span><span class="co"># as the working directory</span></span>
<span><span class="va">wdir</span> <span class="op">&lt;-</span> <span class="st">"my/working/directory/data_cuba"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="va">wdir</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a new folder in the working directory to store all the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="species-data">Species data<a class="anchor" aria-label="anchor" href="#species-data"></a>
</h3>
<p>We will start by downloading a dataset including aquatic insect
occurrence records in Cuba from <a href="https://doi.org/10.18728/igb-fred-778.3" class="external-link uri">https://doi.org/10.18728/igb-fred-778.3</a> (Cambas &amp;
Salina, 2022).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="st">"https://fred.igb-berlin.de/data/file_download/1395"</span>,</span>
<span>              destfile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">wdir</span>, <span class="st">"/data/spdata_cuba.csv"</span><span class="op">)</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span></code></pre></div>
<p>Import the dataset and select the occurrences of the species of
interest, sampled after the year 1980 (to match with the climate
data)</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">wdir</span>, <span class="st">"/data/spdata_cuba.csv"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"\t"</span>, fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>          <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="st">"Hypolestes_trinitatis"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>          <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">&gt;</span> <span class="fl">1980</span><span class="op">)</span></span></code></pre></div>
<p>Subset columns</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spdata</span> <span class="op">&lt;-</span> <span class="va">spdata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"occurrence_ID"</span>, <span class="st">"species"</span>, <span class="st">"longitude"</span>, <span class="st">"latitude"</span>, <span class="st">"year"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spdata</span></span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:200px; overflow-x: scroll; width:500px; ">
<table class="table table table-striped" style="width: auto !important; ">
<thead><tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
occurrence_ID
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
species
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
longitude
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
latitude
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
year
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
107705340
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-75.73
</td>
<td style="text-align:right;">
20.01
</td>
<td style="text-align:right;">
2006
</td>
</tr>
<tr>
<td style="text-align:right;">
107705519
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-75.37
</td>
<td style="text-align:right;">
20.40
</td>
<td style="text-align:right;">
2003
</td>
</tr>
<tr>
<td style="text-align:right;">
107705533
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-75.78
</td>
<td style="text-align:right;">
20.50
</td>
<td style="text-align:right;">
1998
</td>
</tr>
<tr>
<td style="text-align:right;">
107705535
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-77.03
</td>
<td style="text-align:right;">
20.20
</td>
<td style="text-align:right;">
1998
</td>
</tr>
<tr>
<td style="text-align:right;">
107705546
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-74.81
</td>
<td style="text-align:right;">
20.44
</td>
<td style="text-align:right;">
2008
</td>
</tr>
<tr>
<td style="text-align:right;">
107705657
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-75.76
</td>
<td style="text-align:right;">
20.09
</td>
<td style="text-align:right;">
2012
</td>
</tr>
<tr>
<td style="text-align:right;">
107705727
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-80.06
</td>
<td style="text-align:right;">
21.96
</td>
<td style="text-align:right;">
2015
</td>
</tr>
<tr>
<td style="text-align:right;">
107705733
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-76.04
</td>
<td style="text-align:right;">
20.03
</td>
<td style="text-align:right;">
2011
</td>
</tr>
<tr>
<td style="text-align:right;">
107705744
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-74.71
</td>
<td style="text-align:right;">
20.44
</td>
<td style="text-align:right;">
2004
</td>
</tr>
<tr>
<td style="text-align:right;">
107705863
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-75.76
</td>
<td style="text-align:right;">
20.09
</td>
<td style="text-align:right;">
2004
</td>
</tr>
<tr>
<td style="text-align:right;">
107706093
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-76.77
</td>
<td style="text-align:right;">
20.00
</td>
<td style="text-align:right;">
1996
</td>
</tr>
<tr>
<td style="text-align:right;">
107706107
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-75.44
</td>
<td style="text-align:right;">
20.58
</td>
<td style="text-align:right;">
2001
</td>
</tr>
<tr>
<td style="text-align:right;">
107706146
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-75.34
</td>
<td style="text-align:right;">
20.53
</td>
<td style="text-align:right;">
2001
</td>
</tr>
<tr>
<td style="text-align:right;">
107706216
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-75.44
</td>
<td style="text-align:right;">
20.58
</td>
<td style="text-align:right;">
2001
</td>
</tr>
<tr>
<td style="text-align:right;">
107706217
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-75.53
</td>
<td style="text-align:right;">
20.54
</td>
<td style="text-align:right;">
2001
</td>
</tr>
<tr>
<td style="text-align:right;">
107706218
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-75.53
</td>
<td style="text-align:right;">
20.54
</td>
<td style="text-align:right;">
2001
</td>
</tr>
<tr>
<td style="text-align:right;">
107706240
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-76.31
</td>
<td style="text-align:right;">
20.21
</td>
<td style="text-align:right;">
2003
</td>
</tr>
<tr>
<td style="text-align:right;">
107706332
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-75.77
</td>
<td style="text-align:right;">
20.41
</td>
<td style="text-align:right;">
2001
</td>
</tr>
<tr>
<td style="text-align:right;">
107706355
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-75.66
</td>
<td style="text-align:right;">
20.61
</td>
<td style="text-align:right;">
2001
</td>
</tr>
<tr>
<td style="text-align:right;">
107706359
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-75.66
</td>
<td style="text-align:right;">
20.46
</td>
<td style="text-align:right;">
2001
</td>
</tr>
<tr>
<td style="text-align:right;">
107706363
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-75.74
</td>
<td style="text-align:right;">
20.58
</td>
<td style="text-align:right;">
2000
</td>
</tr>
<tr>
<td style="text-align:right;">
107706366
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-75.65
</td>
<td style="text-align:right;">
20.60
</td>
<td style="text-align:right;">
2001
</td>
</tr>
<tr>
<td style="text-align:right;">
107706369
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-75.64
</td>
<td style="text-align:right;">
20.65
</td>
<td style="text-align:right;">
2000
</td>
</tr>
<tr>
<td style="text-align:right;">
107706370
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-75.69
</td>
<td style="text-align:right;">
20.60
</td>
<td style="text-align:right;">
1999
</td>
</tr>
<tr>
<td style="text-align:right;">
107706375
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-75.71
</td>
<td style="text-align:right;">
20.44
</td>
<td style="text-align:right;">
2000
</td>
</tr>
<tr>
<td style="text-align:right;">
107706378
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-75.77
</td>
<td style="text-align:right;">
20.45
</td>
<td style="text-align:right;">
1999
</td>
</tr>
<tr>
<td style="text-align:right;">
107706384
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-75.65
</td>
<td style="text-align:right;">
20.60
</td>
<td style="text-align:right;">
2001
</td>
</tr>
<tr>
<td style="text-align:right;">
107706385
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-75.65
</td>
<td style="text-align:right;">
20.60
</td>
<td style="text-align:right;">
2001
</td>
</tr>
<tr>
<td style="text-align:right;">
107706386
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-75.66
</td>
<td style="text-align:right;">
20.46
</td>
<td style="text-align:right;">
2000
</td>
</tr>
<tr>
<td style="text-align:right;">
107706387
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-75.66
</td>
<td style="text-align:right;">
20.46
</td>
<td style="text-align:right;">
2001
</td>
</tr>
<tr>
<td style="text-align:right;">
107706388
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-75.77
</td>
<td style="text-align:right;">
20.45
</td>
<td style="text-align:right;">
1999
</td>
</tr>
<tr>
<td style="text-align:right;">
107706420
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-76.11
</td>
<td style="text-align:right;">
20.07
</td>
<td style="text-align:right;">
2005
</td>
</tr>
<tr>
<td style="text-align:right;">
107706436
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-74.84
</td>
<td style="text-align:right;">
20.43
</td>
<td style="text-align:right;">
1998
</td>
</tr>
<tr>
<td style="text-align:right;">
107706561
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-75.37
</td>
<td style="text-align:right;">
20.40
</td>
<td style="text-align:right;">
2004
</td>
</tr>
<tr>
<td style="text-align:right;">
107706589
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-77.04
</td>
<td style="text-align:right;">
20.09
</td>
<td style="text-align:right;">
1998
</td>
</tr>
<tr>
<td style="text-align:right;">
107706709
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-74.99
</td>
<td style="text-align:right;">
20.48
</td>
<td style="text-align:right;">
2003
</td>
</tr>
<tr>
<td style="text-align:right;">
107706715
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-75.39
</td>
<td style="text-align:right;">
20.57
</td>
<td style="text-align:right;">
2004
</td>
</tr>
<tr>
<td style="text-align:right;">
107706720
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-76.66
</td>
<td style="text-align:right;">
20.04
</td>
<td style="text-align:right;">
2004
</td>
</tr>
<tr>
<td style="text-align:right;">
107706807
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-75.06
</td>
<td style="text-align:right;">
20.46
</td>
<td style="text-align:right;">
2003
</td>
</tr>
<tr>
<td style="text-align:right;">
107706909
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-75.70
</td>
<td style="text-align:right;">
19.96
</td>
<td style="text-align:right;">
2001
</td>
</tr>
<tr>
<td style="text-align:right;">
107706916
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-75.75
</td>
<td style="text-align:right;">
20.05
</td>
<td style="text-align:right;">
1996
</td>
</tr>
<tr>
<td style="text-align:right;">
107706937
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-74.91
</td>
<td style="text-align:right;">
20.39
</td>
<td style="text-align:right;">
2003
</td>
</tr>
<tr>
<td style="text-align:right;">
107706938
</td>
<td style="text-align:left;">
Hypolestes_trinitatis
</td>
<td style="text-align:right;">
-75.13
</td>
<td style="text-align:right;">
20.52
</td>
<td style="text-align:right;">
2003
</td>
</tr>
</tbody>
</table>
</div>
<p>Let’s visualise the species occurrences on the map</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert species data to a spatial vector object to plot the points</span></span>
<span><span class="va">spdata_vect</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">spdata</span>, geom<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Let’s define the extent (bounding box) of the study area (xmin, ymin,
xmax, ymax)</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">84.9749110583</span>, <span class="fl">19.8554808619</span>, <span class="op">-</span><span class="fl">74.1780248685</span>, <span class="fl">23.1886107447</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/leaflet.html" class="external-link">leaflet</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addProviderTiles.html" class="external-link">addProviderTiles</a></span><span class="op">(</span><span class="st">'Esri.WorldShadedRelief'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-methods.html" class="external-link">setMaxBounds</a></span><span class="op">(</span><span class="va">bbox</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bbox</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bbox</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">bbox</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-layers.html" class="external-link">addCircles</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">spdata_vect</span>, color <span class="op">=</span> <span class="st">"purple"</span><span class="op">)</span> <span class="co"># data = spdata</span></span>
<span></span>
<span><span class="va">m</span></span></code></pre></div>
<p><img src="../reference/figures/cuba_map.png"></p>
</div>
<div class="section level3">
<h3 id="download-files">Download files<a class="anchor" aria-label="anchor" href="#download-files"></a>
</h3>
<p>In order to download layers of the Hydrography90m, we need to know
the IDs of the 20°x20° tiles in which they are located. We can obtain
these IDs using the function <em>get_tile_id()</em>. This function
downloads and uses the auxiliary raster file that contains all the
regional units globally, and thus requires an active internet
connection.</p>
<!--![](../man/figures/wf_1.png)-->
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tile_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_tile_id.html">get_tile_id</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">spdata</span>, lon <span class="op">=</span> <span class="st">"longitude"</span>, lat <span class="op">=</span> <span class="st">"latitude"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tile_id</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "h08v06" "h10v04" "h10v06"</span></span></code></pre>
<p>Currently the function returns all the tiles of the regional unit
where the input points are located. However, some of them may be far
from the study area and hence not always needed in further steps. Please
double check which tile IDs are relevant for your purpose using the
<strong>Tile map</strong> found <a href="https://hydrography.org/hydrography90m/hydrography90m_layers/" class="external-link">here</a>.</p>
<p>In our case, Cuba spreads across two tiles, which hold the IDs
“h08v06” and “h10v06”, so we will keep only these two.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tile_id</span> <span class="op">&lt;-</span> <span class="va">tile_id</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<!--![](../man/figures/wf_2.png)-->
<p>Let’s define the Hydrography90m variables that we would like to
download. We will use the variables <a href="https://hydrography.org/hydrography90m/hydrography90m_layers#stream-slope-layers" class="external-link">slope_curv_max_dw_cel</a>
(maximum curvature between the highest upstream, focal and downstream
cell) and <a href="https://geo.igb-berlin.de/maps/new?layer=geonode:hydrography90m_v1_spi_cog&amp;view=True" class="external-link">spi</a>
(Stream Power Index) and <a href="https://hydrography.org/hydrography90m/hydrography90m_layers/#stream-order-layers" class="external-link">stream
length</a> as predictors in our model.</p>
<p>Additionally, we will download the <a href="https://geo.igb-berlin.de/maps/new?layer=geonode:hydrography90m_v1_sub_catchment_cog&amp;view=True" class="external-link">sub_catchment</a>
layer, which is the necessary base-layer for the workflow.</p>
<p>A list of all available Hydrography90m variables, as well as details
and visualisations are available <a href="https://hydrography.org/hydrography90m/hydrography90m_layers/" class="external-link">here</a>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Variables in raster format</span></span>
<span><span class="va">vars_tif</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sub_catchment"</span>, <span class="st">"slope_curv_max_dw_cel"</span>, <span class="st">"spi"</span><span class="op">)</span></span>
<span><span class="co"># Variables in vector format. This layerholds the information on stream length</span></span>
<span><span class="va">vars_gpkg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"order_vect_point"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Download the .tif tiles of the desired variables</span></span>
<span><span class="fu"><a href="../reference/download_tiles.html">download_tiles</a></span><span class="op">(</span>variable <span class="op">=</span> <span class="va">vars_tif</span>, tile_id <span class="op">=</span> <span class="va">tile_id</span>, file_format <span class="op">=</span> <span class="st">"tif"</span>,</span>
<span>              download_dir <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Download the .gpkg tiles of the desired variables</span></span>
<span><span class="fu"><a href="../reference/download_tiles.html">download_tiles</a></span><span class="op">(</span>variable <span class="op">=</span> <span class="va">vars_gpkg</span>, tile_id <span class="op">=</span> <span class="va">tile_id</span>, file_format <span class="op">=</span> <span class="st">"gpkg"</span>,</span>
<span>              download_dir <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span></span></code></pre></div>
<p>Then download the CHELSA present and future Bioclim variables</p>
<p>For a quick outlook on the bioclimatic variables you can have a look
<a href="https://chelsa-climate.org/bioclim/" class="external-link">here</a>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create download directory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">wdir</span>, <span class="st">"/data/chelsa_bioclim"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extend timeout to 1000s to allow uninterrupted downloading</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>timeout <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Download</span></span>
<span><span class="co"># Present, 1981-2010</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="st">"https://os.zhdk.cloud.switch.ch/envicloud/chelsa/chelsa_V2/GLOBAL/climatologies/1981-2010/bio/CHELSA_bio12_1981-2010_V.2.1.tif"</span>,</span>
<span>destfile <span class="op">=</span> <span class="st">"data/chelsa_bioclim/bio12_1981-2010.tif"</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="st">"https://os.zhdk.cloud.switch.ch/envicloud/chelsa/chelsa_V2/GLOBAL/climatologies/1981-2010/bio/CHELSA_bio15_1981-2010_V.2.1.tif"</span>,</span>
<span>destfile <span class="op">=</span> <span class="st">"data/chelsa_bioclim/bio15_1981-2010.tif"</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="st">"https://os.zhdk.cloud.switch.ch/envicloud/chelsa/chelsa_V2/GLOBAL/climatologies/1981-2010/bio/CHELSA_bio1_1981-2010_V.2.1.tif"</span>,</span>
<span>destfile <span class="op">=</span> <span class="st">"data/chelsa_bioclim/bio1_1981-2010.tif"</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span>
<span><span class="co"># Future, 2041-2070</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="st">"https://os.zhdk.cloud.switch.ch/envicloud/chelsa/chelsa_V2/GLOBAL/climatologies/2041-2070/IPSL-CM6A-LR/ssp370/bio/CHELSA_bio12_2041-2070_ipsl-cm6a-lr_ssp370_V.2.1.tif"</span>,</span>
<span>destfile <span class="op">=</span> <span class="st">"data/chelsa_bioclim/bio12_IPSL-CM6A-LR_ssp370_2041-2070.tif"</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="st">"https://os.zhdk.cloud.switch.ch/envicloud/chelsa/chelsa_V2/GLOBAL/climatologies/2041-2070/IPSL-CM6A-LR/ssp370/bio/CHELSA_bio15_2041-2070_ipsl-cm6a-lr_ssp370_V.2.1.tif"</span>,</span>
<span>destfile <span class="op">=</span> <span class="st">"data/chelsa_bioclim/bio15_IPSL-CM6A-LR_ssp370_2041-2070.tif"</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="st">"https://os.zhdk.cloud.switch.ch/envicloud/chelsa/chelsa_V2/GLOBAL/climatologies/2041-2070/IPSL-CM6A-LR/ssp370/bio/CHELSA_bio1_2041-2070_ipsl-cm6a-lr_ssp370_V.2.1.tif"</span>,</span>
<span>destfile <span class="op">=</span> <span class="st">"data/chelsa_bioclim/bio1_IPSL-CM6A-LR_ssp370_2041-2070.tif"</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/folder_structure.png"></p>
</div>
<div class="section level3">
<h3 id="cropping">Cropping<a class="anchor" aria-label="anchor" href="#cropping"></a>
</h3>
<!--![](../man/figures/wf_3.png)-->
<p>After having downloaded all the layers, we need to crop them to the
extent of our study area. This is straightforward in the case of the
global CHELSA layers:</p>
<p>We define the directory containing the layers to be cropped</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dirs_chelsa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">wdir</span>, <span class="st">"/data/chelsa_bioclim"</span><span class="op">)</span></span></code></pre></div>
<p>… and the final output directory</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define output directory for merged files</span></span>
<span><span class="va">layer_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">wdir</span>, <span class="st">"/data/final_layers"</span><span class="op">)</span></span>
<span><span class="co"># Create the directory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">layer_dir</span><span class="op">)</span></span></code></pre></div>
<p>We then crop the files using the function <em>crop_to_extent()</em>
in a loop</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">files_chelsa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">dirs_chelsa</span>, pattern <span class="op">=</span> <span class="st">".tif"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">ifile</span> <span class="kw">in</span> <span class="va">files_chelsa</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/crop_to_extent.html">crop_to_extent</a></span><span class="op">(</span></span>
<span>      raster_layer <span class="op">=</span> <span class="va">ifile</span>,</span>
<span>      bounding_box <span class="op">=</span> <span class="va">bbox</span>,</span>
<span>      out_dir <span class="op">=</span> <span class="va">layer_dir</span>,</span>
<span>      file_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">ifile</span><span class="op">)</span>,</span>
<span>      read <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>However, the hydrographic variable <em>slope_curv_max_dw_cel</em>
(the maximum curvature between the highest upstream, the focal, and the
downstream cell) is split across two tiles. We highly recommend to first
crop the tiles to the extent of the study area to limit their size, and
afterwards merge them into one file.</p>
<p>Again, we will first define the input directories, but this time we
will store the cropped files in the same directory as the input files,
as there is an extra step before reaching to the final output.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dirs_h90m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.dirs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">wdir</span>, <span class="st">"/data"</span><span class="op">)</span>,</span>
<span>                       recursive <span class="op">=</span> <span class="cn">TRUE</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dirs_h90m</span> <span class="op">&lt;-</span> <span class="va">dirs_h90m</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"tiles20d"</span>, <span class="va">dirs_h90m</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span><span class="op">(</span><span class="va">idir</span> <span class="kw">in</span> <span class="va">dirs_h90m</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># only choose rasters</span></span>
<span>  <span class="va">tiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">idir</span>, pattern <span class="op">=</span> <span class="st">".tif$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">itile</span> <span class="kw">in</span> <span class="va">tiles</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="../reference/crop_to_extent.html">crop_to_extent</a></span><span class="op">(</span></span>
<span>        raster_layer <span class="op">=</span> <span class="va">itile</span>,</span>
<span>        bounding_box <span class="op">=</span> <span class="va">bbox</span>,</span>
<span>        out_dir <span class="op">=</span> <span class="va">idir</span>,</span>
<span>        file_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">itile</span><span class="op">)</span>, <span class="st">".tif"</span><span class="op">)</span>, <span class="st">"_crop.tif"</span><span class="op">)</span>,</span>
<span>        read <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="merging">Merging<a class="anchor" aria-label="anchor" href="#merging"></a>
</h3>
<!--![](../man/figures/wf_4.png)-->
<p>The cropped tiles of the variable now need to be merged together.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This can be done sequentially:</span></span>
<span><span class="va">idir</span> <span class="op">&lt;-</span> <span class="va">dirs_h90m</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu"><a href="../reference/merge_tiles.html">merge_tiles</a></span><span class="op">(</span>tile_dir <span class="op">=</span> <span class="va">idir</span>,</span>
<span>            tile_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">idir</span>, full.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                    pattern <span class="op">=</span> <span class="st">"_crop.tif"</span><span class="op">)</span>,</span>
<span>            out_dir <span class="op">=</span> <span class="va">layer_dir</span>,</span>
<span>            file_name <span class="op">=</span> <span class="st">"spi.tif"</span>,</span>
<span>            read <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">idir</span> <span class="op">&lt;-</span> <span class="va">dirs_h90m</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="fu"><a href="../reference/merge_tiles.html">merge_tiles</a></span><span class="op">(</span>tile_dir <span class="op">=</span> <span class="va">idir</span>,</span>
<span>            tile_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">idir</span>, full.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                    pattern <span class="op">=</span> <span class="st">"_crop.tif"</span><span class="op">)</span>,</span>
<span>            out_dir <span class="op">=</span> <span class="va">layer_dir</span>,</span>
<span>            file_name <span class="op">=</span> <span class="st">"slope_curv_max_dw_cel.tif"</span>,</span>
<span>            read <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">idir</span> <span class="op">&lt;-</span> <span class="va">dirs_h90m</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="fu"><a href="../reference/merge_tiles.html">merge_tiles</a></span><span class="op">(</span>tile_dir <span class="op">=</span> <span class="va">idir</span>,</span>
<span>            tile_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">idir</span>, full.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                    pattern <span class="op">=</span> <span class="st">"_crop.tif"</span><span class="op">)</span>,</span>
<span>            out_dir <span class="op">=</span> <span class="va">layer_dir</span>,</span>
<span>            file_name <span class="op">=</span> <span class="st">"sub_catchment.tif"</span>,</span>
<span>            read <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># ...or in a loop</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">idir</span> <span class="kw">in</span> <span class="va">dirs_h90m</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Get input file extension</span></span>
<span>  <span class="va">file_extension</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/tools/fileutils.html" class="external-link">file_ext</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">idir</span>, full.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Assign file extension to output files</span></span>
<span>  <span class="va">ivar_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">idir</span><span class="op">)</span>, <span class="st">"_tiles20d"</span><span class="op">)</span>, <span class="st">"."</span>, <span class="va">file_extension</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Run the function</span></span>
<span>  <span class="fu"><a href="../reference/merge_tiles.html">merge_tiles</a></span><span class="op">(</span>tile_dir <span class="op">=</span> <span class="va">idir</span>,</span>
<span>              tile_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">idir</span>, full.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                      pattern <span class="op">=</span> <span class="st">"_crop.tif"</span><span class="op">)</span>,</span>
<span>              out_dir <span class="op">=</span> <span class="va">layer_dir</span>,</span>
<span>              file_name <span class="op">=</span> <span class="va">ivar_name</span>,</span>
<span>              read <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>              bigtiff <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="extraction-of-sub-catchment-ids">Extraction of sub-catchment IDs<a class="anchor" aria-label="anchor" href="#extraction-of-sub-catchment-ids"></a>
</h3>
<p>Extract the IDs of the sub-catchments where the points are located.
This step is crucial, as many of the functions that we will later use
require a vector of sub-catchment IDs as input. Note that the function
<em>extract_ids()</em> can be used to extract the values at specific
points of any raster file provided to the argument <em>subc_layer</em>.
It can be safely used to query very large raster files, as these are not
loaded into R.</p>
<!--![](../man/figures/wf_5.png)-->
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spdata_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_ids.html">extract_ids</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">spdata</span>, lon <span class="op">=</span> <span class="st">"longitude"</span>, lat <span class="op">=</span> <span class="st">"latitude"</span>,</span>
<span>                          id <span class="op">=</span> <span class="st">"occurrence_ID"</span>, quiet <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                          subc_layer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">layer_dir</span>, <span class="st">"/sub_catchment.tif"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>
The species data have now their corresponding sub-catchment ids
</caption>
<thead><tr>
<th style="text-align:right;">
longitude
</th>
<th style="text-align:right;">
latitude
</th>
<th style="text-align:right;">
occurrence_ID
</th>
<th style="text-align:right;">
subcatchment_id
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
-75.73
</td>
<td style="text-align:right;">
20.01
</td>
<td style="text-align:right;">
107705340
</td>
<td style="text-align:right;">
422886180
</td>
</tr>
<tr>
<td style="text-align:right;">
-75.37
</td>
<td style="text-align:right;">
20.40
</td>
<td style="text-align:right;">
107705519
</td>
<td style="text-align:right;">
422816272
</td>
</tr>
<tr>
<td style="text-align:right;">
-75.78
</td>
<td style="text-align:right;">
20.50
</td>
<td style="text-align:right;">
107705533
</td>
<td style="text-align:right;">
422801107
</td>
</tr>
<tr>
<td style="text-align:right;">
-77.03
</td>
<td style="text-align:right;">
20.20
</td>
<td style="text-align:right;">
107705535
</td>
<td style="text-align:right;">
422851157
</td>
</tr>
<tr>
<td style="text-align:right;">
-74.81
</td>
<td style="text-align:right;">
20.44
</td>
<td style="text-align:right;">
107705546
</td>
<td style="text-align:right;">
422809465
</td>
</tr>
<tr>
<td style="text-align:right;">
-75.76
</td>
<td style="text-align:right;">
20.09
</td>
<td style="text-align:right;">
107705657
</td>
<td style="text-align:right;">
422872031
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="aggregation-of-environmental-layers">Aggregation of environmental layers<a class="anchor" aria-label="anchor" href="#aggregation-of-environmental-layers"></a>
</h3>
<p>We will calculate the zonal statistics of the Hydrography90m and the
CHELSA Bioclim variables for all the sub-catchments of the study area.
Caution, don’t increase the number of cores to more than 3 as this can
cause memory problems. However, this highly depends to the number of
sub-catchments as well. We recommend to test the function with different
parameters to find out what works best for your case.</p>
<!--![](../man/figures/wf_6.png)-->
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define input var_layers for the extract_zonal_stat() function</span></span>
<span><span class="va">var_layers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">layer_dir</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">9</span><span class="op">]</span></span>
<span><span class="co"># var_layers &lt;- list.files(layer_dir)[c(3,5,7)]</span></span>
<span><span class="va">var_layers</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## [1] "bio1_1981-2010.tif"                     </span></span>
<span><span class="co">## [2] "bio1_IPSL-CM6A-LR_ssp370_2041-2070.tif"</span></span>
<span><span class="co">## [3] "bio12_1981-2010.tif"                    </span></span>
<span><span class="co">## [4] "bio12_IPSL-CM6A-LR_ssp370_2041-2070.tif"</span></span>
<span><span class="co">## [5] "bio15_1981-2010.tif"                    </span></span>
<span><span class="co">## [6] "bio15_IPSL-CM6A-LR_ssp370_2041-2070.tif"</span></span>
<span><span class="co">## [7] "slope_curv_max_dw_cel.tif"              </span></span>
<span><span class="co">## [8] "spi.tif"</span></span></code></pre></div>
<p>A good practice before aggregating the variables is to check their
NoData values:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/report_no_data.html">report_no_data</a></span><span class="op">(</span>data_dir <span class="op">=</span> <span class="va">layer_dir</span>, var_layer <span class="op">=</span> <span class="va">var_layers</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##                                    Raster   NoData</span></span>
<span><span class="co">## 1                     bio15_1981-2010.tif        0</span></span>
<span><span class="co">## 2                      bio1_1981-2010.tif        0</span></span>
<span><span class="co">## 3  bio1_IPSL-CM6A-LR_ssp370_2041-2070.tif        0</span></span>
<span><span class="co">## 4                     bio12_1981-2010.tif        0</span></span>
<span><span class="co">## 5 bio12_IPSL-CM6A-LR_ssp370_2041-2070.tif        0</span></span>
<span><span class="co">## 6 bio15_IPSL-CM6A-LR_ssp370_2041-2070.tif        0</span></span>
<span><span class="co">## 7               slope_curv_max_dw_cel.tif -9999999</span></span>
<span><span class="co">## 8                                 spi.tif -9999999</span></span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run the function that returns the zonal statistics</span></span>
<span><span class="va">stats_table_zon</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_zonal_stat.html">extract_zonal_stat</a></span><span class="op">(</span></span>
<span>                    data_dir <span class="op">=</span> <span class="va">layer_dir</span>,</span>
<span>                    subc_layer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">layer_dir</span>, <span class="st">"/sub_catchment.tif"</span><span class="op">)</span>,</span>
<span>                    subc_id <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>                    var_layer <span class="op">=</span> <span class="va">var_layers</span>,</span>
<span>                    out_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">wdir</span>, <span class="st">"/data"</span><span class="op">)</span>,</span>
<span>                    file_name <span class="op">=</span> <span class="st">"zonal_stats.csv"</span>,</span>
<span>                    n_cores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>The function also reports the NoData values that are used in the
calculation of the zonal statistics of each variable.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read the previously created file</span></span>
<span><span class="va">stats_table_zon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">wdir</span>, <span class="st">"/data/zonal_stats.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Let’s inspect the resulting table</p>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:200px; overflow-x: scroll; width:800px; ">
<table class="table table table-striped" style="width: auto !important; ">
<thead><tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
subc_id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_1981.2010_data_cells
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_1981.2010_nodata_cells
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_1981.2010_min
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_1981.2010_max
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_1981.2010_range
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_1981.2010_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_1981.2010_mean_abs
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_1981.2010_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_1981.2010_var
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_1981.2010_cv
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_1981.2010_sum
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_1981.2010_sum_abs
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_IPSL.CM6A.LR_ssp370_2041.2070_data_cells
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_IPSL.CM6A.LR_ssp370_2041.2070_nodata_cells
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_IPSL.CM6A.LR_ssp370_2041.2070_min
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_IPSL.CM6A.LR_ssp370_2041.2070_max
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_IPSL.CM6A.LR_ssp370_2041.2070_range
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_IPSL.CM6A.LR_ssp370_2041.2070_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_IPSL.CM6A.LR_ssp370_2041.2070_mean_abs
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_IPSL.CM6A.LR_ssp370_2041.2070_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_IPSL.CM6A.LR_ssp370_2041.2070_var
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_IPSL.CM6A.LR_ssp370_2041.2070_cv
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_IPSL.CM6A.LR_ssp370_2041.2070_sum
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_IPSL.CM6A.LR_ssp370_2041.2070_sum_abs
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_1981.2010_data_cells
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_1981.2010_nodata_cells
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_1981.2010_min
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_1981.2010_max
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_1981.2010_range
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_1981.2010_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_1981.2010_mean_abs
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_1981.2010_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_1981.2010_var
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_1981.2010_cv
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_1981.2010_sum
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_1981.2010_sum_abs
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_IPSL.CM6A.LR_ssp370_2041.2070_data_cells
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_IPSL.CM6A.LR_ssp370_2041.2070_nodata_cells
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_IPSL.CM6A.LR_ssp370_2041.2070_min
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_IPSL.CM6A.LR_ssp370_2041.2070_max
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_IPSL.CM6A.LR_ssp370_2041.2070_range
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_IPSL.CM6A.LR_ssp370_2041.2070_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_IPSL.CM6A.LR_ssp370_2041.2070_mean_abs
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_IPSL.CM6A.LR_ssp370_2041.2070_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_IPSL.CM6A.LR_ssp370_2041.2070_var
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_IPSL.CM6A.LR_ssp370_2041.2070_cv
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_IPSL.CM6A.LR_ssp370_2041.2070_sum
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_IPSL.CM6A.LR_ssp370_2041.2070_sum_abs
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_1981.2010_data_cells
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_1981.2010_nodata_cells
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_1981.2010_min
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_1981.2010_max
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_1981.2010_range
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_1981.2010_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_1981.2010_mean_abs
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_1981.2010_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_1981.2010_var
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_1981.2010_cv
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_1981.2010_sum
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_1981.2010_sum_abs
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_IPSL.CM6A.LR_ssp370_2041.2070_data_cells
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_IPSL.CM6A.LR_ssp370_2041.2070_nodata_cells
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_IPSL.CM6A.LR_ssp370_2041.2070_min
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_IPSL.CM6A.LR_ssp370_2041.2070_max
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_IPSL.CM6A.LR_ssp370_2041.2070_range
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_IPSL.CM6A.LR_ssp370_2041.2070_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_IPSL.CM6A.LR_ssp370_2041.2070_mean_abs
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_IPSL.CM6A.LR_ssp370_2041.2070_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_IPSL.CM6A.LR_ssp370_2041.2070_var
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_IPSL.CM6A.LR_ssp370_2041.2070_cv
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_IPSL.CM6A.LR_ssp370_2041.2070_sum
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_IPSL.CM6A.LR_ssp370_2041.2070_sum_abs
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
slope_curv_max_dw_cel_data_cells
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
slope_curv_max_dw_cel_nodata_cells
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
slope_curv_max_dw_cel_min
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
slope_curv_max_dw_cel_max
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
slope_curv_max_dw_cel_range
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
slope_curv_max_dw_cel_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
slope_curv_max_dw_cel_mean_abs
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
slope_curv_max_dw_cel_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
slope_curv_max_dw_cel_var
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
slope_curv_max_dw_cel_cv
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
slope_curv_max_dw_cel_sum
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
slope_curv_max_dw_cel_sum_abs
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
spi_data_cells
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
spi_nodata_cells
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
spi_min
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
spi_max
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
spi_range
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
spi_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
spi_mean_abs
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
spi_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
spi_var
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
spi_cv
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
spi_sum
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
spi_sum_abs
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
399592461
</td>
<td style="text-align:right;">
355
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2986
</td>
<td style="text-align:right;">
2986
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2986
</td>
<td style="text-align:right;">
2986
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1060030
</td>
<td style="text-align:right;">
1060030
</td>
<td style="text-align:right;">
355
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3005
</td>
<td style="text-align:right;">
3005
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3005
</td>
<td style="text-align:right;">
3005
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1066775
</td>
<td style="text-align:right;">
1066775
</td>
<td style="text-align:right;">
355
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
11031
</td>
<td style="text-align:right;">
11084
</td>
<td style="text-align:right;">
53
</td>
<td style="text-align:right;">
11050.04
</td>
<td style="text-align:right;">
11050.04
</td>
<td style="text-align:right;">
17.799709
</td>
<td style="text-align:right;">
316.82964
</td>
<td style="text-align:right;">
0.1610828
</td>
<td style="text-align:right;">
3922763
</td>
<td style="text-align:right;">
3922763
</td>
<td style="text-align:right;">
355
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10532
</td>
<td style="text-align:right;">
10575
</td>
<td style="text-align:right;">
43
</td>
<td style="text-align:right;">
10546.23
</td>
<td style="text-align:right;">
10546.23
</td>
<td style="text-align:right;">
13.81320
</td>
<td style="text-align:right;">
190.80449
</td>
<td style="text-align:right;">
0.1309776
</td>
<td style="text-align:right;">
3743913
</td>
<td style="text-align:right;">
3743913
</td>
<td style="text-align:right;">
355
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
414
</td>
<td style="text-align:right;">
416
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
414.7380
</td>
<td style="text-align:right;">
414.7380
</td>
<td style="text-align:right;">
0.9650755
</td>
<td style="text-align:right;">
0.9313708
</td>
<td style="text-align:right;">
0.2326952
</td>
<td style="text-align:right;">
147232
</td>
<td style="text-align:right;">
147232
</td>
<td style="text-align:right;">
355
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
373
</td>
<td style="text-align:right;">
375
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
374.0225
</td>
<td style="text-align:right;">
374.0225
</td>
<td style="text-align:right;">
0.6230767
</td>
<td style="text-align:right;">
0.3882246
</td>
<td style="text-align:right;">
0.1665880
</td>
<td style="text-align:right;">
132778
</td>
<td style="text-align:right;">
132778
</td>
<td style="text-align:right;">
354
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-54884
</td>
<td style="text-align:right;">
30865
</td>
<td style="text-align:right;">
85749
</td>
<td style="text-align:right;">
-2472.034
</td>
<td style="text-align:right;">
5752.051
</td>
<td style="text-align:right;">
12038.554
</td>
<td style="text-align:right;">
144926775
</td>
<td style="text-align:right;">
-486.9898
</td>
<td style="text-align:right;">
-875100
</td>
<td style="text-align:right;">
2036226
</td>
<td style="text-align:right;">
354
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
44
</td>
<td style="text-align:right;">
44
</td>
<td style="text-align:right;">
6.655367
</td>
<td style="text-align:right;">
6.655367
</td>
<td style="text-align:right;">
9.411190
</td>
<td style="text-align:right;">
88.570494
</td>
<td style="text-align:right;">
141.40752
</td>
<td style="text-align:right;">
2356
</td>
<td style="text-align:right;">
2356
</td>
</tr>
<tr>
<td style="text-align:right;">
399592865
</td>
<td style="text-align:right;">
82
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2986
</td>
<td style="text-align:right;">
2986
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2986
</td>
<td style="text-align:right;">
2986
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
244852
</td>
<td style="text-align:right;">
244852
</td>
<td style="text-align:right;">
82
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3005
</td>
<td style="text-align:right;">
3005
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3005
</td>
<td style="text-align:right;">
3005
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
246410
</td>
<td style="text-align:right;">
246410
</td>
<td style="text-align:right;">
82
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
11042
</td>
<td style="text-align:right;">
11084
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
11049.17
</td>
<td style="text-align:right;">
11049.17
</td>
<td style="text-align:right;">
9.880758
</td>
<td style="text-align:right;">
97.62939
</td>
<td style="text-align:right;">
0.0894253
</td>
<td style="text-align:right;">
906032
</td>
<td style="text-align:right;">
906032
</td>
<td style="text-align:right;">
82
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10540
</td>
<td style="text-align:right;">
10575
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
10545.72
</td>
<td style="text-align:right;">
10545.72
</td>
<td style="text-align:right;">
8.19023
</td>
<td style="text-align:right;">
67.07986
</td>
<td style="text-align:right;">
0.0776640
</td>
<td style="text-align:right;">
864749
</td>
<td style="text-align:right;">
864749
</td>
<td style="text-align:right;">
82
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
414
</td>
<td style="text-align:right;">
416
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
414.1220
</td>
<td style="text-align:right;">
414.1220
</td>
<td style="text-align:right;">
0.4785711
</td>
<td style="text-align:right;">
0.2290303
</td>
<td style="text-align:right;">
0.1155629
</td>
<td style="text-align:right;">
33958
</td>
<td style="text-align:right;">
33958
</td>
<td style="text-align:right;">
82
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
373
</td>
<td style="text-align:right;">
374
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
373.0610
</td>
<td style="text-align:right;">
373.0610
</td>
<td style="text-align:right;">
0.2392856
</td>
<td style="text-align:right;">
0.0572576
</td>
<td style="text-align:right;">
0.0641411
</td>
<td style="text-align:right;">
30591
</td>
<td style="text-align:right;">
30591
</td>
<td style="text-align:right;">
81
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-40084
</td>
<td style="text-align:right;">
18444
</td>
<td style="text-align:right;">
58528
</td>
<td style="text-align:right;">
-3907.630
</td>
<td style="text-align:right;">
7527.259
</td>
<td style="text-align:right;">
12947.641
</td>
<td style="text-align:right;">
167641415
</td>
<td style="text-align:right;">
-331.3426
</td>
<td style="text-align:right;">
-316518
</td>
<td style="text-align:right;">
609708
</td>
<td style="text-align:right;">
81
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:right;">
70
</td>
<td style="text-align:right;">
8.925926
</td>
<td style="text-align:right;">
8.925926
</td>
<td style="text-align:right;">
13.105251
</td>
<td style="text-align:right;">
171.747600
</td>
<td style="text-align:right;">
146.82231
</td>
<td style="text-align:right;">
723
</td>
<td style="text-align:right;">
723
</td>
</tr>
<tr>
<td style="text-align:right;">
399593700
</td>
<td style="text-align:right;">
148
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2986
</td>
<td style="text-align:right;">
2986
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2986
</td>
<td style="text-align:right;">
2986
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
441928
</td>
<td style="text-align:right;">
441928
</td>
<td style="text-align:right;">
148
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3005
</td>
<td style="text-align:right;">
3005
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3005
</td>
<td style="text-align:right;">
3005
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
444740
</td>
<td style="text-align:right;">
444740
</td>
<td style="text-align:right;">
148
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
11008
</td>
<td style="text-align:right;">
11054
</td>
<td style="text-align:right;">
46
</td>
<td style="text-align:right;">
11019.70
</td>
<td style="text-align:right;">
11019.70
</td>
<td style="text-align:right;">
14.048015
</td>
<td style="text-align:right;">
197.34674
</td>
<td style="text-align:right;">
0.1274810
</td>
<td style="text-align:right;">
1630915
</td>
<td style="text-align:right;">
1630915
</td>
<td style="text-align:right;">
148
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10510
</td>
<td style="text-align:right;">
10548
</td>
<td style="text-align:right;">
38
</td>
<td style="text-align:right;">
10520.42
</td>
<td style="text-align:right;">
10520.42
</td>
<td style="text-align:right;">
11.55306
</td>
<td style="text-align:right;">
133.47316
</td>
<td style="text-align:right;">
0.1098156
</td>
<td style="text-align:right;">
1557022
</td>
<td style="text-align:right;">
1557022
</td>
<td style="text-align:right;">
148
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
414
</td>
<td style="text-align:right;">
416
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
414.5811
</td>
<td style="text-align:right;">
414.5811
</td>
<td style="text-align:right;">
0.8055006
</td>
<td style="text-align:right;">
0.6488313
</td>
<td style="text-align:right;">
0.1942927
</td>
<td style="text-align:right;">
61358
</td>
<td style="text-align:right;">
61358
</td>
<td style="text-align:right;">
148
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
375
</td>
<td style="text-align:right;">
376
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
375.1757
</td>
<td style="text-align:right;">
375.1757
</td>
<td style="text-align:right;">
0.3805440
</td>
<td style="text-align:right;">
0.1448137
</td>
<td style="text-align:right;">
0.1014309
</td>
<td style="text-align:right;">
55526
</td>
<td style="text-align:right;">
55526
</td>
<td style="text-align:right;">
148
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
-28093
</td>
<td style="text-align:right;">
14059
</td>
<td style="text-align:right;">
42152
</td>
<td style="text-align:right;">
-1160.236
</td>
<td style="text-align:right;">
3082.331
</td>
<td style="text-align:right;">
7115.013
</td>
<td style="text-align:right;">
50623405
</td>
<td style="text-align:right;">
-613.2381
</td>
<td style="text-align:right;">
-171715
</td>
<td style="text-align:right;">
456185
</td>
<td style="text-align:right;">
148
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
2.439189
</td>
<td style="text-align:right;">
2.439189
</td>
<td style="text-align:right;">
2.916000
</td>
<td style="text-align:right;">
8.503059
</td>
<td style="text-align:right;">
119.54794
</td>
<td style="text-align:right;">
361
</td>
<td style="text-align:right;">
361
</td>
</tr>
<tr>
<td style="text-align:right;">
399593701
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2986
</td>
<td style="text-align:right;">
2986
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2986
</td>
<td style="text-align:right;">
2986
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
20902
</td>
<td style="text-align:right;">
20902
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3005
</td>
<td style="text-align:right;">
3005
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3005
</td>
<td style="text-align:right;">
3005
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
21035
</td>
<td style="text-align:right;">
21035
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10987
</td>
<td style="text-align:right;">
10987
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10987.00
</td>
<td style="text-align:right;">
10987.00
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0.00000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
76909
</td>
<td style="text-align:right;">
76909
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10490
</td>
<td style="text-align:right;">
10490
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10490.00
</td>
<td style="text-align:right;">
10490.00
</td>
<td style="text-align:right;">
0.00000
</td>
<td style="text-align:right;">
0.00000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
73430
</td>
<td style="text-align:right;">
73430
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
415
</td>
<td style="text-align:right;">
415
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
415.0000
</td>
<td style="text-align:right;">
415.0000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
2905
</td>
<td style="text-align:right;">
2905
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
376
</td>
<td style="text-align:right;">
376
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
376.0000
</td>
<td style="text-align:right;">
376.0000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
2632
</td>
<td style="text-align:right;">
2632
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
-8035
</td>
<td style="text-align:right;">
5997
</td>
<td style="text-align:right;">
14032
</td>
<td style="text-align:right;">
-2046.286
</td>
<td style="text-align:right;">
3874.571
</td>
<td style="text-align:right;">
4235.546
</td>
<td style="text-align:right;">
17939850
</td>
<td style="text-align:right;">
-206.9870
</td>
<td style="text-align:right;">
-14324
</td>
<td style="text-align:right;">
27122
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
2.142857
</td>
<td style="text-align:right;">
2.142857
</td>
<td style="text-align:right;">
3.481731
</td>
<td style="text-align:right;">
12.122449
</td>
<td style="text-align:right;">
162.48077
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:right;">
399593817
</td>
<td style="text-align:right;">
162
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2986
</td>
<td style="text-align:right;">
2986
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2986
</td>
<td style="text-align:right;">
2986
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
483732
</td>
<td style="text-align:right;">
483732
</td>
<td style="text-align:right;">
162
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3005
</td>
<td style="text-align:right;">
3005
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3005
</td>
<td style="text-align:right;">
3005
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
486810
</td>
<td style="text-align:right;">
486810
</td>
<td style="text-align:right;">
162
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10993
</td>
<td style="text-align:right;">
11042
</td>
<td style="text-align:right;">
49
</td>
<td style="text-align:right;">
11009.02
</td>
<td style="text-align:right;">
11009.02
</td>
<td style="text-align:right;">
14.746614
</td>
<td style="text-align:right;">
217.46262
</td>
<td style="text-align:right;">
0.1339503
</td>
<td style="text-align:right;">
1783461
</td>
<td style="text-align:right;">
1783461
</td>
<td style="text-align:right;">
162
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10496
</td>
<td style="text-align:right;">
10537
</td>
<td style="text-align:right;">
41
</td>
<td style="text-align:right;">
10509.90
</td>
<td style="text-align:right;">
10509.90
</td>
<td style="text-align:right;">
12.24907
</td>
<td style="text-align:right;">
150.03963
</td>
<td style="text-align:right;">
0.1165479
</td>
<td style="text-align:right;">
1702604
</td>
<td style="text-align:right;">
1702604
</td>
<td style="text-align:right;">
162
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
414
</td>
<td style="text-align:right;">
416
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
414.7654
</td>
<td style="text-align:right;">
414.7654
</td>
<td style="text-align:right;">
0.7161558
</td>
<td style="text-align:right;">
0.5128791
</td>
<td style="text-align:right;">
0.1726653
</td>
<td style="text-align:right;">
67192
</td>
<td style="text-align:right;">
67192
</td>
<td style="text-align:right;">
162
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
375
</td>
<td style="text-align:right;">
376
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
375.2160
</td>
<td style="text-align:right;">
375.2160
</td>
<td style="text-align:right;">
0.4115484
</td>
<td style="text-align:right;">
0.1693720
</td>
<td style="text-align:right;">
0.1096830
</td>
<td style="text-align:right;">
60785
</td>
<td style="text-align:right;">
60785
</td>
<td style="text-align:right;">
162
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
-38488
</td>
<td style="text-align:right;">
19276
</td>
<td style="text-align:right;">
57764
</td>
<td style="text-align:right;">
-2234.920
</td>
<td style="text-align:right;">
5134.846
</td>
<td style="text-align:right;">
9093.644
</td>
<td style="text-align:right;">
82694353
</td>
<td style="text-align:right;">
-406.8890
</td>
<td style="text-align:right;">
-362057
</td>
<td style="text-align:right;">
831845
</td>
<td style="text-align:right;">
162
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
2.660494
</td>
<td style="text-align:right;">
2.660494
</td>
<td style="text-align:right;">
3.961487
</td>
<td style="text-align:right;">
15.693378
</td>
<td style="text-align:right;">
148.90043
</td>
<td style="text-align:right;">
431
</td>
<td style="text-align:right;">
431
</td>
</tr>
<tr>
<td style="text-align:right;">
399593818
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2986
</td>
<td style="text-align:right;">
2986
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
2986
</td>
<td style="text-align:right;">
2986
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
14930
</td>
<td style="text-align:right;">
14930
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3005
</td>
<td style="text-align:right;">
3005
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3005
</td>
<td style="text-align:right;">
3005
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
15025
</td>
<td style="text-align:right;">
15025
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10975
</td>
<td style="text-align:right;">
10987
</td>
<td style="text-align:right;">
12
</td>
<td style="text-align:right;">
10977.40
</td>
<td style="text-align:right;">
10977.40
</td>
<td style="text-align:right;">
4.800000
</td>
<td style="text-align:right;">
23.04000
</td>
<td style="text-align:right;">
0.0437262
</td>
<td style="text-align:right;">
54887
</td>
<td style="text-align:right;">
54887
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10479
</td>
<td style="text-align:right;">
10490
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
10481.20
</td>
<td style="text-align:right;">
10481.20
</td>
<td style="text-align:right;">
4.40000
</td>
<td style="text-align:right;">
19.36000
</td>
<td style="text-align:right;">
0.0419799
</td>
<td style="text-align:right;">
52406
</td>
<td style="text-align:right;">
52406
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
415
</td>
<td style="text-align:right;">
415
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
415.0000
</td>
<td style="text-align:right;">
415.0000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
2075
</td>
<td style="text-align:right;">
2075
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
376
</td>
<td style="text-align:right;">
377
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
376.8000
</td>
<td style="text-align:right;">
376.8000
</td>
<td style="text-align:right;">
0.4000000
</td>
<td style="text-align:right;">
0.1600000
</td>
<td style="text-align:right;">
0.1061571
</td>
<td style="text-align:right;">
1884
</td>
<td style="text-align:right;">
1884
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
10582
</td>
<td style="text-align:right;">
10582
</td>
<td style="text-align:right;">
2116.400
</td>
<td style="text-align:right;">
2116.400
</td>
<td style="text-align:right;">
4232.800
</td>
<td style="text-align:right;">
17916596
</td>
<td style="text-align:right;">
200.0000
</td>
<td style="text-align:right;">
10582
</td>
<td style="text-align:right;">
10582
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.200000
</td>
<td style="text-align:right;">
1.200000
</td>
<td style="text-align:right;">
0.400000
</td>
<td style="text-align:right;">
0.160000
</td>
<td style="text-align:right;">
33.33333
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
6
</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">stats_table_zon</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "subc_id"                                         </span></span>
<span><span class="co">##  [2] "bio1_1981.2010_data_cells"                       </span></span>
<span><span class="co">##  [3] "bio1_1981.2010_nodata_cells"                     </span></span>
<span><span class="co">##  [4] "bio1_1981.2010_min"                              </span></span>
<span><span class="co">##  [5] "bio1_1981.2010_max"                              </span></span>
<span><span class="co">##  [6] "bio1_1981.2010_range"                            </span></span>
<span><span class="co">##  [7] "bio1_1981.2010_mean"                             </span></span>
<span><span class="co">##  [8] "bio1_1981.2010_mean_abs"                         </span></span>
<span><span class="co">##  [9] "bio1_1981.2010_sd"                               </span></span>
<span><span class="co">## [10] "bio1_1981.2010_var"                              </span></span>
<span><span class="co">## [11] "bio1_1981.2010_cv"                               </span></span>
<span><span class="co">## [12] "bio1_1981.2010_sum"                              </span></span>
<span><span class="co">## [13] "bio1_1981.2010_sum_abs"                          </span></span>
<span><span class="co">## [14] "bio1_IPSL.CM6A.LR_ssp370_2041.2070_data_cells"   </span></span>
<span><span class="co">## [15] "bio1_IPSL.CM6A.LR_ssp370_2041.2070_nodata_cells" </span></span>
<span><span class="co">## [16] "bio1_IPSL.CM6A.LR_ssp370_2041.2070_min"          </span></span>
<span><span class="co">## [17] "bio1_IPSL.CM6A.LR_ssp370_2041.2070_max"          </span></span>
<span><span class="co">## [18] "bio1_IPSL.CM6A.LR_ssp370_2041.2070_range"        </span></span>
<span><span class="co">## [19] "bio1_IPSL.CM6A.LR_ssp370_2041.2070_mean"         </span></span>
<span><span class="co">## [20] "bio1_IPSL.CM6A.LR_ssp370_2041.2070_mean_abs"     </span></span>
<span><span class="co">## [21] "bio1_IPSL.CM6A.LR_ssp370_2041.2070_sd"           </span></span>
<span><span class="co">## [22] "bio1_IPSL.CM6A.LR_ssp370_2041.2070_var"          </span></span>
<span><span class="co">## [23] "bio1_IPSL.CM6A.LR_ssp370_2041.2070_cv"           </span></span>
<span><span class="co">## [24] "bio1_IPSL.CM6A.LR_ssp370_2041.2070_sum"          </span></span>
<span><span class="co">## [25] "bio1_IPSL.CM6A.LR_ssp370_2041.2070_sum_abs"      </span></span>
<span><span class="co">## [26] "bio12_1981.2010_data_cells"                      </span></span>
<span><span class="co">## [27] "bio12_1981.2010_nodata_cells"                    </span></span>
<span><span class="co">## [28] "bio12_1981.2010_min"                             </span></span>
<span><span class="co">## [29] "bio12_1981.2010_max"                             </span></span>
<span><span class="co">## [30] "bio12_1981.2010_range"                           </span></span>
<span><span class="co">## [31] "bio12_1981.2010_mean"                            </span></span>
<span><span class="co">## [32] "bio12_1981.2010_mean_abs"                        </span></span>
<span><span class="co">## [33] "bio12_1981.2010_sd"                              </span></span>
<span><span class="co">## [34] "bio12_1981.2010_var"                             </span></span>
<span><span class="co">## [35] "bio12_1981.2010_cv"                              </span></span>
<span><span class="co">## [36] "bio12_1981.2010_sum"                             </span></span>
<span><span class="co">## [37] "bio12_1981.2010_sum_abs"                         </span></span>
<span><span class="co">## [38] "bio12_IPSL.CM6A.LR_ssp370_2041.2070_data_cells"  </span></span>
<span><span class="co">## [39] "bio12_IPSL.CM6A.LR_ssp370_2041.2070_nodata_cells"</span></span>
<span><span class="co">## [40] "bio12_IPSL.CM6A.LR_ssp370_2041.2070_min"         </span></span>
<span><span class="co">## [41] "bio12_IPSL.CM6A.LR_ssp370_2041.2070_max"         </span></span>
<span><span class="co">## [42] "bio12_IPSL.CM6A.LR_ssp370_2041.2070_range"       </span></span>
<span><span class="co">## [43] "bio12_IPSL.CM6A.LR_ssp370_2041.2070_mean"        </span></span>
<span><span class="co">## [44] "bio12_IPSL.CM6A.LR_ssp370_2041.2070_mean_abs"    </span></span>
<span><span class="co">## [45] "bio12_IPSL.CM6A.LR_ssp370_2041.2070_sd"          </span></span>
<span><span class="co">## [46] "bio12_IPSL.CM6A.LR_ssp370_2041.2070_var"         </span></span>
<span><span class="co">## [47] "bio12_IPSL.CM6A.LR_ssp370_2041.2070_cv"          </span></span>
<span><span class="co">## [48] "bio12_IPSL.CM6A.LR_ssp370_2041.2070_sum"         </span></span>
<span><span class="co">## [49] "bio12_IPSL.CM6A.LR_ssp370_2041.2070_sum_abs"     </span></span>
<span><span class="co">## [50] "bio15_1981.2010_data_cells"                      </span></span>
<span><span class="co">## [51] "bio15_1981.2010_nodata_cells"                    </span></span>
<span><span class="co">## [52] "bio15_1981.2010_min"                             </span></span>
<span><span class="co">## [53] "bio15_1981.2010_max"                             </span></span>
<span><span class="co">## [54] "bio15_1981.2010_range"                           </span></span>
<span><span class="co">## [55] "bio15_1981.2010_mean"                            </span></span>
<span><span class="co">## [56] "bio15_1981.2010_mean_abs"                        </span></span>
<span><span class="co">## [57] "bio15_1981.2010_sd"                              </span></span>
<span><span class="co">## [58] "bio15_1981.2010_var"                             </span></span>
<span><span class="co">## [59] "bio15_1981.2010_cv"                              </span></span>
<span><span class="co">## [60] "bio15_1981.2010_sum"                             </span></span>
<span><span class="co">## [61] "bio15_1981.2010_sum_abs"                         </span></span>
<span><span class="co">## [62] "bio15_IPSL.CM6A.LR_ssp370_2041.2070_data_cells"  </span></span>
<span><span class="co">## [63] "bio15_IPSL.CM6A.LR_ssp370_2041.2070_nodata_cells"</span></span>
<span><span class="co">## [64] "bio15_IPSL.CM6A.LR_ssp370_2041.2070_min"         </span></span>
<span><span class="co">## [65] "bio15_IPSL.CM6A.LR_ssp370_2041.2070_max"         </span></span>
<span><span class="co">## [66] "bio15_IPSL.CM6A.LR_ssp370_2041.2070_range"       </span></span>
<span><span class="co">## [67] "bio15_IPSL.CM6A.LR_ssp370_2041.2070_mean"        </span></span>
<span><span class="co">## [68] "bio15_IPSL.CM6A.LR_ssp370_2041.2070_mean_abs"    </span></span>
<span><span class="co">## [69] "bio15_IPSL.CM6A.LR_ssp370_2041.2070_sd"          </span></span>
<span><span class="co">## [70] "bio15_IPSL.CM6A.LR_ssp370_2041.2070_var"         </span></span>
<span><span class="co">## [71] "bio15_IPSL.CM6A.LR_ssp370_2041.2070_cv"          </span></span>
<span><span class="co">## [72] "bio15_IPSL.CM6A.LR_ssp370_2041.2070_sum"         </span></span>
<span><span class="co">## [73] "bio15_IPSL.CM6A.LR_ssp370_2041.2070_sum_abs"     </span></span>
<span><span class="co">## [74] "slope_curv_max_dw_cel_data_cells"                </span></span>
<span><span class="co">## [75] "slope_curv_max_dw_cel_nodata_cells"              </span></span>
<span><span class="co">## [76] "slope_curv_max_dw_cel_min"                       </span></span>
<span><span class="co">## [77] "slope_curv_max_dw_cel_max"                       </span></span>
<span><span class="co">## [78] "slope_curv_max_dw_cel_range"                     </span></span>
<span><span class="co">## [79] "slope_curv_max_dw_cel_mean"                      </span></span>
<span><span class="co">## [80] "slope_curv_max_dw_cel_mean_abs"                  </span></span>
<span><span class="co">## [81] "slope_curv_max_dw_cel_sd"                        </span></span>
<span><span class="co">## [82] "slope_curv_max_dw_cel_var"                       </span></span>
<span><span class="co">## [83] "slope_curv_max_dw_cel_cv"                        </span></span>
<span><span class="co">## [84] "slope_curv_max_dw_cel_sum"                       </span></span>
<span><span class="co">## [85] "slope_curv_max_dw_cel_sum_abs"                   </span></span>
<span><span class="co">## [86] "spi_data_cells"                                  </span></span>
<span><span class="co">## [87] "spi_nodata_cells"                                </span></span>
<span><span class="co">## [88] "spi_min"                                         </span></span>
<span><span class="co">## [89] "spi_max"                                         </span></span>
<span><span class="co">## [90] "spi_range"                                       </span></span>
<span><span class="co">## [91] "spi_mean"                                        </span></span>
<span><span class="co">## [92] "spi_mean_abs"                                    </span></span>
<span><span class="co">## [93] "spi_sd"                                          </span></span>
<span><span class="co">## [94] "spi_var"                                         </span></span>
<span><span class="co">## [95] "spi_cv"                                          </span></span>
<span><span class="co">## [96] "spi_sum"                                         </span></span>
<span><span class="co">## [97] "spi_sum_abs"</span></span></code></pre>
<p>We will keep only the mean and sd of each variable of the
stats_table, to use them as predictors in the species distribution
model</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stats_table_zon</span> <span class="op">&lt;-</span> <span class="va">stats_table_zon</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"subc"</span><span class="op">)</span> <span class="op">|</span>  <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"_mean"</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"_sd"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">'subcatchment_id'</span> <span class="op">=</span> <span class="st">'subc_id'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="reading-vector-files">Reading vector files<a class="anchor" aria-label="anchor" href="#reading-vector-files"></a>
</h3>
<p>Read in the .gpkg databases of the two tiles, filtering only the
sub-catchments of the study area. Their IDs can be retrieved from the
stats_table</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stats_gpkg_h08v06</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_geopackage.html">read_geopackage</a></span><span class="op">(</span></span>
<span>  <span class="st">"data/r.stream.order/order_vect_tiles20d/order_vect_point_h08v06.gpkg"</span>,</span>
<span>  subc_id <span class="op">=</span> <span class="va">stats_table_zon</span><span class="op">$</span><span class="va">subcatchment_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">'subcatchment_id'</span> <span class="op">=</span> <span class="st">'stream'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">stats_gpkg_h10v06</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_geopackage.html">read_geopackage</a></span><span class="op">(</span></span>
<span>  <span class="st">"data/r.stream.order/order_vect_tiles20d/order_vect_point_h10v06.gpkg"</span>,</span>
<span>  subc_id <span class="op">=</span> <span class="va">stats_table_zon</span><span class="op">$</span><span class="va">subcatchment_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">'subcatchment_id'</span> <span class="op">=</span> <span class="st">'stream'</span><span class="op">)</span></span></code></pre></div>
<p>Then we join the two .gpkg databases and select the columns
“subcatchment_id” and “length”. We will use the length of the stream as
an indicator of the sub-catchment size</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stats_gpkg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">stats_gpkg_h08v06</span>, <span class="va">stats_gpkg_h10v06</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"subcatchment_id"</span>, <span class="st">"length"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Clear up memory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">stats_gpkg_h08v06</span>, <span class="va">stats_gpkg_h10v06</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##            used  (Mb) gc trigger  (Mb)  max used  (Mb)</span></span>
<span><span class="co">## Ncells  4626975 247.2    8698140 464.6   6510698 347.8</span></span>
<span><span class="co">## Vcells 27079257 206.6   83904656 640.2 104362151 796.3</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="prepare-data-for-modelling">Prepare data for modelling<a class="anchor" aria-label="anchor" href="#prepare-data-for-modelling"></a>
</h3>
<!--![](../man/figures/wf_7.png)-->
<p>Join the stats_table with the .gpkg database</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stats_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">stats_table_zon</span>, <span class="va">stats_gpkg</span>, by <span class="op">=</span> <span class="st">"subcatchment_id"</span><span class="op">)</span></span></code></pre></div>
<p>The values in the original raster files were scaled, so we need to
re-scale them before the modelling</p>
<p>We define the following functions:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slope_scale</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">na.rm</span> <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">(</span><span class="va">x</span> <span class="op">*</span> <span class="fl">0.000001</span><span class="op">)</span></span>
<span><span class="va">clim_scale</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">na.rm</span> <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">(</span><span class="va">x</span> <span class="op">*</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">offset</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">na.rm</span> <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="fl">273.15</span><span class="op">)</span></span></code></pre></div>
<p>… and apply them to rescale the values</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stats_table</span> <span class="op">&lt;-</span> <span class="va">stats_table</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"slope_curv_max_dw_cel"</span><span class="op">)</span>, <span class="va">slope_scale</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"bio"</span><span class="op">)</span>, <span class="va">clim_scale</span><span class="op">)</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">matches</a></span><span class="op">(</span><span class="st">"bio1_.*_mean"</span><span class="op">)</span>, <span class="va">offset</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">stats_table</span><span class="op">)</span></span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:200px; overflow-x: scroll; width:800px; ">
<table class="table table table-striped" style="width: auto !important; ">
<thead><tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
subcatchment_id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_1981.2010_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_IPSL.CM6A.LR_ssp370_2041.2070_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_1981.2010_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_IPSL.CM6A.LR_ssp370_2041.2070_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_1981.2010_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_IPSL.CM6A.LR_ssp370_2041.2070_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
slope_curv_max_dw_cel_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
spi_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_1981.2010_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_IPSL.CM6A.LR_ssp370_2041.2070_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_1981.2010_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_IPSL.CM6A.LR_ssp370_2041.2070_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_1981.2010_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_IPSL.CM6A.LR_ssp370_2041.2070_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
slope_curv_max_dw_cel_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
spi_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
length
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
399592461
</td>
<td style="text-align:right;">
25.45
</td>
<td style="text-align:right;">
27.35
</td>
<td style="text-align:right;">
1105.004
</td>
<td style="text-align:right;">
1054.623
</td>
<td style="text-align:right;">
41.47380
</td>
<td style="text-align:right;">
37.40225
</td>
<td style="text-align:right;">
-0.0024720
</td>
<td style="text-align:right;">
6.655367
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.7799709
</td>
<td style="text-align:right;">
1.381320
</td>
<td style="text-align:right;">
0.0965076
</td>
<td style="text-align:right;">
0.0623077
</td>
<td style="text-align:right;">
0.0120386
</td>
<td style="text-align:right;">
9.411190
</td>
<td style="text-align:right;">
3827.3302
</td>
</tr>
<tr>
<td style="text-align:right;">
399592865
</td>
<td style="text-align:right;">
25.45
</td>
<td style="text-align:right;">
27.35
</td>
<td style="text-align:right;">
1104.917
</td>
<td style="text-align:right;">
1054.572
</td>
<td style="text-align:right;">
41.41220
</td>
<td style="text-align:right;">
37.30610
</td>
<td style="text-align:right;">
-0.0039076
</td>
<td style="text-align:right;">
8.925926
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.9880758
</td>
<td style="text-align:right;">
0.819023
</td>
<td style="text-align:right;">
0.0478571
</td>
<td style="text-align:right;">
0.0239286
</td>
<td style="text-align:right;">
0.0129476
</td>
<td style="text-align:right;">
13.105251
</td>
<td style="text-align:right;">
2911.9507
</td>
</tr>
<tr>
<td style="text-align:right;">
399593700
</td>
<td style="text-align:right;">
25.45
</td>
<td style="text-align:right;">
27.35
</td>
<td style="text-align:right;">
1101.970
</td>
<td style="text-align:right;">
1052.042
</td>
<td style="text-align:right;">
41.45811
</td>
<td style="text-align:right;">
37.51757
</td>
<td style="text-align:right;">
-0.0011602
</td>
<td style="text-align:right;">
2.439189
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.4048016
</td>
<td style="text-align:right;">
1.155306
</td>
<td style="text-align:right;">
0.0805501
</td>
<td style="text-align:right;">
0.0380544
</td>
<td style="text-align:right;">
0.0071150
</td>
<td style="text-align:right;">
2.916000
</td>
<td style="text-align:right;">
1903.8027
</td>
</tr>
<tr>
<td style="text-align:right;">
399593701
</td>
<td style="text-align:right;">
25.45
</td>
<td style="text-align:right;">
27.35
</td>
<td style="text-align:right;">
1098.700
</td>
<td style="text-align:right;">
1049.000
</td>
<td style="text-align:right;">
41.50000
</td>
<td style="text-align:right;">
37.60000
</td>
<td style="text-align:right;">
-0.0020463
</td>
<td style="text-align:right;">
2.142857
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0042355
</td>
<td style="text-align:right;">
3.481731
</td>
<td style="text-align:right;">
1057.3782
</td>
</tr>
<tr>
<td style="text-align:right;">
399593817
</td>
<td style="text-align:right;">
25.45
</td>
<td style="text-align:right;">
27.35
</td>
<td style="text-align:right;">
1100.902
</td>
<td style="text-align:right;">
1050.990
</td>
<td style="text-align:right;">
41.47654
</td>
<td style="text-align:right;">
37.52160
</td>
<td style="text-align:right;">
-0.0022349
</td>
<td style="text-align:right;">
2.660494
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.4746614
</td>
<td style="text-align:right;">
1.224907
</td>
<td style="text-align:right;">
0.0716156
</td>
<td style="text-align:right;">
0.0411548
</td>
<td style="text-align:right;">
0.0090936
</td>
<td style="text-align:right;">
3.961487
</td>
<td style="text-align:right;">
2343.3823
</td>
</tr>
<tr>
<td style="text-align:right;">
399593818
</td>
<td style="text-align:right;">
25.45
</td>
<td style="text-align:right;">
27.35
</td>
<td style="text-align:right;">
1097.740
</td>
<td style="text-align:right;">
1048.120
</td>
<td style="text-align:right;">
41.50000
</td>
<td style="text-align:right;">
37.68000
</td>
<td style="text-align:right;">
0.0021164
</td>
<td style="text-align:right;">
1.200000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.4800000
</td>
<td style="text-align:right;">
0.440000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0400000
</td>
<td style="text-align:right;">
0.0042328
</td>
<td style="text-align:right;">
0.400000
</td>
<td style="text-align:right;">
812.9898
</td>
</tr>
</tbody>
</table>
</div>
<!-- Check if there are NAs in the rows of the table -->
<!-- ```{r, eval = FALSE} -->
<!-- head(stats_table[is.na(stats_table$length),]) -->
<!-- ``` -->
<!-- ```{r, echo = FALSE} -->
<!-- kbl(head(stats_table[is.na(stats_table$length), ])) %>%                         -->
<!--   kable_styling(bootstrap_options = "striped", full_width = F, position = "left") %>%      -->
<!--   scroll_box(width = "800px", height = "200px") -->
<!-- ``` -->
<!-- There are streams with NA in the length column. Should we convert them -->
<!-- to 0? -->
<!-- ```{r} -->
<!-- stats_table$length[is.na(stats_table$length)] <- 0 -->
<!-- ``` -->
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">stats_table</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">stats_table</span><span class="op">$</span><span class="va">slope_curv_max_dw_cel_mean</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:200px; overflow-x: scroll; width:800px; ">
<table class="table table table-striped" style="width: auto !important; ">
<thead><tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
subcatchment_id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_1981.2010_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_IPSL.CM6A.LR_ssp370_2041.2070_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_1981.2010_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_IPSL.CM6A.LR_ssp370_2041.2070_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_1981.2010_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_IPSL.CM6A.LR_ssp370_2041.2070_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
slope_curv_max_dw_cel_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
spi_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_1981.2010_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_IPSL.CM6A.LR_ssp370_2041.2070_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_1981.2010_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_IPSL.CM6A.LR_ssp370_2041.2070_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_1981.2010_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_IPSL.CM6A.LR_ssp370_2041.2070_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
slope_curv_max_dw_cel_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
spi_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
length
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
399596764
</td>
<td style="text-align:right;">
25.45
</td>
<td style="text-align:right;">
27.35
</td>
<td style="text-align:right;">
1110.4
</td>
<td style="text-align:right;">
1054.3
</td>
<td style="text-align:right;">
41.8
</td>
<td style="text-align:right;">
36.6
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
399597046
</td>
<td style="text-align:right;">
25.55
</td>
<td style="text-align:right;">
27.55
</td>
<td style="text-align:right;">
1362.3
</td>
<td style="text-align:right;">
1261.1
</td>
<td style="text-align:right;">
49.3
</td>
<td style="text-align:right;">
42.9
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
399604194
</td>
<td style="text-align:right;">
25.35
</td>
<td style="text-align:right;">
27.35
</td>
<td style="text-align:right;">
1117.2
</td>
<td style="text-align:right;">
1059.8
</td>
<td style="text-align:right;">
42.9
</td>
<td style="text-align:right;">
38.9
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
399607973
</td>
<td style="text-align:right;">
25.35
</td>
<td style="text-align:right;">
27.25
</td>
<td style="text-align:right;">
1130.5
</td>
<td style="text-align:right;">
1074.5
</td>
<td style="text-align:right;">
43.2
</td>
<td style="text-align:right;">
38.6
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
399611470
</td>
<td style="text-align:right;">
25.35
</td>
<td style="text-align:right;">
27.25
</td>
<td style="text-align:right;">
1149.3
</td>
<td style="text-align:right;">
1086.0
</td>
<td style="text-align:right;">
44.5
</td>
<td style="text-align:right;">
39.0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
399614825
</td>
<td style="text-align:right;">
25.45
</td>
<td style="text-align:right;">
27.45
</td>
<td style="text-align:right;">
1305.2
</td>
<td style="text-align:right;">
1207.6
</td>
<td style="text-align:right;">
50.2
</td>
<td style="text-align:right;">
43.9
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">stats_table</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">stats_table</span><span class="op">$</span><span class="va">spi_mean</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:200px; overflow-x: scroll; width:800px; ">
<table class="table table table-striped" style="width: auto !important; ">
<thead><tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
subcatchment_id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_1981.2010_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_IPSL.CM6A.LR_ssp370_2041.2070_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_1981.2010_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_IPSL.CM6A.LR_ssp370_2041.2070_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_1981.2010_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_IPSL.CM6A.LR_ssp370_2041.2070_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
slope_curv_max_dw_cel_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
spi_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_1981.2010_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_IPSL.CM6A.LR_ssp370_2041.2070_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_1981.2010_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_IPSL.CM6A.LR_ssp370_2041.2070_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_1981.2010_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_IPSL.CM6A.LR_ssp370_2041.2070_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
slope_curv_max_dw_cel_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
spi_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
length
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
399596764
</td>
<td style="text-align:right;">
25.45
</td>
<td style="text-align:right;">
27.35
</td>
<td style="text-align:right;">
1110.4
</td>
<td style="text-align:right;">
1054.3
</td>
<td style="text-align:right;">
41.8
</td>
<td style="text-align:right;">
36.6
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
399597046
</td>
<td style="text-align:right;">
25.55
</td>
<td style="text-align:right;">
27.55
</td>
<td style="text-align:right;">
1362.3
</td>
<td style="text-align:right;">
1261.1
</td>
<td style="text-align:right;">
49.3
</td>
<td style="text-align:right;">
42.9
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
399604194
</td>
<td style="text-align:right;">
25.35
</td>
<td style="text-align:right;">
27.35
</td>
<td style="text-align:right;">
1117.2
</td>
<td style="text-align:right;">
1059.8
</td>
<td style="text-align:right;">
42.9
</td>
<td style="text-align:right;">
38.9
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
399607973
</td>
<td style="text-align:right;">
25.35
</td>
<td style="text-align:right;">
27.25
</td>
<td style="text-align:right;">
1130.5
</td>
<td style="text-align:right;">
1074.5
</td>
<td style="text-align:right;">
43.2
</td>
<td style="text-align:right;">
38.6
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
399611470
</td>
<td style="text-align:right;">
25.35
</td>
<td style="text-align:right;">
27.25
</td>
<td style="text-align:right;">
1149.3
</td>
<td style="text-align:right;">
1086.0
</td>
<td style="text-align:right;">
44.5
</td>
<td style="text-align:right;">
39.0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
399614825
</td>
<td style="text-align:right;">
25.45
</td>
<td style="text-align:right;">
27.45
</td>
<td style="text-align:right;">
1305.2
</td>
<td style="text-align:right;">
1207.6
</td>
<td style="text-align:right;">
50.2
</td>
<td style="text-align:right;">
43.9
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
</div>
<p>If we check the IDs of the sub-catchments that have null values for
both variables, we observe that they are identical:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stats_table</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">stats_table</span><span class="op">$</span><span class="va">spi_mean</span><span class="op">)</span>,<span class="op">]</span><span class="op">$</span><span class="va">subcatchment_id</span> <span class="op">==</span> <span class="va">stats_table</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">stats_table</span><span class="op">$</span><span class="va">slope_curv_max_dw_cel_mean</span><span class="op">)</span>,<span class="op">]</span><span class="op">$</span><span class="va">subcatchment_id</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE</span></span>
<span><span class="co">## [16] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE</span></span>
<span><span class="co">## [31] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE</span></span></code></pre>
<p>This happens because the variables are not defined for a few
single-pixel sub-catchments, which are outlets. We will remove these
sub-catchments, as the model will not be able to handle the no data
values.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stats_table</span> <span class="op">&lt;-</span> <span class="va">stats_table</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">stats_table</span><span class="op">$</span><span class="va">slope_curv_max_dw_cel_mean</span><span class="op">)</span>,<span class="op">]</span></span></code></pre></div>
<p>We split the dataset into two datasets, according to present and
future Bioclim variables. The first will be used in the training of the
model and the second in the prediction of future suitable habitats</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stats_table_present</span> <span class="op">&lt;-</span> <span class="va">stats_table</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"IPSL"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>bio1_mean <span class="op">=</span> <span class="va">bio1_1981.2010_mean</span>,</span>
<span>         bio1_sd <span class="op">=</span> <span class="va">bio1_1981.2010_sd</span>,</span>
<span>         bio12_mean <span class="op">=</span> <span class="va">bio12_1981.2010_mean</span>,</span>
<span>         bio12_sd <span class="op">=</span> <span class="va">bio12_1981.2010_sd</span>,</span>
<span>         bio15_mean <span class="op">=</span> <span class="va">bio15_1981.2010_mean</span>,</span>
<span>         bio15_sd <span class="op">=</span> <span class="va">bio15_1981.2010_sd</span><span class="op">)</span></span>
<span></span>
<span><span class="va">stats_table_future</span> <span class="op">&lt;-</span> <span class="va">stats_table</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"1981"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>bio1_mean <span class="op">=</span> <span class="va">bio1_IPSL.CM6A.LR_ssp370_2041.2070_mean</span>,</span>
<span>         bio1_sd <span class="op">=</span> <span class="va">bio1_IPSL.CM6A.LR_ssp370_2041.2070_sd</span>,</span>
<span>         bio12_mean <span class="op">=</span> <span class="va">bio12_IPSL.CM6A.LR_ssp370_2041.2070_mean</span>,</span>
<span>         bio12_sd <span class="op">=</span> <span class="va">bio12_IPSL.CM6A.LR_ssp370_2041.2070_sd</span>,</span>
<span>         bio15_mean <span class="op">=</span> <span class="va">bio15_IPSL.CM6A.LR_ssp370_2041.2070_mean</span>,</span>
<span>         bio15_sd <span class="op">=</span> <span class="va">bio15_IPSL.CM6A.LR_ssp370_2041.2070_sd</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Clear up memory</span></span>
<span><span class="co"># rm(stats_table) ; gc()</span></span></code></pre></div>
<p>The classification model needs at least two classes, in this case
presences and absences. We will sample 10,000 random sub-catchments that
will be used as pseudoabsences in the model. The filtering that takes
place before the sampling assures that we will avoid sampling
sub-catchments with known presences of the species</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pseudoabs</span> <span class="op">&lt;-</span> <span class="va">stats_table_present</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">subcatchment_id</span> <span class="op"><a href="https://rdrr.io/pkg/terra/man/match.html" class="external-link">%in%</a></span> <span class="va">spdata_ids</span><span class="op">$</span><span class="va">subcatchment_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html" class="external-link">sample_n</a></span><span class="op">(</span><span class="fl">10000</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pseudoabs</span><span class="op">)</span></span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:200px; overflow-x: scroll; width:800px; ">
<table class="table table table-striped" style="width: auto !important; ">
<thead><tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
subcatchment_id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
slope_curv_max_dw_cel_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
spi_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
slope_curv_max_dw_cel_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
spi_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
length
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
422740987
</td>
<td style="text-align:right;">
25.45000
</td>
<td style="text-align:right;">
1344.517
</td>
<td style="text-align:right;">
50.61190
</td>
<td style="text-align:right;">
-0.0152764
</td>
<td style="text-align:right;">
3.2857143
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
1.5868382
</td>
<td style="text-align:right;">
0.0323845
</td>
<td style="text-align:right;">
0.0292238
</td>
<td style="text-align:right;">
8.0483234
</td>
<td style="text-align:right;">
772.1120
</td>
</tr>
<tr>
<td style="text-align:right;">
399640782
</td>
<td style="text-align:right;">
25.25000
</td>
<td style="text-align:right;">
1239.262
</td>
<td style="text-align:right;">
51.16600
</td>
<td style="text-align:right;">
-0.0016581
</td>
<td style="text-align:right;">
0.4000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.3315961
</td>
<td style="text-align:right;">
0.0473709
</td>
<td style="text-align:right;">
0.0024907
</td>
<td style="text-align:right;">
1.0000000
</td>
<td style="text-align:right;">
754.5646
</td>
</tr>
<tr>
<td style="text-align:right;">
422767226
</td>
<td style="text-align:right;">
26.11316
</td>
<td style="text-align:right;">
1277.129
</td>
<td style="text-align:right;">
47.54211
</td>
<td style="text-align:right;">
-0.0100076
</td>
<td style="text-align:right;">
1.0526316
</td>
<td style="text-align:right;">
0.0482376
</td>
<td style="text-align:right;">
1.6244688
</td>
<td style="text-align:right;">
0.2110520
</td>
<td style="text-align:right;">
0.0127914
</td>
<td style="text-align:right;">
1.3366763
</td>
<td style="text-align:right;">
743.6051
</td>
</tr>
<tr>
<td style="text-align:right;">
399934534
</td>
<td style="text-align:right;">
24.75000
</td>
<td style="text-align:right;">
1449.200
</td>
<td style="text-align:right;">
60.90000
</td>
<td style="text-align:right;">
-0.0244061
</td>
<td style="text-align:right;">
0.5833333
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0284722
</td>
<td style="text-align:right;">
0.7592028
</td>
<td style="text-align:right;">
218.3154
</td>
</tr>
<tr>
<td style="text-align:right;">
422694400
</td>
<td style="text-align:right;">
25.65000
</td>
<td style="text-align:right;">
1274.410
</td>
<td style="text-align:right;">
61.01034
</td>
<td style="text-align:right;">
-0.0120889
</td>
<td style="text-align:right;">
37.5172414
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
4.6628647
</td>
<td style="text-align:right;">
0.0304543
</td>
<td style="text-align:right;">
0.0177402
</td>
<td style="text-align:right;">
66.1646956
</td>
<td style="text-align:right;">
639.2763
</td>
</tr>
<tr>
<td style="text-align:right;">
422712511
</td>
<td style="text-align:right;">
26.35000
</td>
<td style="text-align:right;">
1196.800
</td>
<td style="text-align:right;">
64.50000
</td>
<td style="text-align:right;">
-0.0022165
</td>
<td style="text-align:right;">
124.6000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0038563
</td>
<td style="text-align:right;">
248.9778571
</td>
<td style="text-align:right;">
299.7987
</td>
</tr>
</tbody>
</table>
</div>
<p>We join the species occurrences with the present environmental
variables table</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">presence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">spdata_ids</span>, <span class="va">stats_table_present</span>, by <span class="op">=</span> <span class="st">"subcatchment_id"</span><span class="op">)</span></span></code></pre></div>
<p>We then join the predictors of the presences and those of the
pseudoabsences, to obtain the modelling data table</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_model</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">presence</span>, <span class="va">pseudoabs</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Define a binary column of presence-absence (0-1) and set it to
factor</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_model</span><span class="op">$</span><span class="va">occurrence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">data_model</span><span class="op">$</span><span class="va">occurrence_ID</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">data_model</span><span class="op">$</span><span class="va">occurrence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/is.bool.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">data_model</span><span class="op">$</span><span class="va">occurrence</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_model</span><span class="op">)</span></span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:200px; overflow-x: scroll; width:800px; ">
<table class="table table table-striped" style="width: auto !important; ">
<thead><tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
longitude
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
latitude
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
occurrence_ID
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
subcatchment_id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
slope_curv_max_dw_cel_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
spi_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
slope_curv_max_dw_cel_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
spi_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
length
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
occurrence
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
-75.73
</td>
<td style="text-align:right;">
20.01
</td>
<td style="text-align:right;">
107705340
</td>
<td style="text-align:right;">
422886180
</td>
<td style="text-align:right;">
25.73519
</td>
<td style="text-align:right;">
1250.785
</td>
<td style="text-align:right;">
52.50000
</td>
<td style="text-align:right;">
-0.0324294
</td>
<td style="text-align:right;">
59.8148148
</td>
<td style="text-align:right;">
0.0755410
</td>
<td style="text-align:right;">
4.513577
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0783162
</td>
<td style="text-align:right;">
123.190018
</td>
<td style="text-align:right;">
388.5433
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
-75.37
</td>
<td style="text-align:right;">
20.40
</td>
<td style="text-align:right;">
107705519
</td>
<td style="text-align:right;">
422816272
</td>
<td style="text-align:right;">
24.53667
</td>
<td style="text-align:right;">
1866.747
</td>
<td style="text-align:right;">
47.82667
</td>
<td style="text-align:right;">
-0.0349241
</td>
<td style="text-align:right;">
7.2666667
</td>
<td style="text-align:right;">
0.0339935
</td>
<td style="text-align:right;">
0.883830
</td>
<td style="text-align:right;">
0.0679869
</td>
<td style="text-align:right;">
0.0576330
</td>
<td style="text-align:right;">
6.677990
</td>
<td style="text-align:right;">
434.9116
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
-75.78
</td>
<td style="text-align:right;">
20.50
</td>
<td style="text-align:right;">
107705533
</td>
<td style="text-align:right;">
422801107
</td>
<td style="text-align:right;">
22.37000
</td>
<td style="text-align:right;">
1819.280
</td>
<td style="text-align:right;">
52.28000
</td>
<td style="text-align:right;">
-0.0280889
</td>
<td style="text-align:right;">
1.8666667
</td>
<td style="text-align:right;">
0.0400000
</td>
<td style="text-align:right;">
2.560000
</td>
<td style="text-align:right;">
0.0400000
</td>
<td style="text-align:right;">
0.0361340
</td>
<td style="text-align:right;">
1.746107
</td>
<td style="text-align:right;">
300.6135
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
-77.03
</td>
<td style="text-align:right;">
20.20
</td>
<td style="text-align:right;">
107705535
</td>
<td style="text-align:right;">
422851157
</td>
<td style="text-align:right;">
26.35000
</td>
<td style="text-align:right;">
1401.500
</td>
<td style="text-align:right;">
58.50000
</td>
<td style="text-align:right;">
-0.0020064
</td>
<td style="text-align:right;">
0.3571429
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0026065
</td>
<td style="text-align:right;">
0.610286
</td>
<td style="text-align:right;">
311.3841
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
-74.81
</td>
<td style="text-align:right;">
20.44
</td>
<td style="text-align:right;">
107705546
</td>
<td style="text-align:right;">
422809465
</td>
<td style="text-align:right;">
24.39706
</td>
<td style="text-align:right;">
2527.112
</td>
<td style="text-align:right;">
27.59706
</td>
<td style="text-align:right;">
-0.0927082
</td>
<td style="text-align:right;">
132.1470588
</td>
<td style="text-align:right;">
0.0882353
</td>
<td style="text-align:right;">
25.733450
</td>
<td style="text-align:right;">
0.1524029
</td>
<td style="text-align:right;">
0.1779599
</td>
<td style="text-align:right;">
307.500371
</td>
<td style="text-align:right;">
514.4451
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
-75.76
</td>
<td style="text-align:right;">
20.09
</td>
<td style="text-align:right;">
107705657
</td>
<td style="text-align:right;">
422872031
</td>
<td style="text-align:right;">
24.95000
</td>
<td style="text-align:right;">
1441.100
</td>
<td style="text-align:right;">
53.60000
</td>
<td style="text-align:right;">
-0.1552392
</td>
<td style="text-align:right;">
53.7500000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.1703503
</td>
<td style="text-align:right;">
88.485521
</td>
<td style="text-align:right;">
126.9131
</td>
<td style="text-align:left;">
1
</td>
</tr>
</tbody>
</table>
</div>
<p>In this step, there are two alternatives: Either we split the data
into train and test sets:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">17</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#obtain stratified training sample</span></span>
<span><span class="va">train_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data_model</span><span class="op">)</span>, <span class="fl">2</span><span class="op">/</span><span class="fl">3</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data_model</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">data_train</span> <span class="op">&lt;-</span> <span class="va">data_model</span><span class="op">[</span><span class="va">train_idx</span>, <span class="op">]</span></span>
<span><span class="va">data_test</span> <span class="op">&lt;-</span> <span class="va">data_model</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span></span></code></pre></div>
<p>…or we use the whole dataset as the training set, since RF performs
intrinsic evaluation in every tree</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_train</span> <span class="op">&lt;-</span> <span class="va">data_model</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="a-simple-sdm-using-random-forest">A simple SDM using Random Forest<a class="anchor" aria-label="anchor" href="#a-simple-sdm-using-random-forest"></a>
</h3>
<p>We will use the ranger random forest (RF) algorithm (Wright &amp;
Ziegler, 2017) to build a species distribution model. Random forest can
handle huge quantities of data and is therefore scalable to larger
datasets. As our dataset is highly imbalanced towards the pseudo-absence
data, we will apply the down-sampling method for presence-only data in
the modelling process (Valavi et al., 2021). Down-sampling works by
balancing the training data, which contain significantly more absence
that presence points. Following this approach, the classification-RF
model will use the same number of pseudo-absences as presence points in
each classification tree, by sampling with replacement (bootstrapping)
from the full pseudo-absence set (Valavi et al., 2021).</p>
<p>Let’s define the sample size of each classification tree as a
proportion of the whole training set, based on the number of
presences.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># number of presence records:</span></span>
<span><span class="va">pres_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">data_train</span><span class="op">$</span><span class="va">occurrence</span><span class="op">)</span><span class="op">[</span><span class="st">"1"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">sample_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0"</span> <span class="op">=</span> <span class="va">pres_num</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data_train</span><span class="op">)</span>,</span>
<span>                 <span class="st">"1"</span> <span class="op">=</span> <span class="va">pres_num</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data_train</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sample_size</span></span></code></pre></div>
<pre><code><span><span class="co">##           0           1 </span></span>
<span><span class="co">## 0.004281589 0.004281589</span></span></code></pre>
<p>Run and inspect the model.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ranger/man/ranger.html" class="external-link">ranger</a></span><span class="op">(</span><span class="va">data_train</span><span class="op">$</span><span class="va">occurrence</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">data_train</span><span class="op">[</span>, <span class="fl">6</span><span class="op">:</span><span class="fl">14</span><span class="op">]</span>,</span>
<span>                 num.trees <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                 mtry<span class="op">=</span> <span class="fl">6</span>,</span>
<span>                 replace <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                 sample.fraction <span class="op">=</span> <span class="va">sample_size</span>,</span>
<span>                 oob.error <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                 keep.inbag <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                 num.threads <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                 importance <span class="op">=</span><span class="st">'impurity'</span>,</span>
<span>                 probability <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span></span></code></pre></div>
<pre><code><span><span class="co">## Ranger result</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">##  ranger(data_train$occurrence ~ ., data = data_train[, 6:14],      num.trees = 1000, mtry = 6, replace = T, sample.fraction = sample_size,      oob.error = T, keep.inbag = T, num.threads = 4, importance = "impurity",      probability = T) </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Type:                             Probability estimation </span></span>
<span><span class="co">## Number of trees:                  1000 </span></span>
<span><span class="co">## Sample size:                      10043 </span></span>
<span><span class="co">## Number of independent variables:  9 </span></span>
<span><span class="co">## Mtry:                             6 </span></span>
<span><span class="co">## Target node size:                 10 </span></span>
<span><span class="co">## Variable importance mode:         impurity </span></span>
<span><span class="co">## Splitrule:                        gini </span></span>
<span><span class="co">## OOB prediction error (Brier s.):  0.09204404</span></span></code></pre>
<p>The model can be evaluated based on the OOB prediction error. This
metric lies on the fact that the data points that are not used in
training a tree can be used to test the tree. The errors on the OOB
samples are called the <strong>out-of-bag errors</strong>.</p>
</div>
<div class="section level3">
<h3 id="model-prediction">Model prediction<a class="anchor" aria-label="anchor" href="#model-prediction"></a>
</h3>
<p>We will predict to the table of all the sub-catchments across Cuba,
including the future Bioclim variables.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, data <span class="op">=</span> <span class="va">stats_table_future</span><span class="op">[</span>,<span class="op">!</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<!--![](../man/figures/wf_8.png)-->
<p>We can now reclassify the sub-catchment raster based on the predicted
probabilities of occurrence, to visualise the potential suitable
habitats of the species. For this purpose we will use the
‘reclass_raster’ function. The function requires a table with the
reclassification rules (i.e., subc_id = predicted_occurrence), the
values of which need to be integers.</p>
<p>First, let’s join the probabilities of presence in each sub-catchment
with the corresponding sub-catchment IDs, to create a table with
reclassification rules</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prediction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>subcatchment_id <span class="op">=</span> <span class="va">stats_table_future</span><span class="op">$</span><span class="va">subcatchment_id</span>,</span>
<span>                         pred_occur <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">pred</span><span class="op">$</span><span class="va">predictions</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">prediction</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    subcatchment_id pred_occur</span></span>
<span><span class="co">## 1:       399592461 0.02508095</span></span>
<span><span class="co">## 2:       399592865 0.02323095</span></span>
<span><span class="co">## 3:       399593700 0.03909881</span></span>
<span><span class="co">## 4:       399593701 0.03078929</span></span>
<span><span class="co">## 5:       399593817 0.02586667</span></span>
<span><span class="co">## 6:       399593818 0.08412738</span></span></code></pre>
<p>and multiply the probability values by 100, to convert them to
integers</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prediction</span><span class="op">$</span><span class="va">pred_occur</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">prediction</span><span class="op">$</span><span class="va">pred_occur</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p>We can now reclassify the sub-catchment raster</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/reclass_raster.html">reclass_raster</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">prediction</span>,</span>
<span>  rast_val <span class="op">=</span> <span class="st">"subcatchment_id"</span>,</span>
<span>  new_val <span class="op">=</span> <span class="st">"pred_occur"</span>,</span>
<span>  raster_layer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">layer_dir</span>, <span class="st">"/sub_catchment.tif"</span><span class="op">)</span>,</span>
<span>  recl_layer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">wdir</span>, <span class="st">"/prediction.tif"</span><span class="op">)</span>,</span>
<span>  read <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Let’s plot the future habitat suitability map, and add the presence
points</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define colour palette</span></span>
<span><span class="va">num_pal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/colorNumeric.html" class="external-link">colorNumeric</a></span><span class="op">(</span></span>
<span>  <span class="fu">viridisLite</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">inferno</a></span><span class="op">(</span><span class="fl">256</span><span class="op">)</span></span>
<span>  , domain <span class="op">=</span> <span class="va">prediction</span><span class="op">$</span><span class="va">pred_occur</span></span>
<span>  , na.color <span class="op">=</span> <span class="st">"transparent"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/leaflet.html" class="external-link">leaflet</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-layers.html" class="external-link">addTiles</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-methods.html" class="external-link">setMaxBounds</a></span><span class="op">(</span><span class="va">bbox</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bbox</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bbox</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">bbox</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">leafem</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/leafem/reference/addGeotiff.html" class="external-link">addGeotiff</a></span><span class="op">(</span></span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">wdir</span>, <span class="st">"/prediction.tif"</span><span class="op">)</span>, opacity <span class="op">=</span> <span class="fl">1</span>,</span>
<span>   colorOptions <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/leafem/reference/colorOptions.html" class="external-link">colorOptions</a></span><span class="op">(</span></span>
<span>                  palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">256</span>, palette <span class="op">=</span> <span class="st">"inferno"</span><span class="op">)</span>,</span>
<span>                  na.color <span class="op">=</span> <span class="st">"transparent"</span></span>
<span>                  <span class="op">)</span> <span class="co"># read external raster file without loading it to R</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">leaflet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-layers.html" class="external-link">addCircles</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">spdata_vect</span>, color <span class="op">=</span> <span class="st">"turquoise"</span>, stroke <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># data = spdata</span></span>
<span>                      weight <span class="op">=</span> <span class="fl">5</span>, opacity <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># add points</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addLegend.html" class="external-link">addLegend</a></span><span class="op">(</span>pal <span class="op">=</span> <span class="va">num_pal</span>,</span>
<span>           values <span class="op">=</span> <span class="va">prediction</span><span class="op">$</span><span class="va">pred_occur</span>,</span>
<span>           labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palette.html" class="external-link">palette</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>           title <span class="op">=</span> <span class="st">"Future habitat suitability map&lt;/br&gt;for Hypolestes trinitatis"</span>,</span>
<span>           position <span class="op">=</span> <span class="st">"bottomleft"</span>, opacity <span class="op">=</span> <span class="fl">1</span>, labFormat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addLegend.html" class="external-link">labelFormat</a></span><span class="op">(</span>suffix <span class="op">=</span> <span class="st">"%"</span><span class="op">)</span><span class="op">)</span>  <span class="co"># add a legend</span></span>
<span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="../reference/figures/prediction.png" width="800"></p>
<p>If we zoom in to the habitat suitability map, we can observe the
sub-catchments that could offer a suitable habitat to the species in a
more detailed view.</p>
<p><img src="../reference/figures/prediction_zoom.png" width="800"></p>
</div>
<div class="section level3 unnumbered">
<h3 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-amatulli2022hydrography90m" class="csl-entry">
Amatulli, Giuseppe, Jaime Garcia Marquez, Tushar Sethi, Jens Kiesel,
Afroditi Grigoropoulou, Maria M Üblacker, Longzhu Q Shen, and Sami
Domisch. 2022. <span>“Hydrography90m: A New High-Resolution Global
Hydrographic Dataset.”</span> <em>Earth System Science Data</em> 14
(10): 4525–50.
</div>
<div id="ref-R-leafem" class="csl-entry">
Appelhans, Tim. 2022. <em>Leafem: Leaflet Extensions for Mapview</em>.
<a href="https://CRAN.R-project.org/package=leafem" class="external-link">https://CRAN.R-project.org/package=leafem</a>.
</div>
<div id="ref-R-mapview" class="csl-entry">
Appelhans, Tim, Florian Detsch, Christoph Reudenbach, and Stefan
Woellauer. 2022. <em>Mapview: Interactive Viewing of Spatial Data in
r</em>. <a href="https://github.com/r-spatial/mapview" class="external-link">https://github.com/r-spatial/mapview</a>.
</div>
<div id="ref-R-leaflet" class="csl-entry">
Cheng, Joe, Barret Schloerke, Bhaskar Karambelkar, and Yihui Xie. 2023.
<em>Leaflet: Create Interactive Web Maps with the JavaScript Leaflet
Library</em>. <a href="https://rstudio.github.io/leaflet/" class="external-link">https://rstudio.github.io/leaflet/</a>.
</div>
<div id="ref-R-data.table" class="csl-entry">
Dowle, Matt, and Arun Srinivasan. 2022. <em>Data.table: Extension of
‘Data.frame‘</em>. <a href="https://CRAN.R-project.org/package=data.table" class="external-link">https://CRAN.R-project.org/package=data.table</a>.
</div>
<div id="ref-R-terra" class="csl-entry">
Hijmans, Robert J. 2023. <em>Terra: Spatial Data Analysis</em>. <a href="https://rspatial.org/terra/" class="external-link">https://rspatial.org/terra/</a>.
</div>
<div id="ref-karger2019climatologies" class="csl-entry">
Karger, Dirk Nikolaus, and Niklaus E Zimmermann. 2019.
<span>“Climatologies at High Resolution for the Earth Land Surface Areas
CHELSA V1. 2: Technical Specification.”</span> <em>Swiss Federal
Research Institute WSL, Switzerland</em>.
</div>
<div id="ref-R-base" class="csl-entry">
R Core Team. 2022. <em>R: A Language and Environment for Statistical
Computing</em>. Vienna, Austria: R Foundation for Statistical Computing.
<a href="https://www.R-project.org/" class="external-link">https://www.R-project.org/</a>.
</div>
<div id="ref-R-hydrographr" class="csl-entry">
Schürz, Marlene, Afroditi Grigoropoulou, Jaime Garcia Marquez, Yusdiel
Torres Cambas, Christoph Schürz, Mathieu Floury, Thomas Tomiczek,
Vanessa Bremerich, Giuseppe Amatulli, and Sami Domisch. 2023.
<em>Hydrographr: Scalable Hydrographic Data Processing in r</em>. <a href="https://glowabio.github.io/hydrographr/" class="external-link">https://glowabio.github.io/hydrographr/</a>.
</div>
<div id="ref-torres2016conservation" class="csl-entry">
Torres-Cambas, Yusdiel, Martiño Cabana-Otero, M Olalla Lorenzo-Carballa,
and Adolfo Cordero-Rivera. 2016. <span>“Conservation Status and
Protection of Three Antillean Endemic Damselflies.”</span> <em>Journal
of Insect Conservation</em> 20: 277–84.
</div>
<div id="ref-ETOcuba" class="csl-entry">
Torres-Cambas, Yusdiel, and Juan Carlos Salazar Salina. 2022.
<span>“Ephemeroptera, Trichoptera and Odonata of Cuba.”</span> <a href="https://doi.org/10.18728/igb-fred-778.3" class="external-link uri">https://doi.org/10.18728/igb-fred-778.3</a>. <a href="https://doi.org/10.18728/igb-fred-778.3" class="external-link">https://doi.org/10.18728/igb-fred-778.3</a>.
</div>
<div id="ref-R-htmlwidgets" class="csl-entry">
Vaidyanathan, Ramnath, Yihui Xie, JJ Allaire, Joe Cheng, Carson Sievert,
and Kenton Russell. 2023. <em>Htmlwidgets: HTML Widgets for r</em>. <a href="https://github.com/ramnathv/htmlwidgets" class="external-link">https://github.com/ramnathv/htmlwidgets</a>.
</div>
<div id="ref-valavi2021modelling" class="csl-entry">
Valavi, Roozbeh, Jane Elith, José J Lahoz-Monfort, and Gurutzeta
Guillera-Arroita. 2021. <span>“Modelling Species Presence-Only Data with
Random Forests.”</span> <em>Ecography</em> 44 (12): 1731–42.
</div>
<div id="ref-R-stringr" class="csl-entry">
Wickham, Hadley. 2022. <em>Stringr: Simple, Consistent Wrappers for
Common String Operations</em>. <a href="https://CRAN.R-project.org/package=stringr" class="external-link">https://CRAN.R-project.org/package=stringr</a>.
</div>
<div id="ref-R-dplyr" class="csl-entry">
Wickham, Hadley, Romain François, Lionel Henry, and Kirill Müller. 2022.
<em>Dplyr: A Grammar of Data Manipulation</em>. <a href="https://CRAN.R-project.org/package=dplyr" class="external-link">https://CRAN.R-project.org/package=dplyr</a>.
</div>
<div id="ref-R-ranger" class="csl-entry">
Wright, Marvin N., Stefan Wager, and Philipp Probst. 2022. <em>Ranger: A
Fast Implementation of Random Forests</em>. <a href="https://github.com/imbs-hl/ranger" class="external-link">https://github.com/imbs-hl/ranger</a>.
</div>
<div id="ref-ranger2017" class="csl-entry">
Wright, Marvin N., and Andreas Ziegler. 2017. <span>“<span class="nocase">ranger</span>: A Fast Implementation of Random Forests
for High Dimensional Data in <span>C++</span> and
<span>R</span>.”</span> <em>Journal of Statistical Software</em> 77 (1):
1–17. <a href="https://doi.org/10.18637/jss.v077.i01" class="external-link">https://doi.org/10.18637/jss.v077.i01</a>.
</div>
<div id="ref-knitr2014" class="csl-entry">
Xie, Yihui. 2014. <span>“Knitr: A Comprehensive Tool for Reproducible
Research in <span>R</span>.”</span> In <em>Implementing Reproducible
Computational Research</em>, edited by Victoria Stodden, Friedrich
Leisch, and Roger D. Peng. Chapman; Hall/CRC.
</div>
<div id="ref-knitr2015" class="csl-entry">
———. 2015. <em>Dynamic Documents with <span>R</span> and Knitr</em>. 2nd
ed. Boca Raton, Florida: Chapman; Hall/CRC. <a href="https://yihui.org/knitr/" class="external-link">https://yihui.org/knitr/</a>.
</div>
<div id="ref-R-knitr" class="csl-entry">
———. 2023. <em>Knitr: A General-Purpose Package for Dynamic Report
Generation in r</em>. <a href="https://yihui.org/knitr/" class="external-link">https://yihui.org/knitr/</a>.
</div>
<div id="ref-R-kableExtra" class="csl-entry">
Zhu, Hao. 2021. <em>kableExtra: Construct Complex Table with Kable and
Pipe Syntax</em>. <a href="https://CRAN.R-project.org/package=kableExtra" class="external-link">https://CRAN.R-project.org/package=kableExtra</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Marlene Schürz, Afroditi Grigoropoulou, Jaime Garcia Marquez, Yusdiel Torres Cambas, Christoph Schürz, Mathieu Floury, Thomas Tomiczek, Vanessa Bremerich, Giuseppe Amatulli, Sami Domisch.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
