<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="hydrographr">
<title>Case study - Germany • hydrographr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Case study - Germany">
<meta property="og:description" content="hydrographr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">hydrographr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.16</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/hydrographr.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/benchmark.html">Function benchmarks</a>
    <a class="dropdown-item" href="../articles/case_study_brazil.html">Case study - São Francisco drainage basin</a>
    <a class="dropdown-item" href="../articles/case_study_cuba.html">Case study - Cuba</a>
    <a class="dropdown-item" href="../articles/case_study_germany.html">Case study - Germany</a>
    <a class="dropdown-item" href="../articles/example_other_stream_networks.html">Usage of hydrographr with other stream networks</a>
    <a class="dropdown-item" href="../articles/linux_system_setup.html">Setting up the package requirements on Linux</a>
    <a class="dropdown-item" href="../articles/macos_system_setup.html">Setting up the package requirements on MacOS</a>
    <a class="dropdown-item" href="../articles/windows_system_setup.html">Setting up the package requirements on Windows</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/glowabio/hydrographr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="case_study_germany_files/kePrint-0.0.1/kePrint.js"></script><link href="case_study_germany_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Case study - Germany</h1>
            <h3 data-toc-skip class="subtitle">Processing of spatial and
species data prior to network analyses for freshwater fish in
Germany</h3>
                        <h4 data-toc-skip class="author"></h4>
            
            <h4 data-toc-skip class="date">2024-01-02</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/glowabio/hydrographr/blob/HEAD/vignettes/case_study_germany.Rmd" class="external-link"><code>vignettes/case_study_germany.Rmd</code></a></small>
      <div class="d-none name"><code>case_study_germany.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>Load required libraries</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://glowabio.github.io/hydrographr/" class="external-link">hydrographr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rgbif" class="external-link">rgbif</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">tools</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/leaflet/" class="external-link">leaflet</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/leafem" class="external-link">leafem</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span></code></pre></div>
<p>Define working directory</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define the "data_germany" directory, where you have downloaded all the data,</span></span>
<span><span class="co"># as the working directory</span></span>
<span><span class="va">wdir</span> <span class="op">&lt;-</span> <span class="st">"my/working/directory/data_germany"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="va">wdir</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a new folder in the working directory to store all the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="species-data">Species data<a class="anchor" aria-label="anchor" href="#species-data"></a>
</h3>
<p>We first download the occurrence data with coordinates from GBIF</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Once: Download species occurrence data based on the key of the dataset</span></span>
<span><span class="co"># and write out to working directory</span></span>
<span><span class="va">spdata_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/occ_download_get.html" class="external-link">occ_download_get</a></span><span class="op">(</span>key<span class="op">=</span><span class="st">"0004551-231002084531237"</span>,</span>
<span>                              overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="va">occ_download_import</span></span>
<span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fwrite.html" class="external-link">fwrite</a></span><span class="op">(</span><span class="va">spdata_all</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">wdir</span>, <span class="st">"/data/fish_germany_gbif.csv"</span><span class="op">)</span>,</span>
<span>    row.names <span class="op">=</span> <span class="cn">F</span>, quote <span class="op">=</span> <span class="cn">F</span>, sep <span class="op">=</span> <span class="st">"\t"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Import and clean the data</span></span>
<span><span class="va">spdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">wdir</span>, <span class="st">"/data/fish_germany_gbif.csv"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"\t"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">gbifID</span>, <span class="va">decimalLongitude</span>, <span class="va">decimalLatitude</span>, <span class="va">species</span>, <span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"longitude"</span> <span class="op">=</span> <span class="st">"decimalLongitude"</span>,</span>
<span>         <span class="st">"latitude"</span> <span class="op">=</span> <span class="st">"decimalLatitude"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">spdata</span><span class="op">)</span></span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:200px; overflow-x: scroll; width:500px; ">
<table class="table table table-striped" style="width: auto !important; ">
<thead><tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
gbifID
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
longitude
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
latitude
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
species
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
year
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
4058501303
</td>
<td style="text-align:right;">
13.2284
</td>
<td style="text-align:right;">
52.5709
</td>
<td style="text-align:left;">
Abramis brama
</td>
<td style="text-align:right;">
2007
</td>
</tr>
<tr>
<td style="text-align:right;">
4058501307
</td>
<td style="text-align:right;">
13.1564
</td>
<td style="text-align:right;">
52.4147
</td>
<td style="text-align:left;">
Abramis brama
</td>
<td style="text-align:right;">
2007
</td>
</tr>
<tr>
<td style="text-align:right;">
4058460309
</td>
<td style="text-align:right;">
13.1861
</td>
<td style="text-align:right;">
52.4576
</td>
<td style="text-align:left;">
Abramis brama
</td>
<td style="text-align:right;">
2007
</td>
</tr>
<tr>
<td style="text-align:right;">
4058501314
</td>
<td style="text-align:right;">
13.1093
</td>
<td style="text-align:right;">
52.4079
</td>
<td style="text-align:left;">
Abramis brama
</td>
<td style="text-align:right;">
2008
</td>
</tr>
<tr>
<td style="text-align:right;">
4058501316
</td>
<td style="text-align:right;">
13.5746
</td>
<td style="text-align:right;">
52.5091
</td>
<td style="text-align:left;">
Abramis brama
</td>
<td style="text-align:right;">
2008
</td>
</tr>
<tr>
<td style="text-align:right;">
4058460317
</td>
<td style="text-align:right;">
13.1177
</td>
<td style="text-align:right;">
52.4017
</td>
<td style="text-align:left;">
Abramis brama
</td>
<td style="text-align:right;">
2008
</td>
</tr>
</tbody>
</table>
</div>
<p>Let’s visualise the species occurrences on the map</p>
<p>Let’s define the extent (bounding box) of the study area (xmin, ymin,
xmax, ymax)</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define the extent</span></span>
<span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">spdata</span><span class="op">$</span><span class="va">longitude</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">spdata</span><span class="op">$</span><span class="va">latitude</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">spdata</span><span class="op">$</span><span class="va">longitude</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">spdata</span><span class="op">$</span><span class="va">latitude</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define color palette for the different years of record</span></span>
<span><span class="va">factpal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/colorNumeric.html" class="external-link">colorFactor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">spdata</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span>, <span class="va">spdata</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create leaflet plot</span></span>
<span><span class="va">spdata_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/leaflet.html" class="external-link">leaflet</a></span><span class="op">(</span><span class="va">spdata</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addProviderTiles.html" class="external-link">addProviderTiles</a></span><span class="op">(</span><span class="st">'Esri.WorldShadedRelief'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-methods.html" class="external-link">setMaxBounds</a></span><span class="op">(</span><span class="va">bbox</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bbox</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bbox</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">bbox</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-layers.html" class="external-link">addCircles</a></span><span class="op">(</span>lng <span class="op">=</span> <span class="op">~</span><span class="va">longitude</span>, lat <span class="op">=</span> <span class="op">~</span> <span class="va">latitude</span>, </span>
<span>             color <span class="op">=</span>  <span class="op">~</span><span class="fu">factpal</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/is.bool.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             opacity <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/addLegend.html" class="external-link">addLegend</a></span><span class="op">(</span>pal <span class="op">=</span> <span class="va">factpal</span>, values <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/is.bool.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>,</span>
<span>            title <span class="op">=</span> <span class="st">"Year of record"</span><span class="op">)</span></span>
<span><span class="va">spdata_plot</span></span></code></pre></div>
<p><img src="../reference/figures/germany_map.png" width="800"></p>
</div>
<div class="section level3">
<h3 id="abiotic-variables-data">Abiotic variables data<a class="anchor" aria-label="anchor" href="#abiotic-variables-data"></a>
</h3>
<div class="section level4">
<h4 id="hydrography90m">1. Hydrography90m<a class="anchor" aria-label="anchor" href="#hydrography90m"></a>
</h4>
<p>In order to download layers of the Hydrography90m, we need to know
the IDs of the 20°x20° tiles in which they are located. We can obtain
these IDs using the function <em>get_tile_id()</em>. This function
downloads and uses the auxiliary raster file that contains all the
regional units globally, and thus requires an active internet
connection.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tile_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_tile_id.html">get_tile_id</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">spdata</span>,</span>
<span>                     lon <span class="op">=</span> <span class="st">"longitude"</span>, lat <span class="op">=</span> <span class="st">"latitude"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get reg unit id to crop all the regular tile layers so that </span></span>
<span><span class="co"># we have uninterrupted basins</span></span>
<span><span class="va">reg_unit_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_regional_unit_id.html">get_regional_unit_id</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">spdata</span>,</span>
<span>                                  lon <span class="op">=</span> <span class="st">"longitude"</span>, lat <span class="op">=</span> <span class="st">"latitude"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tile_id</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "h16v02" "h18v00" "h18v02"</span></span></code></pre>
<p>Currently the function returns all the tiles of the regional unit
where the input points are located. However, some of them may be far
from the study area and hence not always needed in further steps. Please
double check which tile IDs are relevant for your purpose using the
<strong>Tile map</strong> found <a href="https://hydrography.org/hydrography90m/hydrography90m_layers/" class="external-link">here</a>.</p>
<p>In our case, Germany spreads in just one tile, with the ID “h18v02”,
so we will keep only this one.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tile_id</span> <span class="op">&lt;-</span> <span class="st">"h18v02"</span></span></code></pre></div>
<p>Then we define the names of the raster and vector layers we want to
download.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define the raster layers</span></span>
<span><span class="va">vars_tif</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"basin"</span>, <span class="st">"sub_catchment"</span>, <span class="st">"segment"</span>, <span class="st">"accumulation"</span>, <span class="st">"direction"</span>,</span>
<span>              <span class="st">"outlet_dist_dw_basin"</span>, <span class="st">"outlet_dist_dw_scatch"</span>,</span>
<span>              <span class="st">"channel_dist_up_seg"</span>, <span class="st">"order_strahler"</span><span class="op">)</span></span>
<span><span class="co"># Define the vector layers</span></span>
<span><span class="co"># The "basin" layer contains the polygons of the drainage basins while the</span></span>
<span><span class="co"># "order_vect_segment" layer is the stream network vector file</span></span>
<span><span class="va">vars_gpkg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"basin"</span>, <span class="st">"order_vect_segment"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extend timeout to 1000s to allow uninterrupted downloading</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>timeout <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="co"># Download the .tif tiles of the desired variables</span></span>
<span><span class="fu"><a href="../reference/download_tiles.html">download_tiles</a></span><span class="op">(</span>variable <span class="op">=</span> <span class="va">vars_tif</span>, tile_id <span class="op">=</span> <span class="va">tile_id</span>, file_format <span class="op">=</span> <span class="st">"tif"</span>,</span>
<span>               download_dir <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Download the .gpkg tiles of the desired variables</span></span>
<span><span class="fu"><a href="../reference/download_tiles.html">download_tiles</a></span><span class="op">(</span>variable <span class="op">=</span> <span class="va">vars_gpkg</span>, tile_id <span class="op">=</span> <span class="va">tile_id</span>, file_format <span class="op">=</span> <span class="st">"gpkg"</span>,</span>
<span>               download_dir <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Download the raster mask of the regional unit</span></span>
<span><span class="fu"><a href="../reference/download_tiles.html">download_tiles</a></span><span class="op">(</span>variable <span class="op">=</span> <span class="st">"regional_unit"</span>,</span>
<span>               file_format <span class="op">=</span> <span class="st">"tif"</span>,</span>
<span>               reg_unit_id <span class="op">=</span> <span class="va">reg_unit_id</span>,</span>
<span>               download_dir <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="elevation---merit-hydro">2. Elevation - MERIT-HYDRO<a class="anchor" aria-label="anchor" href="#elevation---merit-hydro"></a>
</h4>
<p>To download the elevation files of MERIT-HYDRO, we visit <a href="https://hydro.iis.u-tokyo.ac.jp/~yamadai/MERIT_Hydro/" class="external-link uri">https://hydro.iis.u-tokyo.ac.jp/~yamadai/MERIT_Hydro/</a> to
define the tiles that need to be downloaded. We download the zipped
tiles into a new directory called <strong><em>elv</em></strong>, unzip
the downloaded .tar file and keep only the tiles that we need</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">elv_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">wdir</span>, <span class="st">"/data/elv"</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">elv_dir</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="climate---chelsa-bioclim">3. Climate - CHELSA Bioclim<a class="anchor" aria-label="anchor" href="#climate---chelsa-bioclim"></a>
</h4>
<p>Finally, we will download three CHELSA present Bioclim variables. For
a quick outlook on the bioclimatic variables you can have a look <a href="https://chelsa-climate.org/bioclim/" class="external-link">here</a>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create download directory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">wdir</span>, <span class="st">"/data/chelsa_bioclim"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extend timeout to 1000s to allow uninterrupted downloading</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>timeout <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Download</span></span>
<span><span class="co"># Present, 1981-2010</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="st">"https://os.zhdk.cloud.switch.ch/envicloud/chelsa/chelsa_V2/GLOBAL/climatologies/1981-2010/bio/CHELSA_bio12_1981-2010_V.2.1.tif"</span>,</span>
<span>destfile <span class="op">=</span> <span class="st">"data/chelsa_bioclim/bio12_1981-2010.tif"</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="st">"https://os.zhdk.cloud.switch.ch/envicloud/chelsa/chelsa_V2/GLOBAL/climatologies/1981-2010/bio/CHELSA_bio15_1981-2010_V.2.1.tif"</span>,</span>
<span>destfile <span class="op">=</span> <span class="st">"data/chelsa_bioclim/bio15_1981-2010.tif"</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="st">"https://os.zhdk.cloud.switch.ch/envicloud/chelsa/chelsa_V2/GLOBAL/climatologies/1981-2010/bio/CHELSA_bio1_1981-2010_V.2.1.tif"</span>,</span>
<span>destfile <span class="op">=</span> <span class="st">"data/chelsa_bioclim/bio1_1981-2010.tif"</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="cropping-the-raster-files">Cropping the raster files<a class="anchor" aria-label="anchor" href="#cropping-the-raster-files"></a>
</h3>
<p>After having downloaded all the layers, we need to crop them to the
extent of our study area extended by 500 km, so that our basins are not
split in half.</p>
<p>Let’s define the extent (bounding box) of the study area (xmin, ymin,
xmax, ymax)</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.256</span>, <span class="fl">20</span>, <span class="fl">45</span>, <span class="fl">55.4325</span><span class="op">)</span></span></code></pre></div>
<p>We then crop the raster tiles to the extent using the function
<em>crop_to_extent()</em> in a loop</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span><span class="op">(</span><span class="va">itile</span> <span class="kw">in</span> <span class="va">raster_tiles</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/crop_to_extent.html">crop_to_extent</a></span><span class="op">(</span>raster_layer <span class="op">=</span> <span class="va">itile</span>,</span>
<span>                 bounding_box <span class="op">=</span> <span class="va">bb</span>,</span>
<span>                 out_dir <span class="op">=</span> <span class="va">study_area_dir</span>,</span>
<span>                 file_name <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">itile</span><span class="op">)</span>, <span class="st">".tif"</span><span class="op">)</span>,</span>
<span>                                     <span class="st">"_crop.tif"</span><span class="op">)</span>,</span>
<span>                 quiet <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                 compression <span class="op">=</span> <span class="st">"high"</span>,</span>
<span>                 bigtiff <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                 read <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="filtering-the-sub-catchment-and-basin--gpkg-files">Filtering the sub-catchment and basin .gpkg files<a class="anchor" aria-label="anchor" href="#filtering-the-sub-catchment-and-basin--gpkg-files"></a>
</h3>
<p>In case you don’t work on a server, we suggest you to download the
output files of this chunk from the following links and then copy them
in the folder <em><code>study_area_dir</code></em>:</p>
<ul>
<li><p><a href="https://drive.google.com/file/d/14jh2zG7eqlS-KQZlZufLcZfPdEhRncd8/view?usp=drive_link" class="external-link">order_vect_segment_h18v02_crop.gpkg</a></p></li>
<li><p><a href="https://drive.google.com/file/d/1l9l7k3s9YIVkjhSoRqLVb8L2rGStSvz0/view?usp=drive_link" class="external-link">basin_h18v02_crop.gpkg</a></p></li>
</ul>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># !! Only run this chunk on a machine with more than 16 GB RAM, </span></span>
<span><span class="co"># as the input files are really big !!</span></span>
<span></span>
<span><span class="co"># Load the cropped stream and basin raster layer of the study area.</span></span>
<span><span class="co"># The stream raster can be used interchangeably with the sub_catchment raster, </span></span>
<span><span class="co"># because the stream IDs are the same as the sub-catchment IDs. </span></span>
<span><span class="co"># Here we use the stream raster because it's smaller in size. </span></span>
<span></span>
<span><span class="va">stream_layer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">study_area_dir</span>, <span class="st">"/segment_h18v02_crop.tif"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">basin_layer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">study_area_dir</span>, <span class="st">"/basin_h18v02_crop.tif"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get all sub-catchment and basin IDs of the study area</span></span>
<span><span class="va">subc_ids</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">stream_layer</span><span class="op">)</span></span>
<span><span class="va">basin_ids</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">basin_layer</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get the full path of the stream order segment GeoPackage tile</span></span>
<span><span class="va">order_tile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">wdir</span>, pattern <span class="op">=</span> <span class="st">"order.+_h[v0-8]+.gpkg$"</span>,</span>
<span>                         full.names <span class="op">=</span> <span class="cn">TRUE</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">basin_gpkg_tile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">wdir</span>, pattern <span class="op">=</span> <span class="st">"bas.+_h[v0-8]+.gpkg$"</span>,</span>
<span>                              full.names <span class="op">=</span> <span class="cn">TRUE</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter the sub-catchment IDs from the GeoPackage of the order_vector_segment</span></span>
<span><span class="co"># tiles (sub-catchment ID = stream ID)</span></span>
<span><span class="co"># Save the stream segments of the study area</span></span>
<span><span class="va">filtered_stream</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_geopackage.html">read_geopackage</a></span><span class="op">(</span><span class="va">order_tile</span>,</span>
<span>                                 import_as <span class="op">=</span> <span class="st">"sf"</span>,</span>
<span>                                 subc_id <span class="op">=</span> <span class="va">subc_ids</span><span class="op">$</span><span class="va">segment_h18v02_crop</span>,</span>
<span>                                 name <span class="op">=</span> <span class="st">"stream"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">write_sf</a></span><span class="op">(</span><span class="va">filtered_stream</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">study_area_dir</span>,</span>
<span>                              <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">order_tile</span><span class="op">)</span>, <span class="st">".gpkg"</span><span class="op">)</span>,</span>
<span>                                         <span class="st">"_crop.gpkg"</span><span class="op">)</span>, sep<span class="op">=</span><span class="st">"/"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">filtered_bas</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_geopackage.html">read_geopackage</a></span><span class="op">(</span><span class="va">basin_gpkg_tile</span>,</span>
<span>                                 import_as <span class="op">=</span> <span class="st">"sf"</span>,</span>
<span>                                 subc_id <span class="op">=</span> <span class="va">basin_ids</span><span class="op">$</span><span class="va">basin_h18v02_crop</span>,</span>
<span>                                 name <span class="op">=</span> <span class="st">"ID"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">write_sf</a></span><span class="op">(</span><span class="va">filtered_bas</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">study_area_dir</span>,</span>
<span>                          <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">basin_gpkg_tile</span><span class="op">)</span>, <span class="st">".gpkg"</span><span class="op">)</span>,</span>
<span>                                         <span class="st">"_crop.gpkg"</span><span class="op">)</span>, sep<span class="op">=</span><span class="st">"/"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="merging-the-elevation-tiles">Merging the elevation tiles<a class="anchor" aria-label="anchor" href="#merging-the-elevation-tiles"></a>
</h3>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># These are the elevation tiles that include our study area</span></span>
<span><span class="va">elv_tiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n45e000_elv.tif"</span>, <span class="st">"n50e010_elv.tif"</span>, <span class="st">"n60e000_elv.tif"</span>,</span>
<span>                <span class="st">"n45e005_elv.tif"</span>, <span class="st">"n50e015_elv.tif"</span>, <span class="st">"n60e005_elv.tif"</span>,</span>
<span>                <span class="st">"n45e010_elv.tif"</span>, <span class="st">"n55e000_elv.tif"</span>, <span class="st">"n60e010_elv.tif"</span>,</span>
<span>                <span class="st">"n45e015_elv.tif"</span>, <span class="st">"n55e005_elv.tif"</span>, <span class="st">"n60e015_elv.tif"</span>,</span>
<span>                <span class="st">"n50e000_elv.tif"</span>, <span class="st">"n55e010_elv.tif"</span>, <span class="st">"n50e005_elv.tif"</span>,</span>
<span>                <span class="st">"n55e015_elv.tif"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/merge_tiles.html">merge_tiles</a></span><span class="op">(</span>tile_dir <span class="op">=</span> <span class="va">elv_dir</span>, </span>
<span>            tile_names <span class="op">=</span> <span class="va">elv_tiles</span>,</span>
<span>            out_dir <span class="op">=</span> <span class="va">study_area_dir</span>, </span>
<span>            file_name <span class="op">=</span> <span class="st">"elv_study_area.tif"</span>,</span>
<span>            compression <span class="op">=</span> <span class="st">"high"</span>,</span>
<span>            bigtiff <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>            quiet <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># crop to our extent</span></span>
<span><span class="fu"><a href="../reference/crop_to_extent.html">crop_to_extent</a></span><span class="op">(</span>raster_layer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">study_area_dir</span>, <span class="st">"/elv_study_area.tif"</span><span class="op">)</span>,</span>
<span>               bounding_box <span class="op">=</span> <span class="va">bb</span>,</span>
<span>               out_dir <span class="op">=</span> <span class="va">study_area_dir</span>,</span>
<span>               file_name <span class="op">=</span>  <span class="st">"elv_study_area_crop.tif"</span>,</span>
<span>               quiet <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>               compression <span class="op">=</span> <span class="st">"high"</span>, </span>
<span>               bigtiff <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>               read <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we will crop the CHELSA Bioclim layers.</p>
<p>We define the directory containing the layers to be cropped and we
list their file names</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dir_chelsa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">wdir</span>, <span class="st">"/data/chelsa_bioclim"</span><span class="op">)</span></span>
<span><span class="va">files_chelsa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">dir_chelsa</span>, pattern <span class="op">=</span> <span class="st">".tif"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span><span class="op">(</span><span class="va">ifile</span> <span class="kw">in</span> <span class="va">files_chelsa</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/crop_to_extent.html">crop_to_extent</a></span><span class="op">(</span></span>
<span>      raster_layer <span class="op">=</span> <span class="va">ifile</span>,</span>
<span>      bounding_box <span class="op">=</span> <span class="va">bb</span>,</span>
<span>      out_dir <span class="op">=</span> <span class="va">study_area_dir</span>,</span>
<span>      file_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">ifile</span><span class="op">)</span>,</span>
<span>      read <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>      quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="extracting-sub-catchment-ids">Extracting sub-catchment IDs<a class="anchor" aria-label="anchor" href="#extracting-sub-catchment-ids"></a>
</h3>
<p>Extract the IDs of the sub-catchments where the points are located.
This step is crucial, as many of the functions that we will later use
require a vector of sub-catchment IDs as input. Note that the function
<em>extract_ids()</em> can be used to extract the values at specific
points of any raster file provided to the argument <em>subc_layer</em>.
It can be safely used to query very large raster files, as these are not
loaded into R.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spdata_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_ids.html">extract_ids</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">spdata</span>,</span>
<span>  id <span class="op">=</span> <span class="st">"gbifID"</span>,</span>
<span>  lon <span class="op">=</span> <span class="st">"longitude"</span>, lat <span class="op">=</span> <span class="st">"latitude"</span>,</span>
<span>  basin_layer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">study_area_dir</span>, <span class="st">"/basin_h18v02_crop.tif"</span><span class="op">)</span>,</span>
<span>  subc_layer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">study_area_dir</span>, <span class="st">"/sub_catchment_h18v02_crop.tif"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>
The species data have now their corresponding sub-catchment ids
</caption>
<thead><tr>
<th style="text-align:right;">
longitude
</th>
<th style="text-align:right;">
latitude
</th>
<th style="text-align:right;">
gbifID
</th>
<th style="text-align:right;">
subcatchment_id
</th>
<th style="text-align:right;">
basin_id
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
13.2284
</td>
<td style="text-align:right;">
52.5709
</td>
<td style="text-align:right;">
4058501303
</td>
<td style="text-align:right;">
507197109
</td>
<td style="text-align:right;">
1294020
</td>
</tr>
<tr>
<td style="text-align:right;">
13.1564
</td>
<td style="text-align:right;">
52.4147
</td>
<td style="text-align:right;">
4058501307
</td>
<td style="text-align:right;">
507313477
</td>
<td style="text-align:right;">
1294020
</td>
</tr>
<tr>
<td style="text-align:right;">
13.1861
</td>
<td style="text-align:right;">
52.4576
</td>
<td style="text-align:right;">
4058460309
</td>
<td style="text-align:right;">
507278293
</td>
<td style="text-align:right;">
1294020
</td>
</tr>
<tr>
<td style="text-align:right;">
13.1093
</td>
<td style="text-align:right;">
52.4079
</td>
<td style="text-align:right;">
4058501314
</td>
<td style="text-align:right;">
507316793
</td>
<td style="text-align:right;">
1294020
</td>
</tr>
<tr>
<td style="text-align:right;">
13.5746
</td>
<td style="text-align:right;">
52.5091
</td>
<td style="text-align:right;">
4058501316
</td>
<td style="text-align:right;">
507243022
</td>
<td style="text-align:right;">
1294020
</td>
</tr>
<tr>
<td style="text-align:right;">
13.1177
</td>
<td style="text-align:right;">
52.4017
</td>
<td style="text-align:right;">
4058460317
</td>
<td style="text-align:right;">
507321279
</td>
<td style="text-align:right;">
1294020
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="snapping-points-to-the-network">Snapping points to the network<a class="anchor" aria-label="anchor" href="#snapping-points-to-the-network"></a>
</h3>
<p>Before we can calculate the distance along the stream network between
species occurrences, we need to snap the coordinates of the sites to the
stream network. Recorded coordinates of point locations usually do not
exactly overlap with the digital stream network and, therefore, need to
be slightly corrected.</p>
<p>The hydrographr package offers two different snapping functions,
<code>snap_to_network</code> and <code>snap_to_subc_segment</code>. The
first function uses a defined distance radius and a flow accumulation
threshold, while the second function snaps the point to the stream
segment of the sub-catchment the point was originally located in.</p>
<p>For this case study we will use the function
<code>snap_to_network</code> to be able to define a certain flow
accumulation threshold and ensure that the fish occurrences will not be
snapped to a headwater stream (first order stream) if there is also a
higher order stream next to it.</p>
<p><img src="../reference/figures/snapping.png"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define full paths of raster layers</span></span>
<span><span class="va">stream_rast</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">study_area_dir</span>, <span class="st">"/segment_h18v02_crop.tif"</span><span class="op">)</span></span>
<span><span class="va">flow_rast</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">study_area_dir</span>, <span class="st">"/accumulation_h18v02_crop.tif"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We need to shorten the gbifIDs because they are too long for GRASS-GIS</span></span>
<span><span class="co"># We will delete the first 2 characters ("40") from all IDs</span></span>
<span><span class="va">spdata_ids</span><span class="op">$</span><span class="va">gbifID_tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace</a></span><span class="op">(</span><span class="va">spdata_ids</span><span class="op">$</span><span class="va">gbifID</span>, <span class="st">"40"</span>, <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<p>The function is implemented in a for-loop that starts searching for
streams with a very high flow accumulation of 400,000 km² in a very
short distance and then slowly decreases the flow accumulation to 100
km². If there are still sites left which were not snapped to a stream
segment, the distance will increase from 10 up to 30 cells.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define thresholds for the flow accumulation of the stream segment, where</span></span>
<span><span class="co"># the point location should be snapped to</span></span>
<span><span class="va">accu_threshold</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">400000</span>, <span class="fl">300000</span>, <span class="fl">100000</span>, <span class="fl">50000</span>, <span class="fl">10000</span>, <span class="fl">5000</span>, <span class="fl">1000</span>, <span class="fl">500</span>, <span class="fl">100</span><span class="op">)</span> </span>
<span><span class="co"># Define the distance radius</span></span>
<span><span class="va">dist_radius</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a temporary data.table</span></span>
<span><span class="va">point_locations_tmp</span> <span class="op">&lt;-</span> <span class="va">spdata_ids</span></span>
<span></span>
<span><span class="co"># Note: The for loop takes about 9 minutes</span></span>
<span><span class="va">first</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">idist</span> <span class="kw">in</span> <span class="va">dist_radius</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>   <span class="co"># If the distance increases to 20 cells only a flow accumulation of 100 km²</span></span>
<span>   <span class="co"># will be used</span></span>
<span>   <span class="kw">if</span> <span class="op">(</span><span class="va">idist</span> <span class="op">==</span> <span class="fl">20</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Set accu_threshold to 100</span></span>
<span>    <span class="va">accu_threshold</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span>   <span class="op">}</span></span>
<span>  </span>
<span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">iaccu</span> <span class="kw">in</span> <span class="va">accu_threshold</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Snap point locations to the stream network</span></span>
<span>    <span class="va">point_locations_snapped_tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/snap_to_network.html">snap_to_network</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">point_locations_tmp</span>,</span>
<span>                                    id <span class="op">=</span> <span class="st">"gbifID"</span>,</span>
<span>                                    lon <span class="op">=</span> <span class="st">"longitude"</span>, lat <span class="op">=</span> <span class="st">"latitude"</span>,</span>
<span>                                    stream_layer <span class="op">=</span> <span class="va">stream_rast</span>,</span>
<span>                                    accu_layer <span class="op">=</span> <span class="va">flow_rast</span>,</span>
<span>                                    method <span class="op">=</span> <span class="st">"accumulation"</span>,</span>
<span>                                    distance <span class="op">=</span> <span class="va">idist</span>,</span>
<span>                                    accumulation <span class="op">=</span> <span class="va">iaccu</span>,</span>
<span>                                    quiet <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span>    </span>
<span>    <span class="co"># Keep point location with NAs for the next loop</span></span>
<span>    <span class="va">point_locations_tmp</span> <span class="op">&lt;-</span> <span class="va">point_locations_snapped_tmp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">subc_id_snap_accu</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">first</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Keep the point locations with the new coordinates and remove rows with NA</span></span>
<span>    <span class="va">point_locations_snapped</span> <span class="op">&lt;-</span> <span class="va">point_locations_snapped_tmp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">subc_id_snap_accu</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">first</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="co"># Bind the new data.frame to the data.frame of the loop before</span></span>
<span>    <span class="co"># and remove the NA</span></span>
<span>    <span class="va">point_locations_snapped</span> <span class="op">&lt;-</span> <span class="va">point_locations_snapped</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">point_locations_snapped_tmp</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">subc_id_snap_accu</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="op">}</span></span>
<span>    </span>
<span><span class="op">}</span></span></code></pre></div>
<p>We can write out the result of the snapping</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fwrite.html" class="external-link">fwrite</a></span><span class="op">(</span><span class="va">point_locations_snapped</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">wdir</span>, <span class="st">"/data/spdata_snapped.csv"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">","</span>, </span>
<span>                      row.names <span class="op">=</span> <span class="cn">FALSE</span>, quote <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">point_locations_snapped</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>
The species data have been attributed new coordinates and in some cases
a new sub-catchment id (“subc_id_snap_accu”)
</caption>
<thead><tr>
<th style="text-align:right;">
gbifID
</th>
<th style="text-align:right;">
longitude
</th>
<th style="text-align:right;">
latitude
</th>
<th style="text-align:right;">
lon_snap_accu
</th>
<th style="text-align:right;">
lat_snap_accu
</th>
<th style="text-align:right;">
subc_id_snap_accu
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
58452301
</td>
<td style="text-align:right;">
10.1725
</td>
<td style="text-align:right;">
53.8729
</td>
<td style="text-align:right;">
10.172083
</td>
<td style="text-align:right;">
53.87292
</td>
<td style="text-align:right;">
506457237
</td>
</tr>
<tr>
<td style="text-align:right;">
58452302
</td>
<td style="text-align:right;">
10.2972
</td>
<td style="text-align:right;">
53.6788
</td>
<td style="text-align:right;">
10.297083
</td>
<td style="text-align:right;">
53.67875
</td>
<td style="text-align:right;">
506528521
</td>
</tr>
<tr>
<td style="text-align:right;">
58452303
</td>
<td style="text-align:right;">
9.4411
</td>
<td style="text-align:right;">
54.0136
</td>
<td style="text-align:right;">
9.441250
</td>
<td style="text-align:right;">
54.01375
</td>
<td style="text-align:right;">
506407992
</td>
</tr>
<tr>
<td style="text-align:right;">
58452304
</td>
<td style="text-align:right;">
9.5619
</td>
<td style="text-align:right;">
54.0996
</td>
<td style="text-align:right;">
9.562083
</td>
<td style="text-align:right;">
54.09958
</td>
<td style="text-align:right;">
506383004
</td>
</tr>
<tr>
<td style="text-align:right;">
58452305
</td>
<td style="text-align:right;">
10.6518
</td>
<td style="text-align:right;">
53.6034
</td>
<td style="text-align:right;">
10.652083
</td>
<td style="text-align:right;">
53.60375
</td>
<td style="text-align:right;">
506562036
</td>
</tr>
<tr>
<td style="text-align:right;">
58452306
</td>
<td style="text-align:right;">
9.9609
</td>
<td style="text-align:right;">
53.8553
</td>
<td style="text-align:right;">
9.961250
</td>
<td style="text-align:right;">
53.85542
</td>
<td style="text-align:right;">
506463635
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="calculating-distances-between-points">Calculating distances between points<a class="anchor" aria-label="anchor" href="#calculating-distances-between-points"></a>
</h3>
<p>We will calculate the distance between all point locations. The
following chunks are computationally heavy, so we suggest to run them on
a server.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load as graph</span></span>
<span><span class="va">stream_graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_geopackage.html">read_geopackage</a></span><span class="op">(</span></span>
<span>  gpkg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">study_area_dir</span>, <span class="st">"/order_vect_segment_h18v02_crop.gpkg"</span><span class="op">)</span>,</span>
<span>  import_as <span class="op">=</span> <span class="st">"graph"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get the network distance (in meters) between all input pairs.</span></span>
<span><span class="co"># We provide the subcatchment ids of the snapped points to the argument "subc_id"</span></span>
<span><span class="va">subc_distances</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_distance_graph.html">get_distance_graph</a></span><span class="op">(</span><span class="va">stream_graph</span>,</span>
<span>                            subc_id <span class="op">=</span> <span class="va">point_locations_snapped</span><span class="op">$</span><span class="va">subc_id_snap_accu</span>,</span>
<span>                            variable <span class="op">=</span> <span class="st">"length"</span>,</span>
<span>                            distance_m <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">subc_distances</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:right;">
from
</th>
<th style="text-align:right;">
to
</th>
<th style="text-align:right;">
distance
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
506457237
</td>
<td style="text-align:right;">
506528521
</td>
<td style="text-align:right;">
167973.69
</td>
</tr>
<tr>
<td style="text-align:right;">
506457237
</td>
<td style="text-align:right;">
506407992
</td>
<td style="text-align:right;">
92908.34
</td>
</tr>
<tr>
<td style="text-align:right;">
506528521
</td>
<td style="text-align:right;">
506407992
</td>
<td style="text-align:right;">
111478.74
</td>
</tr>
<tr>
<td style="text-align:right;">
506457237
</td>
<td style="text-align:right;">
506383004
</td>
<td style="text-align:right;">
161571.37
</td>
</tr>
<tr>
<td style="text-align:right;">
506528521
</td>
<td style="text-align:right;">
506383004
</td>
<td style="text-align:right;">
136308.05
</td>
</tr>
<tr>
<td style="text-align:right;">
506407992
</td>
<td style="text-align:right;">
506383004
</td>
<td style="text-align:right;">
105076.42
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="obtaining-network-centrality-indices">Obtaining network centrality indices<a class="anchor" aria-label="anchor" href="#obtaining-network-centrality-indices"></a>
</h3>
<p>We will now calculate centrality indices using the directed stream
network graph and the function <code>get_centrality</code> We want to
consider only the upstream connected segments, so we set
<code>mode = "in".</code></p>
<p>The following chunks are computationally heavy, so we suggest to run
them on a server.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">centrality</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_centrality.html">get_centrality</a></span><span class="op">(</span><span class="va">stream_graph</span>, index <span class="op">=</span> <span class="st">"all"</span>, mode <span class="op">=</span> <span class="st">"in"</span><span class="op">)</span></span></code></pre></div>
<p>We now attach the centrality indices to the species data using the
subcatchment id</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">point_locations_snapped</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">point_locations_snapped</span>, <span class="va">centrality</span>, </span>
<span>                          by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'subc_id_snap_accu'</span><span class="op">=</span> <span class="st">'subc_id'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">point_locations_snapped</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:right;">
subc_id
</th>
<th style="text-align:right;">
degree
</th>
<th style="text-align:right;">
closeness
</th>
<th style="text-align:right;">
farness
</th>
<th style="text-align:right;">
betweeness
</th>
<th style="text-align:right;">
eccentricity
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
506226492
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4.8e-06
</td>
<td style="text-align:right;">
210084
</td>
<td style="text-align:right;">
175492
</td>
<td style="text-align:right;">
163
</td>
</tr>
<tr>
<td style="text-align:right;">
506226723
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3.8e-06
</td>
<td style="text-align:right;">
263544
</td>
<td style="text-align:right;">
125205
</td>
<td style="text-align:right;">
185
</td>
</tr>
<tr>
<td style="text-align:right;">
506226977
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1.4e-06
</td>
<td style="text-align:right;">
716085
</td>
<td style="text-align:right;">
167992
</td>
<td style="text-align:right;">
214
</td>
</tr>
<tr>
<td style="text-align:right;">
506227065
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3.6e-06
</td>
<td style="text-align:right;">
279270
</td>
<td style="text-align:right;">
114210
</td>
<td style="text-align:right;">
191
</td>
</tr>
<tr>
<td style="text-align:right;">
506227782
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
6.1e-06
</td>
<td style="text-align:right;">
164017
</td>
<td style="text-align:right;">
201756
</td>
<td style="text-align:right;">
144
</td>
</tr>
<tr>
<td style="text-align:right;">
506227869
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
7.5e-06
</td>
<td style="text-align:right;">
133336
</td>
<td style="text-align:right;">
168399
</td>
<td style="text-align:right;">
137
</td>
</tr>
</tbody>
</table>
<p>We can reclassify the stream segment and sub-catchment raster layers
based on the centrality value of each stream, using the function
<code>reclass_raster</code>. Essentially, we will create two new raster
files, in which each stream pixel will have a centrality value, instead
of the unique ID of the stream or sub-catchment.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/reclass_raster.html">reclass_raster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">point_locations_snapped</span>, </span>
<span>              rast_val <span class="op">=</span> <span class="st">"subc_id"</span>, </span>
<span>              new_val <span class="op">=</span> <span class="st">"betweeness"</span>,</span>
<span>              raster_layer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">study_area_dir</span>, <span class="st">"/segment_h18v02_crop.tif"</span><span class="op">)</span>,</span>
<span>              recl_layer <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">study_area_dir</span>,<span class="st">"/segment_h18v02_betweeness.tif"</span><span class="op">)</span>, </span>
<span>              read <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/reclass_raster.html">reclass_raster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">point_locations_snapped</span>, </span>
<span>              rast_val <span class="op">=</span> <span class="st">"subc_id"</span>, </span>
<span>              new_val <span class="op">=</span> <span class="st">"betweeness"</span>,</span>
<span>              raster_layer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">study_area_dir</span>, <span class="st">"/sub_catchment_h18v02_crop.tif"</span><span class="op">)</span>,</span>
<span>              recl_layer <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">study_area_dir</span>,<span class="st">"/sub_catchment_h18v02_betweeness.tif"</span><span class="op">)</span>, </span>
<span>              read <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Here’s what the new segment and sub-catchment layers look like on
QGIS, when overlayed with the original layers. The yellow streams, or
sub-catchments, have high betweenness values, whereas the darker ones
have lower betweenness</p>
<p><img src="../reference/figures/reclass_segm_centrality.png"></p>
<p><img src="../reference/figures/reclass_subcs_centrality.png"></p>
<p>Bonus! If we want to include the centrality indices to the stream
network .gpkg, we can import the .gpkg and merge it with the centrality
table</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load stream network .gpkg as vector</span></span>
<span><span class="va">stream_vect</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_geopackage.html">read_geopackage</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">study_area_dir</span>, <span class="st">"/order_vect_segment_h18v02_crop.gpkg"</span><span class="op">)</span>,</span>
<span>                               import_as <span class="op">=</span> <span class="st">"SpatVect"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Merge the centrality table with the vector</span></span>
<span><span class="va">stream_vect</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">stream_vect</span>, <span class="va">spdata_centr</span>, </span>
<span>                        by.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'stream'</span><span class="op">)</span>, by.y<span class="op">=</span><span class="st">"subc_id"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Write out the stream gpkg including the centrality indices</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/writeVector.html" class="external-link">writeVector</a></span><span class="op">(</span><span class="va">stream_vect</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">study_area_dir</span>, <span class="st">"/order_vect_segment_centr.gpkg"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="extracting-zonal-statistics-of-topographic-variables">Extracting zonal statistics of topographic variables<a class="anchor" aria-label="anchor" href="#extracting-zonal-statistics-of-topographic-variables"></a>
</h3>
<p>We will calculate the zonal statistics of the Hydrography90m,
MERIT-HYDRO DEM and the CHELSA Bioclim variables for the sub-catchments
of our species points. Caution, don’t increase the number of cores to
more than 3 as this can cause memory problems. However, this highly
depends to the number of sub-catchments as well. We recommend to test
the function with different parameters to find out what works best for
your case.</p>
<p>Let’s first define the input <code>var_layers</code> for the
<code>extract_zonal_stat</code> function</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">study_area_dir</span><span class="op">)</span></span>
<span><span class="va">var_layers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio1_1981-2010.tif"</span>, <span class="st">"bio12_1981-2010.tif"</span>,</span>
<span>                <span class="st">"bio15_1981-2010.tif"</span>, <span class="st">"elv_study_area_crop.tif"</span>,</span>
<span>                <span class="st">"outlet_dist_dw_basin_h18v02_crop.tif"</span><span class="op">)</span></span></code></pre></div>
<p>A good practice before aggregating the variables is to check their
NoData values:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/report_no_data.html">report_no_data</a></span><span class="op">(</span>data_dir <span class="op">=</span> <span class="va">study_area_dir</span>, var_layer <span class="op">=</span> <span class="va">var_layers</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#                                 Raster                  NoData</span></span>
<span><span class="co"># 1                   bio1_1981-2010.tif                  -99999</span></span>
<span><span class="co"># 2                  bio15_1981-2010.tif 3.40282346600000016e+38</span></span>
<span><span class="co"># 3 outlet_dist_dw_basin_h18v02_crop.tif                   -9999</span></span>
<span><span class="co"># 4                  bio12_1981-2010.tif                  -99999</span></span>
<span><span class="co"># 5              elv_study_area_crop.tif                   -9999</span></span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run the function that returns the zonal statistics.</span></span>
<span><span class="co"># We provide the subcatchment ids of the fish points to the argument 'subc_id'.</span></span>
<span><span class="va">stats_table_zon</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_zonal_stat.html">extract_zonal_stat</a></span><span class="op">(</span></span>
<span>                    data_dir <span class="op">=</span> <span class="va">study_area_dir</span>,</span>
<span>                    subc_layer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">study_area_dir</span>, <span class="st">"/sub_catchment_h18v02_crop.tif"</span><span class="op">)</span>,</span>
<span>                    subc_id <span class="op">=</span> <span class="va">point_locations_snapped</span><span class="op">$</span><span class="va">subc_id_snap_accu</span>,</span>
<span>                    var_layer <span class="op">=</span> <span class="va">var_layers</span>,</span>
<span>                    out_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">wdir</span>, <span class="st">"/data"</span><span class="op">)</span>,</span>
<span>                    file_name <span class="op">=</span> <span class="st">"zonal_stats.csv"</span>,</span>
<span>                    n_cores <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p>The function also reports the NoData values that are used in the
calculation of the zonal statistics of each variable.</p>
<p>We will keep only the mean and sd of each variable of the
stats_table:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stats_table_zon</span> <span class="op">&lt;-</span> <span class="va">stats_table_zon</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"subc"</span><span class="op">)</span> <span class="op">|</span>  <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"_mean"</span><span class="op">)</span> <span class="op">|</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">"_sd"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">'subcatchment_id'</span> <span class="op">=</span> <span class="st">'subc_id'</span><span class="op">)</span></span></code></pre></div>
<p>The values in some of the original raster files were scaled, so we
need to re-scale them before proceeding to any analyses.</p>
<p>We define the following functions:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clim_scale</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">na.rm</span> <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">(</span><span class="va">x</span> <span class="op">*</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">offset</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">na.rm</span> <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="fl">273.15</span><span class="op">)</span></span></code></pre></div>
<p>… and apply them to rescale the values</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stats_table_zon</span> <span class="op">&lt;-</span> <span class="va">stats_table_zon</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"bio"</span><span class="op">)</span>, <span class="va">clim_scale</span><span class="op">)</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">matches</a></span><span class="op">(</span><span class="st">"bio1_.*_mean"</span><span class="op">)</span>, <span class="va">offset</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">stats_table_zon</span><span class="op">)</span></span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:200px; overflow-x: scroll; width:500px; ">
<table class="table table table-striped" style="width: auto !important; ">
<thead><tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
subcatchment_id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_1981.2010_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_1981.2010_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_1981.2010_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
elv_study_area_crop_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
outlet_dist_dw_basin_h18v02_crop_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_1981.2010_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_1981.2010_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_1981.2010_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
elv_study_area_crop_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
outlet_dist_dw_basin_h18v02_crop_sd
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
506226492
</td>
<td style="text-align:right;">
8.750000
</td>
<td style="text-align:right;">
867.0000
</td>
<td style="text-align:right;">
24.50000
</td>
<td style="text-align:right;">
2.518750
</td>
<td style="text-align:right;">
32103.56
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.6540439
</td>
<td style="text-align:right;">
89.4399
</td>
</tr>
<tr>
<td style="text-align:right;">
506226723
</td>
<td style="text-align:right;">
8.850000
</td>
<td style="text-align:right;">
862.5000
</td>
<td style="text-align:right;">
25.00000
</td>
<td style="text-align:right;">
1.404762
</td>
<td style="text-align:right;">
23899.57
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.3062464
</td>
<td style="text-align:right;">
112.3611
</td>
</tr>
<tr>
<td style="text-align:right;">
506226977
</td>
<td style="text-align:right;">
8.950000
</td>
<td style="text-align:right;">
835.8753
</td>
<td style="text-align:right;">
26.32118
</td>
<td style="text-align:right;">
1.556471
</td>
<td style="text-align:right;">
10280.49
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.8442060
</td>
<td style="text-align:right;">
0.0533449
</td>
<td style="text-align:right;">
0.5845958
</td>
<td style="text-align:right;">
347.6842
</td>
</tr>
<tr>
<td style="text-align:right;">
506227065
</td>
<td style="text-align:right;">
8.850000
</td>
<td style="text-align:right;">
859.7644
</td>
<td style="text-align:right;">
25.10000
</td>
<td style="text-align:right;">
1.667797
</td>
<td style="text-align:right;">
22184.93
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0970108
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.5881429
</td>
<td style="text-align:right;">
258.6820
</td>
</tr>
<tr>
<td style="text-align:right;">
506227782
</td>
<td style="text-align:right;">
8.716667
</td>
<td style="text-align:right;">
877.9917
</td>
<td style="text-align:right;">
23.80000
</td>
<td style="text-align:right;">
5.733333
</td>
<td style="text-align:right;">
39542.25
</td>
<td style="text-align:right;">
0.0471405
</td>
<td style="text-align:right;">
0.9286714
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.3933475
</td>
<td style="text-align:right;">
123.1798
</td>
</tr>
<tr>
<td style="text-align:right;">
506227869
</td>
<td style="text-align:right;">
8.650000
</td>
<td style="text-align:right;">
882.0288
</td>
<td style="text-align:right;">
23.51364
</td>
<td style="text-align:right;">
7.521212
</td>
<td style="text-align:right;">
42551.11
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.8227384
</td>
<td style="text-align:right;">
0.0343174
</td>
<td style="text-align:right;">
0.5040789
</td>
<td style="text-align:right;">
292.2345
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level3">
<h3 id="putting-together-the-final-table">Putting together the final table<a class="anchor" aria-label="anchor" href="#putting-together-the-final-table"></a>
</h3>
<p>We will now perform some left joins to match the zonal statistics
table with the original species data.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_fin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">point_locations_snapped</span>, <span class="va">stats_table_zon</span>, </span>
<span>          by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'subc_id_snap_accu'</span><span class="op">=</span> <span class="st">'subcatchment_id'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_fin</span><span class="op">$</span><span class="va">gbifID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">data_fin</span><span class="op">$</span><span class="va">gbifID</span><span class="op">)</span></span>
<span><span class="va">data_fin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">spdata_ids</span>, <span class="va">data_fin</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert the gbifIDs back to the original values</span></span>
<span><span class="va">data_fin</span><span class="op">$</span><span class="va">gbifID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html" class="external-link">str_c</a></span><span class="op">(</span><span class="st">"40"</span>, <span class="va">data_fin</span><span class="op">$</span><span class="va">gbifID</span><span class="op">)</span></span>
<span><span class="va">spdata</span><span class="op">$</span><span class="va">gbifID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">spdata</span><span class="op">$</span><span class="va">gbifID</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_fin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">spdata</span>, <span class="va">data_fin</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_fin</span><span class="op">)</span></span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:200px; overflow-x: scroll; width:500px; ">
<table class="table table table-striped" style="width: auto !important; ">
<thead><tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
gbifID
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
longitude
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
latitude
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
species
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
year
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
subcatchment_id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
basin_id
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
lon_snap_accu
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
lat_snap_accu
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
subc_id_snap_accu
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
degree
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
closeness
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
farness
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
betweeness
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
eccentricity
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_1981.2010_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_1981.2010_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_1981.2010_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
elv_study_area_crop_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
outlet_dist_dw_basin_h18v02_crop_mean
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio1_1981.2010_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio12_1981.2010_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
bio15_1981.2010_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
elv_study_area_crop_sd
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
outlet_dist_dw_basin_h18v02_crop_sd
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
4058501303
</td>
<td style="text-align:right;">
13.2284
</td>
<td style="text-align:right;">
52.5709
</td>
<td style="text-align:left;">
Abramis brama
</td>
<td style="text-align:right;">
2007
</td>
<td style="text-align:right;">
507197109
</td>
<td style="text-align:right;">
1294020
</td>
<td style="text-align:right;">
13.22708
</td>
<td style="text-align:right;">
52.57042
</td>
<td style="text-align:right;">
507197712
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
3.00e-07
</td>
<td style="text-align:right;">
3090581
</td>
<td style="text-align:right;">
16724066
</td>
<td style="text-align:right;">
393
</td>
<td style="text-align:right;">
9.450000
</td>
<td style="text-align:right;">
593.5000
</td>
<td style="text-align:right;">
17.80000
</td>
<td style="text-align:right;">
31.04762
</td>
<td style="text-align:right;">
440220.7
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
1.377236
</td>
<td style="text-align:right;">
151.5696
</td>
</tr>
<tr>
<td style="text-align:right;">
4058501307
</td>
<td style="text-align:right;">
13.1564
</td>
<td style="text-align:right;">
52.4147
</td>
<td style="text-align:left;">
Abramis brama
</td>
<td style="text-align:right;">
2007
</td>
<td style="text-align:right;">
507313477
</td>
<td style="text-align:right;">
1294020
</td>
<td style="text-align:right;">
13.15625
</td>
<td style="text-align:right;">
52.41459
</td>
<td style="text-align:right;">
507313477
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2.39e-05
</td>
<td style="text-align:right;">
41919
</td>
<td style="text-align:right;">
953343
</td>
<td style="text-align:right;">
88
</td>
<td style="text-align:right;">
9.509091
</td>
<td style="text-align:right;">
589.5500
</td>
<td style="text-align:right;">
18.60000
</td>
<td style="text-align:right;">
35.73636
</td>
<td style="text-align:right;">
427865.0
</td>
<td style="text-align:right;">
0.0491666
</td>
<td style="text-align:right;">
0.3460820
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
3.234690
</td>
<td style="text-align:right;">
134.7493
</td>
</tr>
<tr>
<td style="text-align:right;">
4058460309
</td>
<td style="text-align:right;">
13.1861
</td>
<td style="text-align:right;">
52.4576
</td>
<td style="text-align:left;">
Abramis brama
</td>
<td style="text-align:right;">
2007
</td>
<td style="text-align:right;">
507278293
</td>
<td style="text-align:right;">
1294020
</td>
<td style="text-align:right;">
13.18125
</td>
<td style="text-align:right;">
52.46292
</td>
<td style="text-align:right;">
507275834
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.00e+00
</td>
<td style="text-align:right;">
51830114
</td>
<td style="text-align:right;">
105429462
</td>
<td style="text-align:right;">
1303
</td>
<td style="text-align:right;">
9.547436
</td>
<td style="text-align:right;">
586.2846
</td>
<td style="text-align:right;">
18.30000
</td>
<td style="text-align:right;">
30.78718
</td>
<td style="text-align:right;">
426400.9
</td>
<td style="text-align:right;">
0.0158062
</td>
<td style="text-align:right;">
0.0975034
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
2.339974
</td>
<td style="text-align:right;">
186.9974
</td>
</tr>
<tr>
<td style="text-align:right;">
4058501314
</td>
<td style="text-align:right;">
13.1093
</td>
<td style="text-align:right;">
52.4079
</td>
<td style="text-align:left;">
Abramis brama
</td>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
507316793
</td>
<td style="text-align:right;">
1294020
</td>
<td style="text-align:right;">
13.10958
</td>
<td style="text-align:right;">
52.40792
</td>
<td style="text-align:right;">
507316793
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
5.00e-01
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2310
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
9.434524
</td>
<td style="text-align:right;">
580.8988
</td>
<td style="text-align:right;">
18.60000
</td>
<td style="text-align:right;">
47.73333
</td>
<td style="text-align:right;">
433626.8
</td>
<td style="text-align:right;">
0.0607376
</td>
<td style="text-align:right;">
1.7258189
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
12.098773
</td>
<td style="text-align:right;">
218.8741
</td>
</tr>
<tr>
<td style="text-align:right;">
4058501316
</td>
<td style="text-align:right;">
13.5746
</td>
<td style="text-align:right;">
52.5091
</td>
<td style="text-align:left;">
Abramis brama
</td>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
507243022
</td>
<td style="text-align:right;">
1294020
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
4058460317
</td>
<td style="text-align:right;">
13.1177
</td>
<td style="text-align:right;">
52.4017
</td>
<td style="text-align:left;">
Abramis brama
</td>
<td style="text-align:right;">
2008
</td>
<td style="text-align:right;">
507321279
</td>
<td style="text-align:right;">
1294020
</td>
<td style="text-align:right;">
13.11792
</td>
<td style="text-align:right;">
52.40208
</td>
<td style="text-align:right;">
507321279
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
2.50e-02
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:right;">
14989
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
9.477434
</td>
<td style="text-align:right;">
579.6389
</td>
<td style="text-align:right;">
18.60089
</td>
<td style="text-align:right;">
46.03982
</td>
<td style="text-align:right;">
432292.3
</td>
<td style="text-align:right;">
0.0446179
</td>
<td style="text-align:right;">
1.7279807
</td>
<td style="text-align:right;">
0.0093655
</td>
<td style="text-align:right;">
14.462301
</td>
<td style="text-align:right;">
349.9969
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level3 unnumbered">
<h3 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-R-leafem" class="csl-entry">
Appelhans, Tim. 2022. <em>Leafem: Leaflet Extensions for Mapview</em>.
<a href="https://github.com/r-spatial/leafem" class="external-link">https://github.com/r-spatial/leafem</a>.
</div>
<div id="ref-R-mapview" class="csl-entry">
Appelhans, Tim, Florian Detsch, Christoph Reudenbach, and Stefan
Woellauer. 2022. <em>Mapview: Interactive Viewing of Spatial Data in
r</em>. <a href="https://github.com/r-spatial/mapview" class="external-link">https://github.com/r-spatial/mapview</a>.
</div>
<div id="ref-rgbif2017" class="csl-entry">
Chamberlain, Scott, and Carl Boettiger. 2017. <span>“R Python, and Ruby
Clients for GBIF Species Occurrence Data.”</span> <em>PeerJ
PrePrints</em>. <a href="https://doi.org/10.7287/peerj.preprints.3304v1" class="external-link">https://doi.org/10.7287/peerj.preprints.3304v1</a>.
</div>
<div id="ref-R-rgbif" class="csl-entry">
Chamberlain, Scott, Damiano Oldoni, and John Waller. 2023. <em>Rgbif:
Interface to the Global Biodiversity Information Facility API</em>. <a href="https://github.com/ropensci/rgbif" class="external-link">https://github.com/ropensci/rgbif</a>.
</div>
<div id="ref-R-leaflet" class="csl-entry">
Cheng, Joe, Barret Schloerke, Bhaskar Karambelkar, and Yihui Xie. 2023.
<em>Leaflet: Create Interactive Web Maps with the JavaScript Leaflet
Library</em>. <a href="https://rstudio.github.io/leaflet/" class="external-link">https://rstudio.github.io/leaflet/</a>.
</div>
<div id="ref-R-data.table" class="csl-entry">
Dowle, Matt, and Arun Srinivasan. 2023. <em>Data.table: Extension of
‘Data.frame‘</em>. <a href="https://r-datatable.com" class="external-link">https://r-datatable.com</a>.
</div>
<div id="ref-R-terra" class="csl-entry">
Hijmans, Robert J. 2023. <em>Terra: Spatial Data Analysis</em>. <a href="https://rspatial.org/" class="external-link">https://rspatial.org/</a>.
</div>
<div id="ref-R-here" class="csl-entry">
Müller, Kirill. 2020. <em>Here: A Simpler Way to Find Your Files</em>.
<a href="https://here.r-lib.org/" class="external-link">https://here.r-lib.org/</a>.
</div>
<div id="ref-R-base" class="csl-entry">
R Core Team. 2023. <em>R: A Language and Environment for Statistical
Computing</em>. Vienna, Austria: R Foundation for Statistical Computing.
<a href="https://www.R-project.org/" class="external-link">https://www.R-project.org/</a>.
</div>
<div id="ref-R-hydrographr" class="csl-entry">
Schürz, Marlene, Afroditi Grigoropoulou, Jaime Garcia Marquez, Yusdiel
Torres Cambas, Christoph Schürz, Mathieu Floury, Thomas Tomiczek,
Vanessa Bremerich, Giuseppe Amatulli, and Sami Domisch. 2023.
<em>Hydrographr: Scalable Hydrographic Data Processing in r</em>. <a href="https://glowabio.github.io/hydrographr/" class="external-link">https://glowabio.github.io/hydrographr/</a>.
</div>
<div id="ref-hydrographr2023" class="csl-entry">
Schürz, Marlene, Afroditi Grigoropoulou, Jaime García Márquez, Yusdiel
Torres-Cambas, Thomas Tomiczek, Mathieu Floury, Vanessa Bremerich, et
al. 2023. <span>“Hydrographr: An r Package for Scalable Hydrographic
Data Processing.”</span> <em>Methods in Ecology and Evolution</em> 0
(0): 1–11. https://doi.org/<a href="https://doi.org/10.1111/2041-210X.14226" class="external-link">https://doi.org/10.1111/2041-210X.14226</a>.
</div>
<div id="ref-R-htmlwidgets" class="csl-entry">
Vaidyanathan, Ramnath, Yihui Xie, JJ Allaire, Joe Cheng, Carson Sievert,
and Kenton Russell. 2023. <em>Htmlwidgets: HTML Widgets for r</em>. <a href="https://github.com/ramnathv/htmlwidgets" class="external-link">https://github.com/ramnathv/htmlwidgets</a>.
</div>
<div id="ref-R-stringr" class="csl-entry">
Wickham, Hadley. 2022. <em>Stringr: Simple, Consistent Wrappers for
Common String Operations</em>. <a href="https://stringr.tidyverse.org" class="external-link">https://stringr.tidyverse.org</a>.
</div>
<div id="ref-R-dplyr" class="csl-entry">
Wickham, Hadley, Romain François, Lionel Henry, Kirill Müller, and Davis
Vaughan. 2023. <em>Dplyr: A Grammar of Data Manipulation</em>. <a href="https://dplyr.tidyverse.org" class="external-link">https://dplyr.tidyverse.org</a>.
</div>
<div id="ref-knitr2014" class="csl-entry">
Xie, Yihui. 2014. <span>“Knitr: A Comprehensive Tool for Reproducible
Research in <span>R</span>.”</span> In <em>Implementing Reproducible
Computational Research</em>, edited by Victoria Stodden, Friedrich
Leisch, and Roger D. Peng. Chapman; Hall/CRC.
</div>
<div id="ref-knitr2015" class="csl-entry">
———. 2015. <em>Dynamic Documents with <span>R</span> and Knitr</em>. 2nd
ed. Boca Raton, Florida: Chapman; Hall/CRC. <a href="https://yihui.org/knitr/" class="external-link">https://yihui.org/knitr/</a>.
</div>
<div id="ref-R-knitr" class="csl-entry">
———. 2023. <em>Knitr: A General-Purpose Package for Dynamic Report
Generation in r</em>. <a href="https://yihui.org/knitr/" class="external-link">https://yihui.org/knitr/</a>.
</div>
<div id="ref-R-kableExtra" class="csl-entry">
Zhu, Hao. 2021. <em>kableExtra: Construct Complex Table with Kable and
Pipe Syntax</em>. <a href="http://haozhu233.github.io/kableExtra/" class="external-link">http://haozhu233.github.io/kableExtra/</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Marlene Schürz, Afroditi Grigoropoulou, Jaime Garcia Marquez, Yusdiel Torres Cambas, Christoph Schürz, Mathieu Floury, Thomas Tomiczek, Vanessa Bremerich, Giuseppe Amatulli, Sami Domisch.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
